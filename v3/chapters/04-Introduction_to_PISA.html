<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>04 Introduction to PISA – MASTEMR</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-baa83ea22f7c85f46c9cbd6ff4810be6.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../css/mastemr.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../images/KCL_logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">MASTEMR</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/04-Introduction_to_PISA.html">04 Introduction to PISA</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Sessions</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/01-Intro_to_quant_methods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">01 Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">02 Introduction to R</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/02-1-Intro_to_analysis_software.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/02-2-Intro_to_analysis_software.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Loading packages and exploring data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/02-3-Intro_to_analysis_software.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Piping and dplyr</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/02-4-Intro_to_graphs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Making graphs</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/03-Descriptive.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">03 Descriptive Statistics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/04-Introduction_to_PISA.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">04 Introduction to PISA</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/05-Presentations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">05 Presentations</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/06-T-testsPISA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">06 T-tests</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/07-ChisqPISA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">07 Hypothesis testing and Chi-square tests</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/08-Writing_report.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">08 Writing a quantitative report</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/09-Assignment_3_tutorials.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">09 Assignment 3 tutorials</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/10-Correlation_and_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">10 Correlation and regression</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/11-selecting_statistical_tools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">11 Selecting statistical tools</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/12-value_of_quant.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">12 The value of quantitative methods</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Additional tests</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A8-SEM.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SEM</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendicies</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A1-PISA_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">PISA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A2-DfE_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DfE England</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A3-TIMSS_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TIMSS, PIRLS and ICILS</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A4-Other_datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Other datasets</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A5-Self_Study_Tasks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Self Study Tasks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A6-QandA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Questions and Answers</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction-to-pisa" id="toc-introduction-to-pisa" class="nav-link active" data-scroll-target="#introduction-to-pisa"><span class="header-section-number">1</span> Introduction to PISA</a>
  <ul class="collapse">
  <li><a href="#pre-session-tasks" id="toc-pre-session-tasks" class="nav-link" data-scroll-target="#pre-session-tasks"><span class="header-section-number">1.1</span> Pre-session tasks</a>
  <ul class="collapse">
  <li><a href="#pre-reading" id="toc-pre-reading" class="nav-link" data-scroll-target="#pre-reading"><span class="header-section-number">1.1.1</span> Pre-reading</a></li>
  <li><a href="#getting-set-up" id="toc-getting-set-up" class="nav-link" data-scroll-target="#getting-set-up"><span class="header-section-number">1.1.2</span> Getting set up</a></li>
  </ul></li>
  <li><a href="#the-pisa-assessments" id="toc-the-pisa-assessments" class="nav-link" data-scroll-target="#the-pisa-assessments"><span class="header-section-number">1.2</span> The PISA assessments</a></li>
  <li><a href="#a-reminder-about-summarising-data-graphing-and-categorising" id="toc-a-reminder-about-summarising-data-graphing-and-categorising" class="nav-link" data-scroll-target="#a-reminder-about-summarising-data-graphing-and-categorising"><span class="header-section-number">1.3</span> A reminder about summarising data, graphing and categorising</a>
  <ul class="collapse">
  <li><a href="#summarising-data" id="toc-summarising-data" class="nav-link" data-scroll-target="#summarising-data"><span class="header-section-number">1.3.1</span> Summarising data</a></li>
  <li><a href="#bar-charts" id="toc-bar-charts" class="nav-link" data-scroll-target="#bar-charts"><span class="header-section-number">1.3.2</span> Bar charts</a></li>
  <li><a href="#scatter-plots" id="toc-scatter-plots" class="nav-link" data-scroll-target="#scatter-plots"><span class="header-section-number">1.3.3</span> Scatter plots</a></li>
  <li><a href="#density-plots" id="toc-density-plots" class="nav-link" data-scroll-target="#density-plots"><span class="header-section-number">1.3.4</span> Density plots</a></li>
  <li><a href="#facet-wrapping---producing-the-same-graph-for-multiple-countries." id="toc-facet-wrapping---producing-the-same-graph-for-multiple-countries." class="nav-link" data-scroll-target="#facet-wrapping---producing-the-same-graph-for-multiple-countries."><span class="header-section-number">1.3.5</span> Facet wrapping - producing the same graph for multiple countries.</a></li>
  <li><a href="#categorising-responses" id="toc-categorising-responses" class="nav-link" data-scroll-target="#categorising-responses"><span class="header-section-number">1.3.6</span> Categorising responses</a></li>
  </ul></li>
  <li><a href="#seminar-activities" id="toc-seminar-activities" class="nav-link" data-scroll-target="#seminar-activities"><span class="header-section-number">1.4</span> Seminar activities</a>
  <ul class="collapse">
  <li><a href="#task-1-discussion-activity" id="toc-task-1-discussion-activity" class="nav-link" data-scroll-target="#task-1-discussion-activity"><span class="header-section-number">1.4.1</span> Task 1 Discussion activity</a></li>
  <li><a href="#task-2-create-a-ranked-list" id="toc-task-2-create-a-ranked-list" class="nav-link" data-scroll-target="#task-2-create-a-ranked-list"><span class="header-section-number">1.4.2</span> Task 2 Create a ranked list</a></li>
  <li><a href="#task-3-plot-distributions-of-wealth-scores" id="toc-task-3-plot-distributions-of-wealth-scores" class="nav-link" data-scroll-target="#task-3-plot-distributions-of-wealth-scores"><span class="header-section-number">1.4.3</span> Task 3 Plot distributions of wealth scores</a></li>
  <li><a href="#task-4-plot-distributions-of-scores" id="toc-task-4-plot-distributions-of-scores" class="nav-link" data-scroll-target="#task-4-plot-distributions-of-scores"><span class="header-section-number">1.4.4</span> Task 4 Plot distributions of scores</a></li>
  <li><a href="#task-5-plot-distributions-of-scores-by-gender" id="toc-task-5-plot-distributions-of-scores-by-gender" class="nav-link" data-scroll-target="#task-5-plot-distributions-of-scores-by-gender"><span class="header-section-number">1.4.5</span> Task 5 Plot distributions of scores by gender</a></li>
  <li><a href="#task-6-facet-wrap-by-country" id="toc-task-6-facet-wrap-by-country" class="nav-link" data-scroll-target="#task-6-facet-wrap-by-country"><span class="header-section-number">1.4.6</span> Task 6 Facet wrap by country</a></li>
  <li><a href="#task-7-plot-a-scatter-graph" id="toc-task-7-plot-a-scatter-graph" class="nav-link" data-scroll-target="#task-7-plot-a-scatter-graph"><span class="header-section-number">1.4.7</span> Task 7 Plot a scatter graph</a></li>
  <li><a href="#task-8-plot-likert-responses-using-facet-wrapping" id="toc-task-8-plot-likert-responses-using-facet-wrapping" class="nav-link" data-scroll-target="#task-8-plot-likert-responses-using-facet-wrapping"><span class="header-section-number">1.4.8</span> Task 8 Plot Likert responses using facet wrapping</a></li>
  <li><a href="#task-9-categorise-homepos-scores" id="toc-task-9-categorise-homepos-scores" class="nav-link" data-scroll-target="#task-9-categorise-homepos-scores"><span class="header-section-number">1.4.9</span> Task 9 Categorise <code>HOMEPOS</code> scores</a></li>
  <li><a href="#task-10-compare-the-association-between-mathematics-and-science-pv-values-across-three-diverse-countries" id="toc-task-10-compare-the-association-between-mathematics-and-science-pv-values-across-three-diverse-countries" class="nav-link" data-scroll-target="#task-10-compare-the-association-between-mathematics-and-science-pv-values-across-three-diverse-countries"><span class="header-section-number">1.4.10</span> Task 10 Compare the association between mathematics and science PV values across three diverse countries</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">04 Introduction to PISA</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction-to-pisa" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction to PISA</h1>
<section id="pre-session-tasks" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="pre-session-tasks"><span class="header-section-number">1.1</span> Pre-session tasks</h2>
<section id="pre-reading" class="level3" data-number="1.1.1">
<h3 data-number="1.1.1" class="anchored" data-anchor-id="pre-reading"><span class="header-section-number">1.1.1</span> Pre-reading</h3>
<p>Please read section 1 (“What is PISA?”) of the PISA 2022 Assessment and Analytical Framework: <a href="https://read.oecd.org/10.1787/dfe0bf9c-en?format=html">PISA Assessment Framework</a></p>
</section>
<section id="getting-set-up" class="level3" data-number="1.1.2">
<h3 data-number="1.1.2" class="anchored" data-anchor-id="getting-set-up"><span class="header-section-number">1.1.2</span> Getting set up</h3>
<p>Remember to load the PISA 2022 data set</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(arrow)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a>PISA_2022 <span class="ot">&lt;-</span> <span class="fu">read_parquet</span>(r<span class="st">"[&lt;folder&gt;PISA_2022_student_subset.parquet]"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="the-pisa-assessments" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="the-pisa-assessments"><span class="header-section-number">1.2</span> The PISA assessments</h2>
<p>The first International Large-Scale Assessment (ILSA) comparing the learning outcomes of school students between countries was attempted in the 1960s. However, ILSAs only became established and regular in the late 1990s and 2000s.</p>
<p>The Organisation for Economic Co-operation and Development’s (OECD) Programme for International Student Assessment (PISA) has tested 15-year-old students in a range of “literacies” or “competencies” every three years since 2000. There is a rotating focus on reading, mathematics and science, with PISA 2021 focusing on mathematics but delayed by the global pandemic until 2022 and the results only published in December 2023. Until then, PISA 2018, with a focus on reading, was the most recently available cycle and PISA 2015 remains the most recent cycle focusing on science.</p>
<p>In addition to reading, mathematics and science, PISA has tested students on a range of “novel” competencies including problem-solving, global competence, financial literacy, and creative thinking. In addition to these tests, PISA also administers questionnaires to students, teachers and parents to identify “factors” which explain test score differences within and between countries.</p>
<p>Since 2000, more than 90 “countries and economies” and around 3,000,000 students have participated in PISA. The growth in the number of countries participating in each cycle of PISA is reflected in the growth in the number of students taking the PISA tests and responding to the PISA questionnaires, as shown in Table 1.</p>
<p>Table 1: Number of students participating in PISA by year</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Year</th>
<th>Number completing assessment</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2000</td>
<td>265,000</td>
</tr>
<tr class="even">
<td>2003</td>
<td>275,000</td>
</tr>
<tr class="odd">
<td>2006</td>
<td>400,000</td>
</tr>
<tr class="even">
<td>2009</td>
<td>470,000</td>
</tr>
<tr class="odd">
<td>2012</td>
<td>510,000</td>
</tr>
<tr class="even">
<td>2015</td>
<td>540,000</td>
</tr>
<tr class="odd">
<td>2018</td>
<td>600,000</td>
</tr>
<tr class="even">
<td>2022</td>
<td>690,000</td>
</tr>
</tbody>
</table>
<p>There is a degree of inherent error in all educational and psychological assessments - and indeed in all social or physical measurement. ILSAs such as PISA may be more prone to error because their comparisons across large and diverse populations make them particularly complex. However, it is particularly important to minimise the error in ILSAs because they influence education policy and practice across a large number of education systems, impacting a vast population of students beyond those sampled for the assessments.</p>
<p>According to the <span class="citation" data-cites="OECD2019results">OECD (<a href="#ref-OECD2019results" role="doc-biblioref">2019</a>)</span>, three sources of error are worth considering. First, sampling error, uncertainty in the degree to which results from the sample generalise to the wider population - in 2018, the OECD average sampling error was 0.4 of a PISA point score (the value was not reported for 2022). Second, measurement error, uncertainty in the extent to which test items measure proficiency. In 2018, the measurement error was around 0.8 of a point in mathematics and science and 0.5 of a score point in reading (the measurement error was not reported for 2022). Third, the link error is the uncertainty in comparison between scores in different years. For comparisons of science scores between 2018 and 2015, the link error is 1.5 points. For 2018-2022, the link errors are reading (1.47), mathematics (2.24) and science (1.61) <span class="citation" data-cites="OECD2022results">(<a href="#ref-OECD2022results" role="doc-biblioref">OECD 2022, 293</a>)</span></p>
<p>PISA uses a probabilistic, stratified clustered survey design <span class="citation" data-cites="jerrim2017weight">(<a href="#ref-jerrim2017weight" role="doc-biblioref">Jerrim et al. 2017</a>)</span>. However, sampling issues including sample representativeness, non-response rates and population coverage have been identified <span class="citation" data-cites="zieger2022conditioning rutkowski2016call gillis2016pisa hopmann2007pisa">(<a href="#ref-zieger2022conditioning" role="doc-biblioref">Zieger et al. 2022</a>; <a href="#ref-rutkowski2016call" role="doc-biblioref">Rutkowski and Rutkowski 2016</a>; <a href="#ref-gillis2016pisa" role="doc-biblioref">Gillis, Polesel, and Wu 2016</a>; <a href="#ref-hopmann2007pisa" role="doc-biblioref">Hopmann, Brinek, and Retzl 2007</a>)</span>. Furthermore, <span class="citation" data-cites="anders2021canada">Anders et al. (<a href="#ref-anders2021canada" role="doc-biblioref">2021</a>)</span> and <span class="citation" data-cites="jerrim2021pisa">Jerrim (<a href="#ref-jerrim2021pisa" role="doc-biblioref">2021</a>)</span> have shown that assumptions for imputing values (imputing means estimating any missing values based on existing data - for example by adding a mean or mode score for a missing test) for non-participating students used to construct the sample may have significant impacts on achievement scores.</p>
<p>Since PISA 2015, the majority of participating countries have switched from paper-based assessment to computer-based assessment <span class="citation" data-cites="jerrim2016pisa">(<a href="#ref-jerrim2016pisa" role="doc-biblioref">Jerrim 2016</a>)</span>. A randomised controlled trial conducted by the OECD prior to the switch indicated a difference in score between the two modes of delivery. The OECD introduced an adjustment to compensate for this difference, but it is not entirely removed by the adjustment <span class="citation" data-cites="jerrim2016pisa">Jerrim et al. (<a href="#ref-jerrim2018pisa" role="doc-biblioref">2018</a>)</span>, with implications for any time series comparisons between PISA cycles. Nonetheless, Jerrim <span class="citation" data-cites="jerrim2016pisa">(<a href="#ref-jerrim2016pisa" role="doc-biblioref">2016</a>)</span> notes that “in terms of cross-country rankings, there remains a high degree of consistency… the vast majority of countries are simply ‘shifted’ by a uniform amount” (pp.&nbsp;508-509).</p>
<p>In summary, comparisons within and between countries and comparisons over time using ILSAs need careful interpretations that bear in mind the specific design of each ILSA. In practice, this means considering a range of potential explanations for score differences. Does a difference in science ranking between two countries simply reflect sampling error? Does the same parental occupation or home possessions amount to the same economic, social and cultural status in different countries (e.g.&nbsp;the social status of a parent as a teacher or the economic status of the number of cars a family owns)? Does a difference in mathematical self-efficacy (i.e.&nbsp;student self-confidence in mathematics) between the USA and Japan reflect sociocultural differences in self-enhancement and modesty, respectively? How do score differences between boys and girls indicate gender inequalities in education that reflect wider society?</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>For useful critique and discussion of the construction of the measure of socio-economic status in PISA data see: Avvisati’s <span class="citation" data-cites="avvisati2020measure">(<a href="#ref-avvisati2020measure" role="doc-biblioref">2020</a>)</span> paper.</p>
</div>
</div>
</section>
<section id="a-reminder-about-summarising-data-graphing-and-categorising" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="a-reminder-about-summarising-data-graphing-and-categorising"><span class="header-section-number">1.3</span> A reminder about summarising data, graphing and categorising</h2>
<section id="summarising-data" class="level3" data-number="1.3.1">
<h3 data-number="1.3.1" class="anchored" data-anchor-id="summarising-data"><span class="header-section-number">1.3.1</span> Summarising data</h3>
<p>Recall you can use <code>group_by</code> and <code>summarise</code> to group individual student measures and find means and standard deviations for countries. For example, to find the mean wealth scores for the countries, and rank in descending order, we first select the variables of interest <code>CNT</code> and <code>HOMEPOS</code> (home possessions, a proxy for wealth), then <code>group_by</code> <code>CNT</code> and <code>summarise</code> to get the mean. As there are some NA values, we need to include <code>na.rm=TRUE</code> to tell <code>summarise</code> to ignore the missing values. Finally, we <code>arrange</code> in descending order by the new variable we create <code>meanwealth</code>. We can do the same and add a calculation to get the standard deviation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-2"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-2-1"><a href="#annotated-cell-2-1"></a><span class="co"># Create a data frame of PISA 2022 data of country mean wealth</span></span>
<span id="annotated-cell-2-2"><a href="#annotated-cell-2-2"></a></span>
<span id="annotated-cell-2-3"><a href="#annotated-cell-2-3"></a>PISA2022WealthRank <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-2-4" class="code-annotation-target"><a href="#annotated-cell-2-4"></a>  <span class="fu">select</span>(CNT, HOMEPOS) <span class="sc">%&gt;%</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-2-5" class="code-annotation-target"><a href="#annotated-cell-2-5"></a>  <span class="fu">group_by</span>(CNT) <span class="sc">%&gt;%</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-2-6" class="code-annotation-target"><a href="#annotated-cell-2-6"></a>  <span class="fu">summarise</span>(<span class="at">meanwealth =</span> <span class="fu">mean</span>(HOMEPOS, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-2-7" class="code-annotation-target"><a href="#annotated-cell-2-7"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(meanwealth))</span>
<span id="annotated-cell-2-8"><a href="#annotated-cell-2-8"></a></span>
<span id="annotated-cell-2-9"><a href="#annotated-cell-2-9"></a>PISA2022WealthRank</span>
<span id="annotated-cell-2-10"><a href="#annotated-cell-2-10"></a></span>
<span id="annotated-cell-2-11"><a href="#annotated-cell-2-11"></a><span class="co"># With standard deviations</span></span>
<span id="annotated-cell-2-12"><a href="#annotated-cell-2-12"></a></span>
<span id="annotated-cell-2-13"><a href="#annotated-cell-2-13"></a>PISA2022WealthRank <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-2-14"><a href="#annotated-cell-2-14"></a>  <span class="fu">select</span>(CNT, HOMEPOS) <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-2-15"><a href="#annotated-cell-2-15"></a>  <span class="fu">group_by</span>(CNT) <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-2-16"><a href="#annotated-cell-2-16"></a>  <span class="fu">summarise</span>(<span class="at">meanwealth =</span> <span class="fu">mean</span>(HOMEPOS, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),  </span>
<span id="annotated-cell-2-17"><a href="#annotated-cell-2-17"></a>            <span class="at">sdwealth=</span><span class="fu">sd</span>(HOMEPOS, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-2-18"><a href="#annotated-cell-2-18"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(meanwealth)) </span>
<span id="annotated-cell-2-19"><a href="#annotated-cell-2-19"></a></span>
<span id="annotated-cell-2-20"><a href="#annotated-cell-2-20"></a>PISA2022WealthRank</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-2" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="4" data-code-annotation="2">line 2 - select the variables of interest</span>
</dd>
<dt data-target-cell="annotated-cell-2" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="5" data-code-annotation="3">line 3 - treat the data as grouped by country (<code>group_by(CNT)</code>)</span>
</dd>
<dt data-target-cell="annotated-cell-2" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="6" data-code-annotation="4">line 4 - summarise to calculate the mean score of <code>HOMEPOS</code> in a new column <code>meanwealth</code>, setting <code>na.rm=TRUE</code> to ignore NA values</span>
</dd>
<dt data-target-cell="annotated-cell-2" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="7" data-code-annotation="5">line 5 - arrange in descending order by <code>meanwealth</code></span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 80 × 2
   CNT         meanwealth
   &lt;fct&gt;            &lt;dbl&gt;
 1 Norway           0.547
 2 Australia        0.483
 3 Korea            0.371
 4 New Zealand      0.367
 5 Canada           0.348
 6 Iceland          0.346
 7 Sweden           0.327
 8 Ireland          0.318
 9 Malta            0.308
10 Austria          0.280
# ℹ 70 more rows
# A tibble: 80 × 3
   CNT         meanwealth sdwealth
   &lt;fct&gt;            &lt;dbl&gt;    &lt;dbl&gt;
 1 Norway           0.547    0.970
 2 Australia        0.483    0.861
 3 Korea            0.371    1.01 
 4 New Zealand      0.367    0.862
 5 Canada           0.348    0.867
 6 Iceland          0.346    0.805
 7 Sweden           0.327    0.878
 8 Ireland          0.318    0.818
 9 Malta            0.308    0.857
10 Austria          0.280    0.938
# ℹ 70 more rows</code></pre>
</div>
</div>
</section>
<section id="bar-charts" class="level3" data-number="1.3.2">
<h3 data-number="1.3.2" class="anchored" data-anchor-id="bar-charts"><span class="header-section-number">1.3.2</span> Bar charts</h3>
<p>Recall you can use <code>geom_bar</code> to plot a bar graph. For example, if we wanted to plot the <code>PISA2022WealthRank</code> data frame we just created, we pass the data to <code>ggplot</code>. Recall that if you are passing <code>geom_bar</code> the exact values you want to plot, rather than making it count (for example, by including the original dataset with all student entries), you need to specify <code>geom_bar(stat='identity')</code></p>
<p>I have added <code>+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))</code> which rotates the text on the x-axis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-3"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-3-1"><a href="#annotated-cell-3-1"></a><span class="co"># Plot a bar graph of wealth by country</span></span>
<span id="annotated-cell-3-2"><a href="#annotated-cell-3-2"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-3-3" class="code-annotation-target"><a href="#annotated-cell-3-3"></a><span class="fu">ggplot</span>(PISA2022WealthRank, <span class="fu">aes</span>(<span class="at">x =</span> CNT, <span class="at">y =</span> meanwealth)) <span class="sc">+</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-3-4" class="code-annotation-target"><a href="#annotated-cell-3-4"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">'identity'</span>) <span class="sc">+</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-3-5" class="code-annotation-target"><a href="#annotated-cell-3-5"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-3" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="3" data-code-annotation="1">line 1 - pass the <code>PISA2022WealthRank</code> to <code>ggplot</code> and set the x and y variables</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="4" data-code-annotation="2">line 2 - as the data are already summarised, we don’t want <code>geom_bar</code> to count items, but tell it to just plot the data as it is</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="5" data-code-annotation="3">line 3 - rotate the x-axis text</span>
</dd>
</dl>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Introduction_to_PISA_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>We can improve this plot by reordering the x-axis to rank the countries - we switch <code>x=CNT</code> to <code>x=reorder(CNT, -meanwealth)</code> that is we reorder the x axis based on descending (indicated by the minus sign <code>-meanwealth</code>) meanwealth.</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-4"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-4-1"><a href="#annotated-cell-4-1"></a><span class="co"># Plot the wealth data frame as a bar graph, reordering the x axis by wealth</span></span>
<span id="annotated-cell-4-2"><a href="#annotated-cell-4-2"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-4-3" class="code-annotation-target"><a href="#annotated-cell-4-3"></a><span class="fu">ggplot</span>(PISA2022WealthRank, <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">reorder</span>(CNT, <span class="sc">-</span>meanwealth), <span class="at">y =</span> meanwealth)) <span class="sc">+</span></span>
<span id="annotated-cell-4-4"><a href="#annotated-cell-4-4"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">'identity'</span>) <span class="sc">+</span></span>
<span id="annotated-cell-4-5"><a href="#annotated-cell-4-5"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust =</span> <span class="dv">1</span>))       </span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-4" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="3" data-code-annotation="1">line 1 - rather than simply specifying the x axis (e.g.&nbsp;<code>x=CNT</code>) to change the order of the x-axis by the <code>meanwealth</code> score we can use <code>x=reorder(CNT, -meanwealth)</code>. Note the <code>-</code> before <code>meanwealth</code> sets the order is descending.</span>
</dd>
</dl>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Introduction_to_PISA_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>If you like, you can add colour, tidy up the axis labels, and give a title:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-5"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-5-1"><a href="#annotated-cell-5-1"></a><span class="co"># Plot the wealth data frame as a bar graph, reordering the x axis by wealth</span></span>
<span id="annotated-cell-5-2"><a href="#annotated-cell-5-2"></a></span>
<span id="annotated-cell-5-3"><a href="#annotated-cell-5-3"></a><span class="fu">ggplot</span>(PISA2022WealthRank, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(CNT, <span class="sc">-</span>meanwealth), </span>
<span id="annotated-cell-5-4"><a href="#annotated-cell-5-4"></a>                               <span class="at">y =</span> meanwealth)) <span class="sc">+</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-5-5" class="code-annotation-target"><a href="#annotated-cell-5-5"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">'identity'</span>, <span class="at">fill =</span> <span class="st">"skyblue"</span>) <span class="sc">+</span></span>
<span id="annotated-cell-5-6"><a href="#annotated-cell-5-6"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-5-7" class="code-annotation-target"><a href="#annotated-cell-5-7"></a>  <span class="fu">ggtitle</span>(<span class="st">"Countries ranked by HOMEPOS"</span>) <span class="sc">+</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="6" onclick="event.preventDefault();">6</a><span id="annotated-cell-5-8" class="code-annotation-target"><a href="#annotated-cell-5-8"></a>  <span class="fu">xlab</span>(<span class="st">"Country"</span>) <span class="sc">+</span></span>
<span id="annotated-cell-5-9"><a href="#annotated-cell-5-9"></a>  <span class="fu">ylab</span>(<span class="st">"Mean HOMEPOS"</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-5" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="5" data-code-annotation="3">line 3 - set the bar fill colour to sky blue (<code>fill = "skyblue"</code>)</span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="7" data-code-annotation="5">line 6 - set the x-axis title</span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="8" data-code-annotation="6">line 7 - set the y-axis title</span>
</dd>
</dl>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Introduction_to_PISA_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="scatter-plots" class="level3" data-number="1.3.3">
<h3 data-number="1.3.3" class="anchored" data-anchor-id="scatter-plots"><span class="header-section-number">1.3.3</span> Scatter plots</h3>
<p>To plot a scatter plot, recall we use <code>geom_point</code>. For example, to plot reading scores against mathematics scores in the UK we: a) create a data set of reading and science scores after filtering for UK; b) pass the data to <code>ggplot</code>; c) use <code>aes</code> to specify the x and y variables and d) plot with <code>geom_point()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># Create a data.frame of the UK's science and reading scores</span></span>
<span id="cb3-2"><a href="#cb3-2"></a></span>
<span id="cb3-3"><a href="#cb3-3"></a>UKplot <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb3-4"><a href="#cb3-4"></a>  <span class="fu">select</span>(CNT, PV1READ, PV1SCIE) <span class="sc">%&gt;%</span></span>
<span id="cb3-5"><a href="#cb3-5"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span>)</span>
<span id="cb3-6"><a href="#cb3-6"></a></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="co"># Plot the data on a scatter graph using geom_point</span></span>
<span id="cb3-8"><a href="#cb3-8"></a></span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="fu">ggplot</span>(UKplot, <span class="fu">aes</span>(<span class="at">x =</span> PV1READ, <span class="at">y =</span> PV1SCIE)) <span class="sc">+</span></span>
<span id="cb3-10"><a href="#cb3-10"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Introduction_to_PISA_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>That graph is quite dense, so we can use the <code>alpha</code> function to make the points slightly transparent, <code>size</code> to make them smaller, and set their colour. I will also tidy up the axis names and add a line (note that in: <code>geom_smooth(method = "lm", colour = "black")</code> <code>method = "lm"</code> sets the line to a straight (i.e., linear model, lm) line).</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-7"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-7-1"><a href="#annotated-cell-7-1"></a><span class="co"># Create a data.frame of the UK's science and reading scores</span></span>
<span id="annotated-cell-7-2"><a href="#annotated-cell-7-2"></a></span>
<span id="annotated-cell-7-3"><a href="#annotated-cell-7-3"></a>UKplot <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-7-4"><a href="#annotated-cell-7-4"></a>  <span class="fu">select</span>(CNT, PV1READ, PV1SCIE) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-7-5"><a href="#annotated-cell-7-5"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span>)</span>
<span id="annotated-cell-7-6"><a href="#annotated-cell-7-6"></a></span>
<span id="annotated-cell-7-7"><a href="#annotated-cell-7-7"></a><span class="co"># Plot the data on a scatter graph using geom_point</span></span>
<span id="annotated-cell-7-8"><a href="#annotated-cell-7-8"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-7-9" class="code-annotation-target"><a href="#annotated-cell-7-9"></a><span class="fu">ggplot</span>(UKplot, <span class="fu">aes</span>(<span class="at">x =</span> PV1READ, <span class="at">y =</span> PV1SCIE)) <span class="sc">+</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-7-10" class="code-annotation-target"><a href="#annotated-cell-7-10"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">size =</span> <span class="fl">0.1</span>, <span class="at">colour =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="6" onclick="event.preventDefault();">6</a><span id="annotated-cell-7-11" class="code-annotation-target"><a href="#annotated-cell-7-11"></a>  <span class="fu">xlab</span>(<span class="st">"Reading score"</span>) <span class="sc">+</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="7" onclick="event.preventDefault();">7</a><span id="annotated-cell-7-12" class="code-annotation-target"><a href="#annotated-cell-7-12"></a>  <span class="fu">ylab</span>(<span class="st">"Science score"</span>) <span class="sc">+</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="8" onclick="event.preventDefault();">8</a><span id="annotated-cell-7-13" class="code-annotation-target"><a href="#annotated-cell-7-13"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">colour =</span> <span class="st">"black"</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-7" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="9" data-code-annotation="4">line 4 - set the data to plot and set which variable goes on the x and y axis</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="10" data-code-annotation="5">line 5 - set the point size (<code>size=0.1</code>), colour (<code>colour = "red"</code>) and opacity (<code>alpha = 0.6</code>)</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="11" data-code-annotation="6">line 6 - set the x-axis title</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="7">7</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="12" data-code-annotation="7">line 7 - set the y-axis title</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="8">8</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="13" data-code-annotation="8">line 8 - plot a straight line (<code>method = "lm"</code>) and set its colour to black</span>
</dd>
</dl>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Introduction_to_PISA_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="density-plots" class="level3" data-number="1.3.4">
<h3 data-number="1.3.4" class="anchored" data-anchor-id="density-plots"><span class="header-section-number">1.3.4</span> Density plots</h3>
<p>An alternative type of plot is the density plot, which is a kind of continuous histogram. The density plot can be useful for visualising the achievement scores of students. For example, the mathematics scores of girls and boys (recall the gender variable is <code>ST004D01T</code>) in the US. We use <code>na.omit</code> to omit <code>NA</code>s. Notice, for the plot, I use <code>aes</code> to set my x variable, and then specify that the plot should fill by gender (<code>fill=ST004D01T</code>). Finally, in <code>geom_density(alpha=0.6)</code> I set the alpha to 0.6 to make the fill areas partially transparent.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>The y-axis on a density plot is chosen so that the total area under the graph adds up to 1</p>
</div>
</div>
<div class="cell" data-eva="true">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># Create a data.frame of US Math data including gender</span></span>
<span id="cb4-2"><a href="#cb4-2"></a></span>
<span id="cb4-3"><a href="#cb4-3"></a>USMathplot <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb4-4"><a href="#cb4-4"></a>  <span class="fu">select</span>(CNT, PV1MATH, ST004D01T) <span class="sc">%&gt;%</span></span>
<span id="cb4-5"><a href="#cb4-5"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United States"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-6"><a href="#cb4-6"></a>  <span class="fu">na.omit</span>()</span>
<span id="cb4-7"><a href="#cb4-7"></a></span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="co"># PLot a density chart, seeting the fill by gender, and setting the opacity to</span></span>
<span id="cb4-9"><a href="#cb4-9"></a><span class="co"># 0.6 to show both gender plots</span></span>
<span id="cb4-10"><a href="#cb4-10"></a></span>
<span id="cb4-11"><a href="#cb4-11"></a><span class="fu">ggplot</span>(USMathplot, <span class="fu">aes</span>(<span class="at">x =</span> PV1MATH, <span class="at">fill =</span> ST004D01T)) <span class="sc">+</span></span>
<span id="cb4-12"><a href="#cb4-12"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Introduction_to_PISA_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="facet-wrapping---producing-the-same-graph-for-multiple-countries." class="level3" data-number="1.3.5">
<h3 data-number="1.3.5" class="anchored" data-anchor-id="facet-wrapping---producing-the-same-graph-for-multiple-countries."><span class="header-section-number">1.3.5</span> Facet wrapping - producing the same graph for multiple countries.</h3>
<p>A powerful feature of ggplot is being able to produce the same graph for multiple values of a variable, for example, for multiple countries. For example, we may want to produce the density graph of <code>PV1MATH</code> score by gender, for several countries in the data set. To do that, we produce a data set of <code>PV1MATH</code> scores, and gender (<code>ST004D01T</code>) and filter for four countries (Philippines, UK, Bulgaria and Germany). We use the same code as above to plot the graphs but add <code>+facet_wrap(.~CNT)</code> - <code>facet_wrap</code> tells ggplot to produce a multi-panel plot and <code>.~CNT</code> means do the same as above (the <code>.</code> means, as above), but vary across countries (<code>~CNT</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-9"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-9-1"><a href="#annotated-cell-9-1"></a><span class="co"># Create a data.frame of the maths scores for the 4 countries</span></span>
<span id="annotated-cell-9-2"><a href="#annotated-cell-9-2"></a>Mathplot <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-9-3"><a href="#annotated-cell-9-3"></a>  <span class="fu">select</span>(CNT, PV1MATH, ST004D01T) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-9-4"><a href="#annotated-cell-9-4"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"Philippines"</span><span class="sc">|</span>CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span><span class="sc">|</span>CNT <span class="sc">==</span> <span class="st">"Bulgaria"</span> <span class="sc">|</span></span>
<span id="annotated-cell-9-5"><a href="#annotated-cell-9-5"></a>           CNT <span class="sc">==</span> <span class="st">"Germany"</span>)</span>
<span id="annotated-cell-9-6"><a href="#annotated-cell-9-6"></a></span>
<span id="annotated-cell-9-7"><a href="#annotated-cell-9-7"></a><span class="co"># Plot the data, changing colour by gender, and faceting for the countries</span></span>
<span id="annotated-cell-9-8"><a href="#annotated-cell-9-8"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-9" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-9-9" class="code-annotation-target"><a href="#annotated-cell-9-9"></a><span class="fu">ggplot</span>(Mathplot, <span class="fu">aes</span>(<span class="at">x =</span> PV1MATH, <span class="at">fill =</span> ST004D01T)) <span class="sc">+</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-9" data-target-annotation="6" onclick="event.preventDefault();">6</a><span id="annotated-cell-9-10" class="code-annotation-target"><a href="#annotated-cell-9-10"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-9" data-target-annotation="7" onclick="event.preventDefault();">7</a><span id="annotated-cell-9-11" class="code-annotation-target"><a href="#annotated-cell-9-11"></a>  <span class="fu">facet_wrap</span>(. <span class="sc">~</span> CNT)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-9" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-9" data-code-lines="9" data-code-annotation="5">line 5 - pass the data to plot <code>Mathplot</code> and set the x axis (no y is needed for a <code>geom_density</code> plot) - set that we want two series, with the colour set by gender (<code>ST004D01T</code>)</span>
</dd>
<dt data-target-cell="annotated-cell-9" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-9" data-code-lines="10" data-code-annotation="6">line 6 - set fill (<code>alpha = 0.6</code>) so both gender plots are visible where they overlap</span>
</dd>
<dt data-target-cell="annotated-cell-9" data-target-annotation="7">7</dt>
<dd>
<span data-code-cell="annotated-cell-9" data-code-lines="11" data-code-annotation="7">line 7 - <code>facet_wrap</code> repeats the initial graph for some variable. In this case we specify we want the same graph as above (<code>.</code>) but we want to produce versions for each country (<code>~CNT</code>) to give <code>facet_wrap(. ~ CNT)</code></span>
</dd>
</dl>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Introduction_to_PISA_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="categorising-responses" class="level3" data-number="1.3.6">
<h3 data-number="1.3.6" class="anchored" data-anchor-id="categorising-responses"><span class="header-section-number">1.3.6</span> Categorising responses</h3>
<p>A useful analytical choice is to categorise some a numerical variable into ordinal classes. For example, rather than treating <code>HOMEPOS</code> as a continuous scale, you might want to split into high and low wealth groups (for example, those above and below the mean value).</p>
<p>To do this, first calculate the mean <code>mean(HOMEPOS)</code>. Then we add a new vector, which we will call <code>wealthclass</code> using the <code>mutate</code> function. We set the value of <code>wealthclass</code> using <code>case_when</code>. If <code>HOMEPOS</code> is more than the mean score, we set <code>wealthclass</code> to <code>High</code>, and if it is less than the mean, we set it to <code>Low</code>. We do that using <code>mutate(wealthclass =  case_when(HOMEPOS &gt; mean(HOMEPOS, na.rm =TRUE) ~ "High", HOMEPOS &lt; mean(HOMEPOS, na.rm =TRUE) ~ "Low", .default = NA))</code>. This means that in the case when <code>HOMEPOS</code> is more than the mean (note the <code>na.rm =TRUE</code> to remove missing values) the value of the new column <code>wealthclass</code> is set to <code>High</code>. When <code>HOMEPOS</code> is less than <code>mean(HOMEPOS, na.rm =TRUE)</code>, <code>weatlthclass</code> is set to <code>Low</code>. The <code>.default</code> sets what to return if neither of those conditions are met.</p>
<p>For example, create a data frame of UK participants <code>HOMEPOS</code> sorted into <code>HIGH</code> and <code>LOW</code> categories.</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-10"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-10-1"><a href="#annotated-cell-10-1"></a><span class="co"># Create a data frame of UK responses</span></span>
<span id="annotated-cell-10-2"><a href="#annotated-cell-10-2"></a>UKPISA2022 <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-10-3"><a href="#annotated-cell-10-3"></a>  <span class="fu">select</span>(CNT, HOMEPOS) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-10-4"><a href="#annotated-cell-10-4"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span>) <span class="sc">%&gt;%</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-10-5" class="code-annotation-target"><a href="#annotated-cell-10-5"></a>  <span class="fu">mutate</span>(<span class="at">wealthclass =</span>  <span class="fu">case_when</span>(HOMEPOS <span class="sc">&gt;</span> <span class="fu">mean</span>(HOMEPOS, <span class="at">na.rm =</span><span class="cn">TRUE</span>) <span class="sc">~</span> <span class="st">"High"</span>,</span>
<span id="annotated-cell-10-6"><a href="#annotated-cell-10-6"></a>                                  HOMEPOS <span class="sc">&lt;</span> <span class="fu">mean</span>(HOMEPOS, <span class="at">na.rm =</span><span class="cn">TRUE</span>) <span class="sc">~</span> <span class="st">"Low"</span>,</span>
<span id="annotated-cell-10-7"><a href="#annotated-cell-10-7"></a>                                   <span class="at">.default =</span> <span class="cn">NA</span>)) </span>
<span id="annotated-cell-10-8"><a href="#annotated-cell-10-8"></a>UKPISA2022</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-10" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="5" data-code-annotation="4">line 4 - mutate to create a new column <code>wealthclass</code> - if HOMEPOS is more than mean(HOMEPOS), set the column to “High” otherwise set it to “Low”</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12,972 × 3
   CNT            HOMEPOS wealthclass
   &lt;fct&gt;            &lt;dbl&gt; &lt;chr&gt;      
 1 United Kingdom  -1.09  Low        
 2 United Kingdom  -0.418 Low        
 3 United Kingdom   1.13  High       
 4 United Kingdom  -0.829 Low        
 5 United Kingdom  -0.274 Low        
 6 United Kingdom  NA     &lt;NA&gt;       
 7 United Kingdom  -0.606 Low        
 8 United Kingdom  NA     &lt;NA&gt;       
 9 United Kingdom   0.425 High       
10 United Kingdom   0.998 High       
# ℹ 12,962 more rows</code></pre>
</div>
</div>
</section>
</section>
<section id="seminar-activities" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="seminar-activities"><span class="header-section-number">1.4</span> Seminar activities</h2>
<section id="task-1-discussion-activity" class="level3" data-number="1.4.1">
<h3 data-number="1.4.1" class="anchored" data-anchor-id="task-1-discussion-activity"><span class="header-section-number">1.4.1</span> Task 1 Discussion activity</h3>
<div class="question">
<ul>
<li>Discuss the design features of PISA (for example, sampling, forms of tests etc.) and the sources of error that arise from them.</li>
<li>As researchers, what issues should we bear in mind when interpreting the data? (Consider, for example, measures of wealth, gender and “competency”)</li>
<li>What caveats should policy makers bear in mind when making high stakes decisions based on the PISA measures (for example, what to include to curricula, where to target funding)?</li>
</ul>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that the PISA data collection protocol allows countries to exclude up to 5% of the relevant population (see the PISA 2018 technical report <span class="citation" data-cites="OECD2018technical">(<a href="#ref-OECD2018technical" role="doc-biblioref">OECD 2018</a>)</span>, Annex A2), in particular allowing the exclusion from the data of either individual students by their disability status, or whole schools which provide specialist education (e.g.&nbsp;for blind students). Permitted exclusions include: “intellectual disability, i.e.&nbsp;a mental or emotional disability resulting in the student being so cognitively delayed that he/she could not perform in the PISA testing environment”, and “functional disability, i.e.&nbsp;a moderate to severe permanent physical disability resulting in the student being unable to perform in the PISA testing environment” along with other exclusions.</p>
</div>
</div>
</section>
<section id="task-2-create-a-ranked-list" class="level3" data-number="1.4.2">
<h3 data-number="1.4.2" class="anchored" data-anchor-id="task-2-create-a-ranked-list"><span class="header-section-number">1.4.2</span> Task 2 Create a ranked list</h3>
<div class="question">
<p>Create a ranked list of countries by their mean science scores (<code>PV1SCIE</code>). What are the top five countries for science? Do the same for wealth (<code>HOMEPOS</code>). What patterns do you notice? Why might a researcher be critical of such rankings [Extension: Include the standard deviation of each country (hint: use the <code>sd</code> function) - can you detect any patterns?]</p>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that the PISA 2022 links wealth to <code>HOMEPOS</code> (a self reported measure of possessions in the home). You might want to consider the implications of that definition for interpreting the data</p>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the answer</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># Create a ranked data data frame for science</span></span>
<span id="cb6-2"><a href="#cb6-2"></a></span>
<span id="cb6-3"><a href="#cb6-3"></a>PISA2022SciRank <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4"></a>  <span class="fu">select</span>(CNT, PV1SCIE) <span class="sc">%&gt;%</span> <span class="co"># Select variables of interest</span></span>
<span id="cb6-5"><a href="#cb6-5"></a>  <span class="fu">group_by</span>(CNT) <span class="sc">%&gt;%</span> <span class="co"># group by country</span></span>
<span id="cb6-6"><a href="#cb6-6"></a>  <span class="fu">summarise</span>(<span class="at">meansci =</span> <span class="fu">mean</span>(PV1SCIE)) <span class="sc">%&gt;%</span> </span>
<span id="cb6-7"><a href="#cb6-7"></a>     <span class="co"># summarise  country data to find the mean Sci score</span></span>
<span id="cb6-8"><a href="#cb6-8"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(meansci)) <span class="co"># arrange in descending order based on the meansci score</span></span>
<span id="cb6-9"><a href="#cb6-9"></a></span>
<span id="cb6-10"><a href="#cb6-10"></a><span class="fu">print</span>(PISA2022SciRank)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 80 × 2
   CNT               meansci
   &lt;fct&gt;               &lt;dbl&gt;
 1 Singapore            561.
 2 Japan                546.
 3 Macao (China)        543.
 4 Korea                531.
 5 Estonia              527.
 6 Chinese Taipei       527.
 7 Hong Kong (China)    525.
 8 Czech Republic       511.
 9 Australia            508.
10 Poland               505.
# ℹ 70 more rows</code></pre>
</div>
<details class="code-fold">
<summary>Show the answer</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># And repeat the ranking for wealth</span></span>
<span id="cb8-2"><a href="#cb8-2"></a></span>
<span id="cb8-3"><a href="#cb8-3"></a>PISA2022WealthRank <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb8-4"><a href="#cb8-4"></a>  <span class="fu">select</span>(CNT, HOMEPOS) <span class="sc">%&gt;%</span> <span class="co"># Select variables of interest</span></span>
<span id="cb8-5"><a href="#cb8-5"></a>  <span class="fu">group_by</span>(CNT) <span class="sc">%&gt;%</span> <span class="co"># group by country</span></span>
<span id="cb8-6"><a href="#cb8-6"></a>  <span class="fu">summarise</span>(<span class="at">meanwel =</span> <span class="fu">mean</span>(HOMEPOS, <span class="at">na.rm=</span><span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-7"><a href="#cb8-7"></a>     <span class="co"># summarise  country data to find the mean Sci score</span></span>
<span id="cb8-8"><a href="#cb8-8"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(meanwel)) <span class="co"># arrange in descending order based on the meansci score</span></span>
<span id="cb8-9"><a href="#cb8-9"></a></span>
<span id="cb8-10"><a href="#cb8-10"></a><span class="fu">print</span>(PISA2022WealthRank)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 80 × 2
   CNT         meanwel
   &lt;fct&gt;         &lt;dbl&gt;
 1 Norway        0.547
 2 Australia     0.483
 3 Korea         0.371
 4 New Zealand   0.367
 5 Canada        0.348
 6 Iceland       0.346
 7 Sweden        0.327
 8 Ireland       0.318
 9 Malta         0.308
10 Austria       0.280
# ℹ 70 more rows</code></pre>
</div>
<details class="code-fold">
<summary>Show the answer</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># With standard deviations</span></span>
<span id="cb10-2"><a href="#cb10-2"></a></span>
<span id="cb10-3"><a href="#cb10-3"></a>PISA2022SciRank <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb10-4"><a href="#cb10-4"></a>  <span class="fu">select</span>(CNT, PV1SCIE) <span class="sc">%&gt;%</span> <span class="co"># Select variables of interest</span></span>
<span id="cb10-5"><a href="#cb10-5"></a>  <span class="fu">group_by</span>(CNT) <span class="sc">%&gt;%</span> <span class="co"># group by country</span></span>
<span id="cb10-6"><a href="#cb10-6"></a>  <span class="fu">summarise</span>(<span class="at">meansci =</span> <span class="fu">mean</span>(PV1SCIE), </span>
<span id="cb10-7"><a href="#cb10-7"></a>            <span class="at">sdsci =</span> <span class="fu">sd</span>(PV1SCIE)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-8"><a href="#cb10-8"></a>  <span class="co"># summarise  country data to find the mean Sci score</span></span>
<span id="cb10-9"><a href="#cb10-9"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(meansci)) <span class="co"># arrange in descending order based on the meansci score</span></span>
<span id="cb10-10"><a href="#cb10-10"></a></span>
<span id="cb10-11"><a href="#cb10-11"></a><span class="fu">print</span>(PISA2022SciRank)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 80 × 3
   CNT               meansci sdsci
   &lt;fct&gt;               &lt;dbl&gt; &lt;dbl&gt;
 1 Singapore            561.  99.6
 2 Japan                546.  92.7
 3 Macao (China)        543.  86.6
 4 Korea                531. 104. 
 5 Estonia              527.  87.7
 6 Chinese Taipei       527. 102. 
 7 Hong Kong (China)    525.  91.1
 8 Czech Republic       511. 103. 
 9 Australia            508. 107. 
10 Poland               505.  94.2
# ℹ 70 more rows</code></pre>
</div>
<details class="code-fold">
<summary>Show the answer</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>PISA2022WealthRank <span class="ot">&lt;-</span> PISA_2022<span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>  <span class="fu">select</span>(CNT, HOMEPOS)<span class="sc">%&gt;%</span> <span class="co"># Select variables of interest</span></span>
<span id="cb12-3"><a href="#cb12-3"></a>  <span class="fu">group_by</span>(CNT) <span class="sc">%&gt;%</span> <span class="co"># group by country</span></span>
<span id="cb12-4"><a href="#cb12-4"></a>  <span class="fu">summarise</span>(<span class="at">meanwel =</span> <span class="fu">mean</span>(HOMEPOS, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb12-5"><a href="#cb12-5"></a>            <span class="at">sdwel =</span> <span class="fu">sd</span>(HOMEPOS, <span class="at">na.rm=</span><span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb12-6"><a href="#cb12-6"></a>  <span class="co"># summarise  country data to find  mean wealth score</span></span>
<span id="cb12-7"><a href="#cb12-7"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(meanwel)) </span>
<span id="cb12-8"><a href="#cb12-8"></a>  <span class="co"># arrange in descending order based on the meanwel score</span></span>
<span id="cb12-9"><a href="#cb12-9"></a><span class="fu">print</span>(PISA2022WealthRank)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 80 × 3
   CNT         meanwel sdwel
   &lt;fct&gt;         &lt;dbl&gt; &lt;dbl&gt;
 1 Norway        0.547 0.970
 2 Australia     0.483 0.861
 3 Korea         0.371 1.01 
 4 New Zealand   0.367 0.862
 5 Canada        0.348 0.867
 6 Iceland       0.346 0.805
 7 Sweden        0.327 0.878
 8 Ireland       0.318 0.818
 9 Malta         0.308 0.857
10 Austria       0.280 0.938
# ℹ 70 more rows</code></pre>
</div>
</div>
</section>
<section id="task-3-plot-distributions-of-wealth-scores" class="level3" data-number="1.4.3">
<h3 data-number="1.4.3" class="anchored" data-anchor-id="task-3-plot-distributions-of-wealth-scores"><span class="header-section-number">1.4.3</span> Task 3 Plot distributions of wealth scores</h3>
<div class="question">
<p>Use a scatter plot to show the correlation between <code>HOMEPOS</code> and <code>ESCS</code>. Use a <code>facet_wrap</code> to show the charts for the UK, Japan, Colombia and Sweden. Discuss the different relationships between the two variables across the countries.</p>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that the PISA variable, Economic, Social and Cultural Status <code>ESCS</code> is based on highest parental occupation (‘HISEI’), highest parental education (‘PARED’), and home possessions (‘HOMEPOS’), including books in the home. Do consider the implications of this definition.</p>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the answer</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co"># Create a data frame with the ESCS, gender (ST004D01T) and HOMEPOS variables for the 4 countries </span></span>
<span id="cb14-2"><a href="#cb14-2"></a></span>
<span id="cb14-3"><a href="#cb14-3"></a>WealthcompPISA<span class="ot">&lt;-</span>PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb14-4"><a href="#cb14-4"></a>  <span class="fu">select</span>(CNT, ESCS, HOMEPOS, ST004D01T)<span class="sc">%&gt;%</span></span>
<span id="cb14-5"><a href="#cb14-5"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"Japan"</span> <span class="sc">|</span> CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span> <span class="sc">|</span> CNT <span class="sc">==</span> <span class="st">"Colombia"</span> <span class="sc">|</span> CNT <span class="sc">==</span> <span class="st">"Sweden"</span>)</span>
<span id="cb14-6"><a href="#cb14-6"></a></span>
<span id="cb14-7"><a href="#cb14-7"></a><span class="co"># Use ggplot to create a scatter graph</span></span>
<span id="cb14-8"><a href="#cb14-8"></a><span class="co"># Set the x variable to ESCS and the y to HOMEPOS, set the colour to gender</span></span>
<span id="cb14-9"><a href="#cb14-9"></a><span class="co"># Set point size and transparency</span></span>
<span id="cb14-10"><a href="#cb14-10"></a><span class="co"># Facet wrap to produce graphs for each country</span></span>
<span id="cb14-11"><a href="#cb14-11"></a></span>
<span id="cb14-12"><a href="#cb14-12"></a><span class="fu">ggplot</span>(WealthcompPISA, <span class="fu">aes</span>(<span class="at">x =</span> ESCS, <span class="at">y =</span> HOMEPOS, <span class="at">colour=</span>ST004D01T))<span class="sc">+</span></span>
<span id="cb14-13"><a href="#cb14-13"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="fl">0.1</span>, <span class="at">alpha=</span><span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb14-14"><a href="#cb14-14"></a>  <span class="fu">facet_wrap</span>(.<span class="sc">~</span>CNT)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Introduction_to_PISA_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="task-4-plot-distributions-of-scores" class="level3" data-number="1.4.4">
<h3 data-number="1.4.4" class="anchored" data-anchor-id="task-4-plot-distributions-of-scores"><span class="header-section-number">1.4.4</span> Task 4 Plot distributions of scores</h3>
<div class="question">
<ul>
<li>Use geom_density to plot distributions to plot the distribution of Japanese and UK mathematics scores - what patterns do you notice?</li>
</ul>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>To plot a distribution, you can use <code>geom_density</code> to plot a distribution curve. In <code>ggplot</code> you specify the data, and then in <code>aes</code> set the x-value (the variable of interest, and set the fill to change by different groups). Within the <code>geom_density</code> call you can specify the <code>alpha</code>, the opacity of the plot.</p>
<p>For example, to plot science scores in the UK by gender, you would use the code below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># Create a data frame of UK science scores including gender</span></span>
<span id="cb15-2"><a href="#cb15-2"></a></span>
<span id="cb15-3"><a href="#cb15-3"></a>UKSci<span class="ot">&lt;-</span>PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb15-4"><a href="#cb15-4"></a>  <span class="fu">select</span>(CNT, PV1SCIE, ST004D01T) <span class="sc">%&gt;%</span></span>
<span id="cb15-5"><a href="#cb15-5"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span>)</span>
<span id="cb15-6"><a href="#cb15-6"></a></span>
<span id="cb15-7"><a href="#cb15-7"></a><span class="co"># Plot the density chart, changing colour by gender, and setting the alpha (opacity) to 0.5</span></span>
<span id="cb15-8"><a href="#cb15-8"></a><span class="fu">ggplot</span>(<span class="at">data =</span> UKSci,</span>
<span id="cb15-9"><a href="#cb15-9"></a>       <span class="fu">aes</span>(<span class="at">x =</span> PV1SCIE, <span class="at">fill =</span> ST004D01T)) <span class="sc">+</span></span>
<span id="cb15-10"><a href="#cb15-10"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Introduction_to_PISA_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the answer</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="co"># Create a data frame of UK and Japanese mathematics scores</span></span>
<span id="cb16-2"><a href="#cb16-2"></a></span>
<span id="cb16-3"><a href="#cb16-3"></a>JPUKMath<span class="ot">&lt;-</span>PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb16-4"><a href="#cb16-4"></a>  <span class="fu">select</span>(CNT, PV1MATH) <span class="sc">%&gt;%</span></span>
<span id="cb16-5"><a href="#cb16-5"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span><span class="sc">|</span>CNT <span class="sc">==</span> <span class="st">"Japan"</span>)</span>
<span id="cb16-6"><a href="#cb16-6"></a></span>
<span id="cb16-7"><a href="#cb16-7"></a><span class="co"># Plot the density chart, changing colour by country, and setting the alpha (opacity) to 0.5</span></span>
<span id="cb16-8"><a href="#cb16-8"></a><span class="fu">ggplot</span>(<span class="at">data =</span> JPUKMath,</span>
<span id="cb16-9"><a href="#cb16-9"></a>       <span class="fu">aes</span>(<span class="at">x =</span> PV1MATH, <span class="at">fill =</span> CNT)) <span class="sc">+</span></span>
<span id="cb16-10"><a href="#cb16-10"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Introduction_to_PISA_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="task-5-plot-distributions-of-scores-by-gender" class="level3" data-number="1.4.5">
<h3 data-number="1.4.5" class="anchored" data-anchor-id="task-5-plot-distributions-of-scores-by-gender"><span class="header-section-number">1.4.5</span> Task 5 Plot distributions of scores by gender</h3>
<div class="question">
<ul>
<li>Examine gender differences: Plot the distributions of mathematics achievement in the UK by gender. What patterns can you see?</li>
</ul>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the answer</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>UKMathGender <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>  <span class="fu">select</span>(CNT, PV1MATH, ST004D01T) <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="#cb17-3"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span>)</span>
<span id="cb17-4"><a href="#cb17-4"></a></span>
<span id="cb17-5"><a href="#cb17-5"></a><span class="fu">ggplot</span>(<span class="at">data =</span> UKMathGender,</span>
<span id="cb17-6"><a href="#cb17-6"></a>       <span class="fu">aes</span>(<span class="at">x =</span> PV1MATH, <span class="at">fill =</span> ST004D01T)) <span class="sc">+</span></span>
<span id="cb17-7"><a href="#cb17-7"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Introduction_to_PISA_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="task-6-facet-wrap-by-country" class="level3" data-number="1.4.6">
<h3 data-number="1.4.6" class="anchored" data-anchor-id="task-6-facet-wrap-by-country"><span class="header-section-number">1.4.6</span> Task 6 Facet wrap by country</h3>
<div class="question">
<p>Plot density graphs of gender differences in mathematics scores in the UK, Spain, Japan, Korea and Finland. Hint use <code>facet_wrap(.~CNT)</code></p>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the answer</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="co"># Create a data frame of mathematics scores, gender and country</span></span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="co"># Filter by the five countries of interest</span></span>
<span id="cb18-3"><a href="#cb18-3"></a></span>
<span id="cb18-4"><a href="#cb18-4"></a>MathGender <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb18-5"><a href="#cb18-5"></a>  <span class="fu">select</span>(CNT, PV1MATH, ST004D01T) <span class="sc">%&gt;%</span></span>
<span id="cb18-6"><a href="#cb18-6"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span><span class="sc">|</span>CNT <span class="sc">==</span> <span class="st">"Spain"</span><span class="sc">|</span>CNT <span class="sc">==</span> <span class="st">"Japan"</span></span>
<span id="cb18-7"><a href="#cb18-7"></a>         <span class="sc">|</span> CNT<span class="sc">==</span><span class="st">"Korea"</span><span class="sc">|</span>CNT <span class="sc">==</span> <span class="st">"Finland"</span>)</span>
<span id="cb18-8"><a href="#cb18-8"></a></span>
<span id="cb18-9"><a href="#cb18-9"></a><span class="co"># Plot a density graph of mathematics scores, splitting into groups, with coloured fills by gender. Set transparency to 0.5 to show overlap </span></span>
<span id="cb18-10"><a href="#cb18-10"></a></span>
<span id="cb18-11"><a href="#cb18-11"></a><span class="fu">ggplot</span>(<span class="at">data =</span> MathGender,</span>
<span id="cb18-12"><a href="#cb18-12"></a>       <span class="fu">aes</span>(<span class="at">x =</span> PV1MATH, <span class="at">fill =</span> ST004D01T)) <span class="sc">+</span></span>
<span id="cb18-13"><a href="#cb18-13"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb18-14"><a href="#cb18-14"></a>  <span class="fu">facet_wrap</span>(.<span class="sc">~</span>CNT)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Introduction_to_PISA_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="task-7-plot-a-scatter-graph" class="level3" data-number="1.4.7">
<h3 data-number="1.4.7" class="anchored" data-anchor-id="task-7-plot-a-scatter-graph"><span class="header-section-number">1.4.7</span> Task 7 Plot a scatter graph</h3>
<div class="question">
<p>Plot a scatter graph of mean mathematics achievement (y-axis) by mean wealth (x-axis) with each country as a single point. Hint: You will first need to use <code>group_by</code> and then <code>summarise</code> to create a data frame of mean scores.</p>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that the competency tests for Vietnam in PISA are all <code>NA</code> at the student level. This is because many students finish compulsory schooling before 15. Hence, we add an <code>na.omit</code> to remove the data from Vietnam</p>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the answer</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="co"># Create a summary data frame</span></span>
<span id="cb19-2"><a href="#cb19-2"></a><span class="co"># Group by country, and then summarise the mean meath and wealth scores</span></span>
<span id="cb19-3"><a href="#cb19-3"></a></span>
<span id="cb19-4"><a href="#cb19-4"></a>Wealthdata <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb19-5"><a href="#cb19-5"></a>  <span class="fu">select</span>(CNT, HOMEPOS, PV1MATH) <span class="sc">%&gt;%</span></span>
<span id="cb19-6"><a href="#cb19-6"></a>  <span class="fu">filter</span>(CNT<span class="sc">!=</span><span class="st">"Vietnam"</span>)<span class="sc">%&gt;%</span>  <span class="co"># To cut Vietnam due to lack of data</span></span>
<span id="cb19-7"><a href="#cb19-7"></a>  <span class="fu">group_by</span>(CNT) <span class="sc">%&gt;%</span></span>
<span id="cb19-8"><a href="#cb19-8"></a>  <span class="fu">summarise</span>(<span class="at">MeanWealth=</span><span class="fu">mean</span>(HOMEPOS, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb19-9"><a href="#cb19-9"></a>            <span class="at">MeanMath=</span><span class="fu">mean</span>(PV1MATH, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb19-10"><a href="#cb19-10"></a></span>
<span id="cb19-11"><a href="#cb19-11"></a><span class="co"># Use ggplot to create a scatter graph</span></span>
<span id="cb19-12"><a href="#cb19-12"></a></span>
<span id="cb19-13"><a href="#cb19-13"></a><span class="fu">ggplot</span>(<span class="at">data =</span> Wealthdata,</span>
<span id="cb19-14"><a href="#cb19-14"></a>       <span class="fu">aes</span>(<span class="at">x =</span> MeanWealth, <span class="at">y =</span> MeanMath)) <span class="sc">+</span></span>
<span id="cb19-15"><a href="#cb19-15"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">colour=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb19-16"><a href="#cb19-16"></a>  <span class="fu">xlab</span>(<span class="st">"Home Possessions (Wealth proxy)"</span>) <span class="sc">+</span></span>
<span id="cb19-17"><a href="#cb19-17"></a>  <span class="fu">ylab</span>(<span class="st">"Mathematics score"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Introduction_to_PISA_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<div class="question">
<p>In the previous scatter of mathematics vs wealth scores, highlight outlier countries (any score of over 500) in a different colour. Hint, mutate the data frame to include a label column (by the condition of the maths score being over 550). Then set the colour in ggplot by theis label column.</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the answer</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="co"># Create a summary data frame</span></span>
<span id="cb20-2"><a href="#cb20-2"></a><span class="co"># Group by country, and then summarise the mean math and wealth scores</span></span>
<span id="cb20-3"><a href="#cb20-3"></a></span>
<span id="cb20-4"><a href="#cb20-4"></a>Wealthdata <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb20-5"><a href="#cb20-5"></a>  <span class="fu">select</span>(CNT, HOMEPOS, PV1MATH) <span class="sc">%&gt;%</span></span>
<span id="cb20-6"><a href="#cb20-6"></a>  <span class="fu">group_by</span>(CNT) <span class="sc">%&gt;%</span></span>
<span id="cb20-7"><a href="#cb20-7"></a>  <span class="fu">filter</span>(CNT<span class="sc">!=</span><span class="st">"Vietnam"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb20-8"><a href="#cb20-8"></a>  <span class="fu">summarise</span>(<span class="at">MeanWealth =</span> <span class="fu">mean</span>(HOMEPOS, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb20-9"><a href="#cb20-9"></a>            <span class="at">MeanMath =</span> <span class="fu">mean</span>(PV1MATH, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb20-10"><a href="#cb20-10"></a>  <span class="fu">mutate</span>(<span class="at">label=</span><span class="fu">ifelse</span>(MeanMath <span class="sc">&gt;</span> <span class="dv">500</span>, <span class="st">"Red"</span>, <span class="st">"Blue"</span>)) <span class="co"># mutate to add a label</span></span>
<span id="cb20-11"><a href="#cb20-11"></a><span class="co"># the column label is "Red" if MeanMath &gt; 500 and "Blue" otherwise</span></span>
<span id="cb20-12"><a href="#cb20-12"></a></span>
<span id="cb20-13"><a href="#cb20-13"></a><span class="co"># Use ggplot to create a scatter graph</span></span>
<span id="cb20-14"><a href="#cb20-14"></a></span>
<span id="cb20-15"><a href="#cb20-15"></a><span class="fu">ggplot</span>(<span class="at">data =</span> Wealthdata,</span>
<span id="cb20-16"><a href="#cb20-16"></a>       <span class="fu">aes</span>(<span class="at">x =</span> MeanWealth, <span class="at">y =</span> MeanMath, <span class="at">colour =</span> label)) <span class="sc">+</span></span>
<span id="cb20-17"><a href="#cb20-17"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb20-18"><a href="#cb20-18"></a>  <span class="fu">xlab</span>(<span class="st">"Wealth"</span>) <span class="sc">+</span></span>
<span id="cb20-19"><a href="#cb20-19"></a>  <span class="fu">ylab</span>(<span class="st">"Mathematics score"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Introduction_to_PISA_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<div class="question">
<p>Add the country names as a label to the outliers. Hint: add an additional column <code>labelname</code> to which the country name <code>as.charachter(CNT)</code> is added if the <code>MeanMath</code> score is over 500. Hint: you can use <code>geom_label_repel</code> to add the labels. You can set: <code>(aes(label = labelname), colour = "black", check_overlap = TRUE)</code> to give the source of the lables (<code>labelname</code>) the colour and to force the lables not to overlap.</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the answer</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="co"># Mutate to give a new column labelname, set to the country name (CNT) if Meanmath is over 500, or NA if not.</span></span>
<span id="cb21-2"><a href="#cb21-2"></a>Wealthdata <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="#cb21-3"></a>  <span class="fu">select</span>(CNT, HOMEPOS, PV1MATH) <span class="sc">%&gt;%</span></span>
<span id="cb21-4"><a href="#cb21-4"></a>  <span class="fu">group_by</span>(CNT) <span class="sc">%&gt;%</span></span>
<span id="cb21-5"><a href="#cb21-5"></a>  <span class="fu">filter</span>(CNT<span class="sc">!=</span><span class="st">"Vietnam"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb21-6"><a href="#cb21-6"></a>  <span class="fu">summarise</span>(<span class="at">MeanWealth =</span> <span class="fu">mean</span>(HOMEPOS, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb21-7"><a href="#cb21-7"></a>            <span class="at">MeanMath =</span> <span class="fu">mean</span>(PV1MATH, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb21-8"><a href="#cb21-8"></a>  <span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">ifelse</span>(MeanMath<span class="sc">&gt;</span><span class="dv">500</span>, <span class="st">"Red"</span>, <span class="st">"Blue"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb21-9"><a href="#cb21-9"></a>  <span class="fu">mutate</span>(<span class="at">labelname =</span> <span class="fu">ifelse</span>(MeanMath<span class="sc">&gt;</span><span class="dv">500</span>, <span class="fu">as.character</span>(CNT), <span class="cn">NA</span>))</span>
<span id="cb21-10"><a href="#cb21-10"></a>  </span>
<span id="cb21-11"><a href="#cb21-11"></a><span class="co"># Use geom_label_repel to add the labelname column to the graph</span></span>
<span id="cb21-12"><a href="#cb21-12"></a><span class="fu">ggplot</span>(<span class="at">data =</span> Wealthdata,</span>
<span id="cb21-13"><a href="#cb21-13"></a>       <span class="fu">aes</span>(<span class="at">x =</span> MeanWealth, <span class="at">y =</span> MeanMath, <span class="at">colour =</span> label)) <span class="sc">+</span></span>
<span id="cb21-14"><a href="#cb21-14"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb21-15"><a href="#cb21-15"></a>  <span class="fu">geom_label_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> labelname), </span>
<span id="cb21-16"><a href="#cb21-16"></a>            <span class="at">colour =</span> <span class="st">"black"</span>, </span>
<span id="cb21-17"><a href="#cb21-17"></a>            <span class="at">check_overlap =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb21-18"><a href="#cb21-18"></a>  <span class="fu">xlab</span>(<span class="st">"Wealth"</span>) <span class="sc">+</span></span>
<span id="cb21-19"><a href="#cb21-19"></a>  <span class="fu">ylab</span>(<span class="st">"Mathematics score"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Introduction_to_PISA_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="task-8-plot-likert-responses-using-facet-wrapping" class="level3" data-number="1.4.8">
<h3 data-number="1.4.8" class="anchored" data-anchor-id="task-8-plot-likert-responses-using-facet-wrapping"><span class="header-section-number">1.4.8</span> Task 8 Plot Likert responses using facet wrapping</h3>
<div class="question">
<p>Examine Likert responses by country using facet plot.</p>
<p>For <code>ST125Q01NA</code> - How old were you when you started early childhood education? Plot responses, first, for the whole data set, then facet plot for the UK, Germany, Belgium, Austria, France, Poland, Estonia, Finland and Italy.</p>
<p>• What international differences can you note?</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the answer</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="co"># Create a data frame of childhood education data for the whole data frame </span></span>
<span id="cb22-2"><a href="#cb22-2"></a>ChildhoodEd<span class="ot">&lt;-</span>PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3"></a>  <span class="fu">select</span>(CNT, ST125Q01NA) <span class="sc">%&gt;%</span></span>
<span id="cb22-4"><a href="#cb22-4"></a>  <span class="fu">group_by</span>(CNT)</span>
<span id="cb22-5"><a href="#cb22-5"></a></span>
<span id="cb22-6"><a href="#cb22-6"></a><span class="co"># Plot a bar graph of responses  </span></span>
<span id="cb22-7"><a href="#cb22-7"></a></span>
<span id="cb22-8"><a href="#cb22-8"></a><span class="fu">ggplot</span>(<span class="at">data =</span> ChildhoodEd,</span>
<span id="cb22-9"><a href="#cb22-9"></a>       <span class="fu">aes</span>(<span class="at">x =</span> ST125Q01NA, <span class="at">fill =</span> ST125Q01NA)) <span class="sc">+</span></span>
<span id="cb22-10"><a href="#cb22-10"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb22-11"><a href="#cb22-11"></a>  <span class="fu">xlab</span>(<span class="st">"How old were you when you started early childhood education?"</span>) <span class="sc">+</span></span>
<span id="cb22-12"><a href="#cb22-12"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Introduction_to_PISA_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>Then use faceting to split the plots by country</p>
<div class="cell">
<details class="code-fold">
<summary>Show the answer</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="co"># Repeat filtering for UK, Germany, Belgium, Austria, France, Poland, Estonia, Finland and Italy</span></span>
<span id="cb23-2"><a href="#cb23-2"></a></span>
<span id="cb23-3"><a href="#cb23-3"></a>ChildhoodEd <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb23-4"><a href="#cb23-4"></a>  <span class="fu">select</span>(CNT, ST125Q01NA) <span class="sc">%&gt;%</span></span>
<span id="cb23-5"><a href="#cb23-5"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span><span class="sc">|</span>CNT <span class="sc">==</span> <span class="st">"Germany"</span> <span class="sc">|</span> CNT <span class="sc">==</span> <span class="st">"Belgium"</span></span>
<span id="cb23-6"><a href="#cb23-6"></a>         <span class="sc">|</span> CNT <span class="sc">==</span> <span class="st">"Austria"</span><span class="sc">|</span> CNT <span class="sc">==</span> <span class="st">"France"</span> <span class="sc">|</span> CNT <span class="sc">==</span> <span class="st">"Poland"</span></span>
<span id="cb23-7"><a href="#cb23-7"></a>         <span class="sc">|</span> CNT <span class="sc">==</span> <span class="st">"Estonia"</span> <span class="sc">|</span> CNT<span class="sc">==</span><span class="st">"Finland"</span><span class="sc">|</span> CNT<span class="sc">==</span><span class="st">"Italy"</span>)</span>
<span id="cb23-8"><a href="#cb23-8"></a></span>
<span id="cb23-9"><a href="#cb23-9"></a><span class="co"># Plot the data and facet wrap by country</span></span>
<span id="cb23-10"><a href="#cb23-10"></a></span>
<span id="cb23-11"><a href="#cb23-11"></a><span class="fu">ggplot</span>(<span class="at">data =</span> ChildhoodEd,</span>
<span id="cb23-12"><a href="#cb23-12"></a>       <span class="fu">aes</span>(<span class="at">x =</span> ST125Q01NA, <span class="at">fill =</span> CNT))<span class="sc">+</span></span>
<span id="cb23-13"><a href="#cb23-13"></a>  <span class="fu">geom_bar</span>()<span class="sc">+</span></span>
<span id="cb23-14"><a href="#cb23-14"></a>  <span class="fu">xlab</span>(<span class="st">"How old were you when you started early childhood education?"</span>) <span class="sc">+</span></span>
<span id="cb23-15"><a href="#cb23-15"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb23-16"><a href="#cb23-16"></a>  <span class="fu">facet_wrap</span>(. <span class="sc">~</span> CNT)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Introduction_to_PISA_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="task-9-categorise-homepos-scores" class="level3" data-number="1.4.9">
<h3 data-number="1.4.9" class="anchored" data-anchor-id="task-9-categorise-homepos-scores"><span class="header-section-number">1.4.9</span> Task 9 Categorise <code>HOMEPOS</code> scores</h3>
<div class="question">
<p>Categorising Variables</p>
<p>Split the <code>HOMEPOS</code> variable for the UK and Germany into the following groups:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>HOMEPOS</th>
<th>Name of category</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>&gt;1</td>
<td>Very High</td>
</tr>
<tr class="even">
<td>0&gt;HOMEPOS&lt;1</td>
<td>High</td>
</tr>
<tr class="odd">
<td>0&lt;</td>
<td>Low</td>
</tr>
</tbody>
</table>
<p>Plot bar graphs of participants in these categories for both countries.</p>
<p>• What differences can you observe between the countries?</p>
<p>Hint: You can use <code>mutate</code> with <code>case_when</code> to do the categorisation. For example in combination with teh <code>mutate</code> to create the new column <code>maths_scores_category</code>, we use <code>case_when(PV1MATH &lt; 400 ~ "Low"</code> to set the <code>maths_scores_category</code> to <code>Low</code> when <code>PV1MATH</code> is below 400. Then <code>maths_scores_category</code> becomes High if the score is between 400 and 500 (note the use of <code>&amp;</code> and the repeat of <code>PV1MATH</code>: <code>PV1MATH &gt;= 400 &amp; PV1MATH &gt; 500</code>. Here <code>&lt;=</code> means less than or equal to).</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the answer</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="co"># Create a data frame for the UK and Germany</span></span>
<span id="cb24-2"><a href="#cb24-2"></a><span class="co"># Mutate the wealth_cat (wealth category) column by the boundaries of wealth categories</span></span>
<span id="cb24-3"><a href="#cb24-3"></a>Wealth <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb24-4"><a href="#cb24-4"></a>  <span class="fu">select</span>(CNT, HOMEPOS) <span class="sc">%&gt;%</span></span>
<span id="cb24-5"><a href="#cb24-5"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span> <span class="sc">|</span> CNT <span class="sc">==</span> <span class="st">"Germany"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-6"><a href="#cb24-6"></a>  <span class="fu">mutate</span>(<span class="at">wealth_cat =</span> <span class="fu">case_when</span>(HOMEPOS <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Low"</span>,</span>
<span id="cb24-7"><a href="#cb24-7"></a>                                HOMEPOS <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> HOMEPOS <span class="sc">&lt;</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"High"</span>,</span>
<span id="cb24-8"><a href="#cb24-8"></a>                                HOMEPOS <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Very High"</span>,</span>
<span id="cb24-9"><a href="#cb24-9"></a>                                <span class="at">.default =</span> <span class="cn">NA</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb24-10"><a href="#cb24-10"></a>  <span class="fu">group_by</span>(CNT) <span class="sc">%&gt;%</span></span>
<span id="cb24-11"><a href="#cb24-11"></a>  <span class="fu">droplevels</span>()</span>
<span id="cb24-12"><a href="#cb24-12"></a></span>
<span id="cb24-13"><a href="#cb24-13"></a><span class="co"># You can set the factors to a logical order for plotting</span></span>
<span id="cb24-14"><a href="#cb24-14"></a><span class="co"># The default is alphabetical which gives High, Low, Very High which </span></span>
<span id="cb24-15"><a href="#cb24-15"></a><span class="co"># doesn't make sense</span></span>
<span id="cb24-16"><a href="#cb24-16"></a></span>
<span id="cb24-17"><a href="#cb24-17"></a>Wealth<span class="sc">$</span>wealth_cat <span class="ot">&lt;-</span> <span class="fu">factor</span>(Wealth<span class="sc">$</span>wealth_cat, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Low"</span>, <span class="st">"High"</span>, <span class="st">"Very High"</span>))</span>
<span id="cb24-18"><a href="#cb24-18"></a></span>
<span id="cb24-19"><a href="#cb24-19"></a><span class="co"># Plot the data</span></span>
<span id="cb24-20"><a href="#cb24-20"></a><span class="fu">ggplot</span>(<span class="at">data =</span> Wealth, </span>
<span id="cb24-21"><a href="#cb24-21"></a>       <span class="fu">aes</span>(<span class="at">x =</span> wealth_cat, <span class="at">fill =</span> wealth_cat))<span class="sc">+</span></span>
<span id="cb24-22"><a href="#cb24-22"></a>  <span class="fu">geom_bar</span>()<span class="sc">+</span></span>
<span id="cb24-23"><a href="#cb24-23"></a>  <span class="fu">facet_wrap</span>(.<span class="sc">~</span>CNT)<span class="sc">+</span></span>
<span id="cb24-24"><a href="#cb24-24"></a>  <span class="fu">xlab</span>(<span class="st">"Wealth grouping"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Introduction_to_PISA_files/figure-html/loading_data_wealth-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="task-10-compare-the-association-between-mathematics-and-science-pv-values-across-three-diverse-countries" class="level3" data-number="1.4.10">
<h3 data-number="1.4.10" class="anchored" data-anchor-id="task-10-compare-the-association-between-mathematics-and-science-pv-values-across-three-diverse-countries"><span class="header-section-number">1.4.10</span> Task 10 Compare the association between mathematics and science PV values across three diverse countries</h3>
<div class="question">
<p>Plot scatter plots of science versus mathematics achievement in United Kingdom, Qatar and Brazil. What differences can you see between the countries?</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the answer</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="co"># Create a data frame of science and mathematics scores, across the countries Including gender)</span></span>
<span id="cb25-2"><a href="#cb25-2"></a></span>
<span id="cb25-3"><a href="#cb25-3"></a>SciMaths <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb25-4"><a href="#cb25-4"></a>  <span class="fu">select</span>(CNT, PV1MATH, PV1SCIE, ST004D01T) <span class="sc">%&gt;%</span></span>
<span id="cb25-5"><a href="#cb25-5"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"Colombia"</span> <span class="sc">|</span> CNT <span class="sc">==</span> <span class="st">"New Zealand"</span> <span class="sc">|</span> CNT <span class="sc">==</span> <span class="st">"Qatar"</span><span class="sc">|</span></span>
<span id="cb25-6"><a href="#cb25-6"></a>           CNT <span class="sc">==</span> <span class="st">"Israel"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb25-7"><a href="#cb25-7"></a>  <span class="fu">droplevels</span>()</span>
<span id="cb25-8"><a href="#cb25-8"></a></span>
<span id="cb25-9"><a href="#cb25-9"></a><span class="co"># Scatter plot the data, faceting by country</span></span>
<span id="cb25-10"><a href="#cb25-10"></a></span>
<span id="cb25-11"><a href="#cb25-11"></a><span class="fu">ggplot</span>(<span class="at">data =</span> SciMaths, </span>
<span id="cb25-12"><a href="#cb25-12"></a>       <span class="fu">aes</span>(<span class="at">x =</span> PV1MATH, <span class="at">y =</span> PV1SCIE, <span class="at">colour =</span> ST004D01T))<span class="sc">+</span></span>
<span id="cb25-13"><a href="#cb25-13"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">0.1</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb25-14"><a href="#cb25-14"></a>  <span class="fu">facet_wrap</span>(.<span class="sc">~</span>CNT)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Introduction_to_PISA_files/figure-html/loading_data-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the answer</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="co"># Low achieving (filter for scores less than 400)</span></span>
<span id="cb26-2"><a href="#cb26-2"></a></span>
<span id="cb26-3"><a href="#cb26-3"></a>SciMaths <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb26-4"><a href="#cb26-4"></a>  <span class="fu">select</span>(CNT, PV1MATH, PV1SCIE, ST004D01T) <span class="sc">%&gt;%</span></span>
<span id="cb26-5"><a href="#cb26-5"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"Colombia"</span> <span class="sc">|</span> CNT <span class="sc">==</span> <span class="st">"New Zealand"</span> <span class="sc">|</span> CNT <span class="sc">==</span> <span class="st">"Qatar"</span><span class="sc">|</span></span>
<span id="cb26-6"><a href="#cb26-6"></a>           CNT <span class="sc">==</span> <span class="st">"Israel"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb26-7"><a href="#cb26-7"></a>  <span class="fu">filter</span>(PV1MATH <span class="sc">&lt;</span> <span class="dv">400</span>)<span class="sc">%&gt;%</span></span>
<span id="cb26-8"><a href="#cb26-8"></a>  <span class="fu">filter</span>(PV1SCIE <span class="sc">&lt;</span> <span class="dv">400</span>)<span class="sc">%&gt;%</span></span>
<span id="cb26-9"><a href="#cb26-9"></a>  <span class="fu">droplevels</span>()</span>
<span id="cb26-10"><a href="#cb26-10"></a></span>
<span id="cb26-11"><a href="#cb26-11"></a><span class="fu">ggplot</span>(<span class="at">data =</span> SciMaths, </span>
<span id="cb26-12"><a href="#cb26-12"></a>       <span class="fu">aes</span>(<span class="at">x =</span> PV1MATH, <span class="at">y =</span> PV1SCIE, <span class="at">colour =</span> ST004D01T))<span class="sc">+</span></span>
<span id="cb26-13"><a href="#cb26-13"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">0.1</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb26-14"><a href="#cb26-14"></a>  <span class="fu">facet_wrap</span>(.<span class="sc">~</span>CNT)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="04-Introduction_to_PISA_files/figure-html/loading_data-2.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>



</section>
</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-anders2021canada" class="csl-entry" role="listitem">
Anders, Jake, Silvan Has, John Jerrim, Nikki Shure, and Laura Zieger. 2021. <span>“Is Canada Really an Education Superpower? The Impact of Non-Participation on Results from PISA 2015.”</span> <em>Educational Assessment, Evaluation and Accountability</em> 33: 229–49.
</div>
<div id="ref-avvisati2020measure" class="csl-entry" role="listitem">
Avvisati, Francesco. 2020. <span>“The Measure of Socio-Economic Status in PISA: A Review and Some Suggested Improvements.”</span> <em>Large-Scale Assessments in Education</em> 8 (1): 1–37.
</div>
<div id="ref-gillis2016pisa" class="csl-entry" role="listitem">
Gillis, Shelley, John Polesel, and Margaret Wu. 2016. <span>“PISA Data: Raising Concerns with Its Use in Policy Settings.”</span> <em>The Australian Educational Researcher</em> 43: 131–46.
</div>
<div id="ref-hopmann2007pisa" class="csl-entry" role="listitem">
Hopmann, Stefan Thomas, Gertrude Brinek, and Martin Retzl. 2007. <span>“PISA According to PISA: Does PISA Keep What It Promises.”</span> <em>Reihe Schulp<span>ä</span>dagogik Und P<span>ä</span>dagogische Psychologie, Bd</em> 6.
</div>
<div id="ref-jerrim2016pisa" class="csl-entry" role="listitem">
Jerrim, John. 2016. <span>“PISA 2012: How Do Results for the Paper and Computer Tests Compare?”</span> <em>Assessment in Education: Principles, Policy &amp; Practice</em> 23 (4): 495–518.
</div>
<div id="ref-jerrim2021pisa" class="csl-entry" role="listitem">
———. 2021. <span>“PISA 2018 in England, Northern Ireland, Scotland and Wales: Is the Data Really Representative of All Four Corners of the UK?”</span> <em>Review of Education</em> 9 (3): e3270.
</div>
<div id="ref-jerrim2017weight" class="csl-entry" role="listitem">
Jerrim, John, Luis Alejandro Lopez-Agudo, Oscar D Marcenaro-Gutierrez, and Nikki Shure. 2017. <span>“To Weight or Not to Weight?: The Case of PISA Data.”</span> In <em>Proceedings of the XXVI Meeting of the Economics of Education Association, Murcia, Spain</em>, 29–30.
</div>
<div id="ref-jerrim2018pisa" class="csl-entry" role="listitem">
Jerrim, John, John Micklewright, Jorg-Henrik Heine, Christine Salzer, and Caroline McKeown. 2018. <span>“PISA 2015: How Big Is the ‘Mode Effect’and What Has Been Done about It?”</span> <em>Oxford Review of Education</em> 44 (4): 476–93.
</div>
<div id="ref-OECD2018technical" class="csl-entry" role="listitem">
OECD. 2018. <span>“Technical Report.”</span> OECD, Paris. <a href="https://www.oecd.org/pisa/data/pisa2018technicalreport/PISA2018-TecReport-Ch-01-Programme-for-International-Student-Assessment-An-Overview.pdf">https://www.oecd.org/pisa/data/pisa2018technicalreport/PISA2018-TecReport-Ch-01-Programme-for-International-Student-Assessment-An-Overview.pdf</a>.
</div>
<div id="ref-OECD2019results" class="csl-entry" role="listitem">
———. 2019. <em><span>PISA 2018 Results (Volume I)</span></em>. <a href="https://doi.org/10.1787/5f07c754-en">https://doi.org/10.1787/5f07c754-en</a>.
</div>
<div id="ref-OECD2022results" class="csl-entry" role="listitem">
OECD. 2022. <em>PISA 2022 Results (Volume i)</em>. OECD. <a href="https://www.oecd-ilibrary.org/docserver/53f23881-en.pdf">https://www.oecd-ilibrary.org/docserver/53f23881-en.pdf</a>.
</div>
<div id="ref-rutkowski2016call" class="csl-entry" role="listitem">
Rutkowski, Leslie, and David Rutkowski. 2016. <span>“A Call for a More Measured Approach to Reporting and Interpreting PISA Results.”</span> <em>Educational Researcher</em> 45 (4): 252–57.
</div>
<div id="ref-zieger2022conditioning" class="csl-entry" role="listitem">
Zieger, Laura Raffaella, John Jerrim, Jake Anders, and Nikki Shure. 2022. <span>“Conditioning: How Background Variables Can Influence PISA Scores.”</span> <em>Assessment in Education: Principles, Policy &amp; Practice</em> 29 (6): 632–52.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>