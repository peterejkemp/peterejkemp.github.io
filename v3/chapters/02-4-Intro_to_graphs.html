<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>MASTEMR - Making graphs</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><link rel="stylesheet" href="../css/mastemr.css">
</head>
<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg navbar-dark "><div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="index.qmd" class="navbar-brand navbar-brand-logo">
    <img src="../images/KCL_logo.png" alt="" class="navbar-logo"></a>
    <a class="navbar-brand" href="index.qmd">
    <span class="navbar-title">MASTEMR</span>
    </a>
  </div>
        <div class="quarto-navbar-tools ms-auto">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/02-1-Intro_to_analysis_software.html">02 Introduction to R</a></li><li class="breadcrumb-item"><a href="../chapters/02-4-Intro_to_graphs.html">Making graphs</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto"><div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Sessions</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/01-Intro_to_quant_methods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">01 Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">02 Introduction to R</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/02-1-Intro_to_analysis_software.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/02-2-Intro_to_analysis_software.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Loading packages and exploring data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/02-3-Intro_to_analysis_software.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Piping and dplyr</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/02-4-Intro_to_graphs.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Making graphs</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/03-Descriptive.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">03 Descriptive Statistics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/04-Presentations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">04 Presentations</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/05-Introduction_to_PISA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">05 Introduction to PISA</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/06-ChisqPISA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">07 Hypothesis testing and Chi-square tests</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/07-T-testsPISA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">06 T-tests</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/08-Writing_report.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">08 Writing a quantitative report</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/09-Assignment_3_tutorials.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">09 Assignment 3 tutorials</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/10-Correlation_and_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">10 Correlation and regression</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/11-selecting_statistical_tools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">11 Selecting statistical tools</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/12-value_of_quant.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">12 The value of quantitative methods</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/QandA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Questions and Answers</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Additional tests</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A6-Bayesian.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Statistics</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Appendicies</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A1-PISA_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">PISA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A2-DfE_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DfE England</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A3-TIMSS_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TIMSS, PIRLS and ICILS</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A4-Other_datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Other datasets</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A5-Self_Study_Tasks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Appendix Self Study Tasks</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#sec-graphing" id="toc-sec-graphing" class="nav-link active" data-scroll-target="#sec-graphing"><span class="header-section-number">1</span> ggplot</a></li>
  <li>
<a href="#geoms" id="toc-geoms" class="nav-link" data-scroll-target="#geoms"><span class="header-section-number">2</span> geoms</a>
  <ul class="collapse">
<li>
<a href="#sec-geom_point" id="toc-sec-geom_point" class="nav-link" data-scroll-target="#sec-geom_point"><span class="header-section-number">2.1</span> geom_point</a>
  <ul class="collapse">
<li><a href="#questions" id="toc-questions" class="nav-link" data-scroll-target="#questions"><span class="header-section-number">2.1.1</span> Questions</a></li>
  </ul>
</li>
  <li>
<a href="#sec-geom_bar" id="toc-sec-geom_bar" class="nav-link" data-scroll-target="#sec-geom_bar"><span class="header-section-number">2.2</span> geom_bar</a>
  <ul class="collapse">
<li><a href="#raising-the-bars-yourself" id="toc-raising-the-bars-yourself" class="nav-link" data-scroll-target="#raising-the-bars-yourself"><span class="header-section-number">2.2.1</span> Raising the bars yourself</a></li>
  <li><a href="#questions-1" id="toc-questions-1" class="nav-link" data-scroll-target="#questions-1"><span class="header-section-number">2.2.2</span> Questions</a></li>
  </ul>
</li>
  <li><a href="#geom_text" id="toc-geom_text" class="nav-link" data-scroll-target="#geom_text"><span class="header-section-number">2.3</span> geom_text</a></li>
  </ul>
</li>
  <li>
<a href="#faceting" id="toc-faceting" class="nav-link" data-scroll-target="#faceting"><span class="header-section-number">3</span> faceting</a>
  <ul class="collapse">
<li><a href="#exporting-plots" id="toc-exporting-plots" class="nav-link" data-scroll-target="#exporting-plots"><span class="header-section-number">3.1</span> Exporting plots</a></li>
  </ul>
</li>
  <li>
<a href="#additional-support-on-graphing" id="toc-additional-support-on-graphing" class="nav-link" data-scroll-target="#additional-support-on-graphing"><span class="header-section-number">4</span> Additional support on graphing</a>
  <ul class="collapse">
<li><a href="#using-r-to-do-descriptive-statistics-and-plot-graphs" id="toc-using-r-to-do-descriptive-statistics-and-plot-graphs" class="nav-link" data-scroll-target="#using-r-to-do-descriptive-statistics-and-plot-graphs"><span class="header-section-number">4.1</span> Using R to do descriptive statistics and plot graphs</a></li>
  </ul>
</li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">Making graphs</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><p>The tidyverse includes the incredibly powerful <code>ggplot2</code> package. This package is pretty much the industry standard for making graphs for publication. <code>ggplot2</code> is built on the <em>grammar of graphics</em> where you build graphs by specifying underlying attributes and layering geometric objects on top of each other. In the diagram below you can see how a graph is built from <em>geometric objects</em> (the things that are plotted such as points and bars) a <em>scale</em>, and <em>plot annotations</em> (e.g.&nbsp;a key, title etc). You can then apply <em>faceting</em> to the graph to automatically split one graph into multiple plots, allowing you to easily compare different groupings. Publications, such as the Financial Times, make daily use of <code>ggplot2</code>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="http://vita.had.co.nz/papers/layered-grammar.pdf"><img src="images/grammarofgraphics.svg" class="img-fluid figure-img"></a></p>
<figcaption class="figure-caption">Adapted from A Layered Grammar of Graphics, Wickham, 2010</figcaption></figure>
</div>
<section id="sec-graphing" class="level1" data-number="1"><h1 data-number="1">
<span class="header-section-number">1</span> ggplot</h1>
<p>The basic structure of <code>ggplot</code> code is to combine different graphing elements through the use of the <code>+</code> operator. To demonstrate this, let’s look at the relationship between a poverty indicator <code>ESCS</code> and the performance in Maths <code>PV1MATH</code>, by gender <code>ST004D01T</code> and country <code>CNT</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="co"># wrangle our data</span></span>
<span id="cb1-3"><a href="#cb1-3"></a>graph_data <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span> </span>
<span id="cb1-4"><a href="#cb1-4"></a>  <span class="fu">filter</span>(CNT <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"France"</span>, <span class="st">"United Kingdom"</span>))</span>
<span id="cb1-5"><a href="#cb1-5"></a></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="co"># display a graph of the results</span></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="fu">ggplot</span>(<span class="at">data =</span> graph_data, </span>
<span id="cb1-8"><a href="#cb1-8"></a>       <span class="fu">aes</span>(<span class="at">x =</span> ESCS, <span class="at">y =</span> PV1MATH, <span class="at">colour =</span> ST004D01T)) <span class="sc">+</span></span>
<span id="cb1-9"><a href="#cb1-9"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb1-10"><a href="#cb1-10"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">'lm'</span>) <span class="sc">+</span></span>
<span id="cb1-11"><a href="#cb1-11"></a>  <span class="fu">facet_wrap</span>(. <span class="sc">~</span> CNT) <span class="sc">+</span></span>
<span id="cb1-12"><a href="#cb1-12"></a>  <span class="fu">ggtitle</span>(<span class="st">"Comparison of poverty indicator and Maths result, by gender and country"</span>) <span class="sc">+</span></span>
<span id="cb1-13"><a href="#cb1-13"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02-4-Intro_to_graphs_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<p>Hopefully you can work out what lines 1-3 do from the previous chapter, let’s focus on the <code>ggplot</code> commands:</p>
<ul>
<li>6-7 these lines set up the <code>ggplot</code> giving it the table object <code>graph_data</code> as its data input and setting up the aesthetics for the rest of the graph elements using columns from <code>graph_data</code>. The <code>aes(&lt;attribute&gt;, &lt;attribute&gt;, ...)</code> command allows us to specify aesthetic elements of the graph that will change dependent on the dataset we use. In the PISA_2022 data set, the variable <code>ESCS</code> refers to an index of economic status, and <code>PV1Math</code>, is the plausible value of the mathematics score. We set the x and y variables <code>x=ESCS</code> and <code>y=PV1MATH</code> , defining <code>aes()</code> inside <code>ggplot()</code> means we will pass down these values to subsequent geometric objects so we don’t have to define these <code>x</code> and <code>y</code> axis items again and again.</li>
<li>8 using the data and <code>aes</code> values defined on lines 6-7, <code>geom_point</code> uses the <code>x</code> and <code>y</code> values defined on line 19 to draw a point for each school in our dataset. There are lots of different parameters we could give <code>geom_point</code> e.g.&nbsp;specifying size and shape, but here we are content with using the defaults.</li>
<li>9 we add another geometric object on top of the points, this time we add a line of best fit <code>geom_smooth</code>, again this geometric object uses the values specified on lines 6-7, and we define the <code>method</code> as <code>lm</code>, to calculate a <em>linear model</em> line of best fit.</li>
<li>10 next we use <code>facet_wrap(. ~ CNT)</code> to create a graph for each group of <code>CNT</code> in the dataset, i.e.&nbsp;a graph for each country defined on line 3.</li>
<li>11 finally we customise the title of the graph, <code>ggtitle</code>, ready for display.</li>
</ul>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Switching between the pipes and ggplot can get rather confusing. A very common mistake in using ggplot is to try and link together the <code>geom_</code> elements with a pipe command <code>%&gt;%</code> rather than the <code>+</code>.</p>
</div>
</div>
</section><section id="geoms" class="level1" data-number="2"><h1 data-number="2">
<span class="header-section-number">2</span> geoms</h1>
<p>There are about 40 different geometric objects in ggplot, allowing you to create almost any sort of graph. We will be exploring a few of them in detail, but if you want to explore others, please follow some of the links below:</p>
<ul>
<li>
<a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a> for creating bar charts and histograms</li>
<li>
<a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a> for plotting single points</li>
<li>
<a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a> for connecting points together and showing trends</li>
<li>
<a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a> for adding text labels to data points</li>
<li>
<a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a> for representing the range of data</li>
<li>
<a href="https://ggplot2.tidyverse.org/reference/geom_hex.html">geom_hex</a> for creating heat maps</li>
<li>
<a href="https://ggplot2.tidyverse.org/reference/geom_map.html">geom_map</a> for adding geographic maps</li>
<li>
<a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a> for adding lines of best fit</li>
<li>
<a href="https://ggplot2.tidyverse.org/reference/geom_hline.html">geom_hline</a> for adding static horizontal lines to a graph</li>
<li>
<a href="https://ggplot2.tidyverse.org/reference/geom_hline.html">geom_vline</a> for adding static vertical lines to a graph</li>
</ul>
<section id="sec-geom_point" class="level2" data-number="2.1"><h2 data-number="2.1" class="anchored" data-anchor-id="sec-geom_point">
<span class="header-section-number">2.1</span> geom_point</h2>
<p>Rather unsurprisingly, <code>geom_point</code> allows us to plot a layer of <em>points</em> using <code>x</code> and <code>y</code> coordinates. The below example shows how we can specify within the <code>ggplot</code> function <code>data=school_plot_data</code>. We then define the <code>aes</code>thetic attributes of the graph, passing the x <code>x=NumberOfBoys</code> and y <code>y=NumberOfGirls</code> values. Once these have been declared in the <code>ggplot(...)</code> function, their values are passed down to any subsequent <code>geom_</code>, in this case <code>geom_point</code> will use the <code>data</code> and <code>x</code> and <code>y</code> values that have been specified in <code>ggplot(...)</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># create a new dataframe of maths and reading scores by country and OECD status</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>country_plot_data <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span> </span>
<span id="cb2-3"><a href="#cb2-3"></a>  <span class="fu">group_by</span>(OECD, CNT) <span class="sc">%&gt;%</span></span>
<span id="cb2-4"><a href="#cb2-4"></a>  <span class="fu">summarise</span>(<span class="at">mean_maths =</span> <span class="fu">mean</span>(PV1MATH),</span>
<span id="cb2-5"><a href="#cb2-5"></a>            <span class="at">mean_read =</span> <span class="fu">mean</span>(PV1READ),</span>
<span id="cb2-6"><a href="#cb2-6"></a>            <span class="at">sz =</span> <span class="fu">n</span>())</span>
<span id="cb2-7"><a href="#cb2-7"></a></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="co"># using this new dataframe, show the relationship between maths and reading score</span></span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="co"># using geom_points</span></span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="fu">ggplot</span>(<span class="at">data=</span>country_plot_data, </span>
<span id="cb2-11"><a href="#cb2-11"></a>       <span class="fu">aes</span>(<span class="at">x=</span>mean_maths, <span class="at">y=</span>mean_read)) <span class="sc">+</span></span>
<span id="cb2-12"><a href="#cb2-12"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size=</span>sz, <span class="at">colour=</span>OECD), <span class="at">alpha =</span> <span class="fl">0.6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02-4-Intro_to_graphs_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<ul>
<li>In line 2 above we pipe the large data.frame <code>PISA_2022</code> to apply a number of functions.</li>
<li>Line 3 groups by <code>OECD</code> (a Yes or No indicating membership) and <code>CNT</code> (the name of the country).</li>
<li>Lines 4-5 calculate the <code>mean</code> mathematics and reading score, and create new variables (<code>mean_maths</code>, and <code>mean_read</code>) for their values.</li>
<li>In addition, in line 6, the variables <code>sz</code> is created which counts the number of responses per country through the <code>n()</code> command.</li>
<li>This whole pipe is then saved to the <code>country_plot_data</code> object, using the <code>&lt;-</code> on line 2</li>
</ul>
<p>This new dataframe is then passed to <code>ggplot</code>.</p>
<ul>
<li>In line 10, we specify the data that should be plotted - the new dataframe <code>country_plot_data</code> we have created.</li>
<li>Line 11, then we pass the <code>x</code> and <code>y</code> variables, <code>mean_maths</code>, and <code>mean_read</code>, inside the <code>aes</code>thetic function. These values will be passed to any subsequent <code>geom_</code>
</li>
<li>In line 12, we make a number of tweaks to the points: first setting the <code>aes</code>thetics - the <code>size</code> of the points is linked to the <code>sz</code> variable we created, the number of responses per country, and the <code>colour</code> is linked to <code>OECD</code> membership. Finally (and note this is outside the <code>aes</code> brackets, we set an <code>alpha</code> value which makes the point slightly transparent, which is more visually appealing where points overlap.</li>
</ul>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Defining things inside <code>aes</code> mean that they will change with the dataset you use, if you define them outside <code>aes</code> then they will be constant values. For example</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># plotting number of boys as x, number of girls as y and % disadvantaged as size,</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="co"># all inside aes, so each point is a table row</span></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="fu">ggplot</span>(<span class="at">data=</span>PISA_2022_school) <span class="sc">+</span></span>
<span id="cb3-4"><a href="#cb3-4"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> SC002Q01TA,</span>
<span id="cb3-5"><a href="#cb3-5"></a>                 <span class="at">y =</span> SC002Q02TA,</span>
<span id="cb3-6"><a href="#cb3-6"></a>                 <span class="at">size=</span>SC211Q03JA))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02-4-Intro_to_graphs_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># there is an error if we put size outside the aes, and set it a value from the </span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="co"># dataset, it can't find value!</span></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="fu">ggplot</span>(<span class="at">data=</span>PISA_2022_school) <span class="sc">+</span></span>
<span id="cb4-4"><a href="#cb4-4"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> SC002Q01TA,</span>
<span id="cb4-5"><a href="#cb4-5"></a>                 <span class="at">y =</span> SC002Q02TA),</span>
<span id="cb4-6"><a href="#cb4-6"></a>             <span class="at">size=</span>SC211Q03JA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'SC211Q03JA' not found</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># but if we set the size explicitly, outside the aes, then all points will be that size</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="fu">ggplot</span>(<span class="at">data=</span>PISA_2022_school) <span class="sc">+</span></span>
<span id="cb6-3"><a href="#cb6-3"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> SC002Q01TA,</span>
<span id="cb6-4"><a href="#cb6-4"></a>                 <span class="at">y =</span> SC002Q02TA),</span>
<span id="cb6-5"><a href="#cb6-5"></a>             <span class="at">size=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02-4-Intro_to_graphs_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</div>
</div>
<section id="questions" class="level3" data-number="2.1.1"><h3 data-number="2.1.1" class="anchored" data-anchor-id="questions">
<span class="header-section-number">2.1.1</span> Questions</h3>
<div class="question">
<ol type="1">
<li>Spot the <em>three</em> errors in this graph code</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r none number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="fu">ggplot</span>(<span class="at">adta=</span>diamonds, <span class="at">x=</span>depth, <span class="at">y=</span>price) <span class="sc">+</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>  <span class="fu">geom_point</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb7-3"><a href="#cb7-3"></a>  <span class="fu">ggtitle</span>(<span class="st">"diamond graph"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Using the <code>PISA_2022</code> dataset, plot a graph for students from <code>Norway</code> to look at the relationship between <em>Home Possessions (WLE)</em> <code>HOMEPOS</code> and <em>reading grade</em> <code>PV1READ</code>. Colour each point with the gender <code>ST004D01T</code> of the student. Give the graph sensible <code>x</code> and <code>y</code> labels (e.g.&nbsp;<code>xlab("label")</code>).</li>
</ol>
<div class="cell">
<details><summary>answer dataframe</summary><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>graph_data <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"Norway"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>answer graph</summary><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="fu">ggplot</span>(graph_data,</span>
<span id="cb9-2"><a href="#cb9-2"></a>       <span class="fu">aes</span>(<span class="at">x=</span>HOMEPOS,</span>
<span id="cb9-3"><a href="#cb9-3"></a>           <span class="at">y=</span>PV1READ)) <span class="sc">+</span></span>
<span id="cb9-4"><a href="#cb9-4"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour=</span>ST004D01T)) <span class="sc">+</span></span>
<span id="cb9-5"><a href="#cb9-5"></a>  <span class="fu">xlab</span>(<span class="st">"Home possessions"</span>) <span class="sc">+</span></span>
<span id="cb9-6"><a href="#cb9-6"></a>  <span class="fu">ylab</span>(<span class="st">"Reading grade"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="3" type="1">
<li>Using the <code>PISA_2022</code> dataset for each country <code>CNT</code>, create a graph to explore how the <code>median</code> of the sense of school belonging <code>BELONG</code> relates to the <code>median</code> of the disciplinary climate in mathematics <code>DISCLIM</code>, adjust the colour of each point to reflect the <code>mean</code> of students in each country <code>ESCS</code>.</li>
</ol>
<p><strong>HINT:</strong> You’ll need create a new data frame with <code>summarise</code>d variables for <code>median_belong</code>, <code>median_discipline</code> and <code>mean_wealth</code>.</p>
<div class="cell">
<details><summary>answer dataframe</summary><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>graph_data <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>  <span class="fu">group_by</span>(OECD, CNT) <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3"></a>  <span class="fu">summarise</span>(<span class="at">median_belong =</span> <span class="fu">median</span>(BELONG, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb10-4"><a href="#cb10-4"></a>            <span class="at">median_discipline =</span> <span class="fu">median</span>(DISCLIM, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb10-5"><a href="#cb10-5"></a>            <span class="at">mean_wealth =</span> <span class="fu">mean</span>(ESCS, <span class="at">na.rm=</span><span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>HINT:</strong> To make your colours stand out more, add <code>+ scale_color_gradientn(colours = rainbow(3))</code> to the end of your plot.</p>
<div class="cell">
<details><summary>answer graph</summary><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># display a graph of the results</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="fu">ggplot</span>(<span class="at">data =</span> graph_data, </span>
<span id="cb11-3"><a href="#cb11-3"></a>       <span class="fu">aes</span>(<span class="at">x =</span> median_belong, </span>
<span id="cb11-4"><a href="#cb11-4"></a>           <span class="at">y =</span> median_discipline)) <span class="sc">+</span></span>
<span id="cb11-5"><a href="#cb11-5"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> mean_wealth)) <span class="sc">+</span> </span>
<span id="cb11-6"><a href="#cb11-6"></a>  <span class="fu">scale_color_gradientn</span>(<span class="at">colours =</span> <span class="fu">rainbow</span>(<span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</section></section><section id="sec-geom_bar" class="level2" data-number="2.2"><h2 data-number="2.2" class="anchored" data-anchor-id="sec-geom_bar">
<span class="header-section-number">2.2</span> geom_bar</h2>
<p>The <code>geom_bar</code> function is versatile, allowing the creation of bar, multiple bar, stacked bar charts and histograms. This first example shows how we can use bar charts to represent the number of cars in a household <code>ST251Q01JA</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>plot_cars <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(ST251Q01JA))</span>
<span id="cb12-2"><a href="#cb12-2"></a></span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="fu">ggplot</span>(<span class="at">data =</span> plot_cars, </span>
<span id="cb12-4"><a href="#cb12-4"></a>       <span class="fu">aes</span>(<span class="at">x=</span>ST251Q01JA)) <span class="sc">+</span> </span>
<span id="cb12-5"><a href="#cb12-5"></a>  <span class="fu">geom_bar</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02-4-Intro_to_graphs_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<ul>
<li>2 gets the <code>PISA_2022</code> dataset and removes all rows where <code>ST251Q01JA</code> is <code>NA</code>, storing this new dataset as <code>plot_cars</code>
</li>
<li>4 passes the <code>plot_cars</code> to <code>ggplot</code>, as the dataset we are going to plot</li>
<li>5 specifies the <code>x</code> values to be the values stored in <code>ST251Q01JA</code>, i.e.&nbsp;we will have a bar for each response given in <code>ST251Q01JA</code>: None, One, Two, Three or more.</li>
<li>6 <code>geom_bar</code> tell ggplot to make bars, it uses the <code>aes</code>thetic from line 5, to plot the <code>x</code> axis, note we haven’t given it a <code>y</code> value, this is auto-calculated from the number of students in each <code>x</code> group.</li>
</ul>
<p>We can choose to let ggplot split the results into different groups for us by setting a <code>fill</code> option, in this case on the <code>OECD</code> status of the country, i.e.&nbsp;do students in OECD countries have more cars than those not in OECD countries, to do this, we add <code>fill=OECD</code> to the <code>aes</code> on line 2 below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> plot_cars, </span>
<span id="cb13-2"><a href="#cb13-2"></a>       <span class="fu">aes</span>(<span class="at">x=</span>ST251Q01JA, <span class="at">fill=</span>OECD)) <span class="sc">+</span> </span>
<span id="cb13-3"><a href="#cb13-3"></a>  <span class="fu">geom_bar</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02-4-Intro_to_graphs_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<!--the `is.na(OfstedRating)` command selects only those rows from _OfstedRating_ that have an `NA` value. By putting the `!` mark in front of this we `NOT` or reverse the result. In this case `!is.na(OfstedRating)` returns all the rows that don't contain `NA` in OfstedRating.-->
<p>The bars are now coloured with a key, but, annoyingly, the bars are on top of each other not easily allowing us to make direct comparisons. To compare different groups we need the bars to not be <code>stacked</code>, we want them next to each other, or in <code>ggplot</code> language, we want the bars to <code>dodge</code> each other, to do this we add the <code>position=position_dodge()</code> command to line 3 below:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="02-4-Intro_to_graphs_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<section id="raising-the-bars-yourself" class="level3" data-number="2.2.1"><h3 data-number="2.2.1" class="anchored" data-anchor-id="raising-the-bars-yourself">
<span class="header-section-number">2.2.1</span> Raising the bars yourself</h3>
<p><code>ggplot</code> can do a lot of the hard work when putting together bar charts, e.g.&nbsp;counting the number of students in each group, but there might also be times when you want to use pipes to calculate summary values that you then want plot. That is, you want to specify the heights of the bars yourself. To do this we <em>will</em> specify the <code>y</code> axis in the <code>aes</code> and use <code>stat="indentity"</code> to tell ggplot that’s what we’re doing. Take the example where you want to find the overall percentage of students for a range of countries getting over <code>500</code> in <code>PV1SCIE</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>plot_data <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>  <span class="fu">group_by</span>(OECD, CNT) <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3"></a>  <span class="fu">summarise</span>(<span class="at">all_students =</span> <span class="fu">n</span>(),</span>
<span id="cb14-4"><a href="#cb14-4"></a>            <span class="at">upper_sci_per =</span> <span class="fu">sum</span>(PV1SCIE <span class="sc">&gt;</span> <span class="dv">500</span>) <span class="sc">/</span> <span class="fu">n</span>())</span>
<span id="cb14-5"><a href="#cb14-5"></a></span>
<span id="cb14-6"><a href="#cb14-6"></a><span class="fu">ggplot</span>(<span class="at">data=</span>plot_data, </span>
<span id="cb14-7"><a href="#cb14-7"></a>       <span class="fu">aes</span>(<span class="at">x=</span>CNT, <span class="at">y=</span>upper_sci_per)) <span class="sc">+</span></span>
<span id="cb14-8"><a href="#cb14-8"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">fill=</span>OECD), </span>
<span id="cb14-9"><a href="#cb14-9"></a>           <span class="at">position=</span><span class="fu">position_dodge</span>(),</span>
<span id="cb14-10"><a href="#cb14-10"></a>           <span class="at">stat=</span><span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb14-11"><a href="#cb14-11"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust=</span><span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02-4-Intro_to_graphs_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<ul>
<li>1 to 4 creates a dataframe <code>plot_data</code> that calculates the percentage of students in each country <code>CNT</code>, that have a science grade <code>PV1SCIE</code> over <code>500</code>
</li>
<li>7 as we are setting the heights of the bars ourselves, we need to give the ggplot <code>aes</code> command a <code>y</code> value, in this case <code>y=upper_sci_per</code>
</li>
<li>8 the <code>geom_bar</code> is given a <code>fill</code> value of <code>OECD</code>, this will allow us to see how countries in and out of the OECD compare</li>
<li>9 we use <code>position=position_dodge()</code> as we want the percentage grades of each country to be next to each other so we can look for differences in heights</li>
<li>10 <code>stat="identity"</code> tells <code>geom_bar</code> that you have defined your own bar heights in the <code>y</code> attribute and not to count the number of rows.</li>
<li>11 this <code>theme</code> command helps rotate the x-axis labels 90 degrees, so they don’t overlap.</li>
</ul>
<p>Alternatively, you can use the <code>geom_col()</code> function that can handle you setting the <code>y</code> values and not specifying <code>stat="identity"</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>plot_data, </span>
<span id="cb15-2"><a href="#cb15-2"></a>       <span class="fu">aes</span>(<span class="at">x=</span>CNT, <span class="at">y=</span>upper_sci_per)) <span class="sc">+</span></span>
<span id="cb15-3"><a href="#cb15-3"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">fill=</span>OECD), </span>
<span id="cb15-4"><a href="#cb15-4"></a>           <span class="at">position=</span><span class="fu">position_dodge</span>()) <span class="sc">+</span></span>
<span id="cb15-5"><a href="#cb15-5"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust=</span><span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="questions-1" class="level3" data-number="2.2.2"><h3 data-number="2.2.2" class="anchored" data-anchor-id="questions-1">
<span class="header-section-number">2.2.2</span> Questions</h3>
<div class="question">
<ol type="1">
<li>Can you spot the 4 errors in this code.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r none number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>schools <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Phase <span class="sc">==</span> <span class="st">"Secondary"</span>), </span>
<span id="cb16-2"><a href="#cb16-2"></a>       <span class="at">x=</span>Region <span class="sc">+</span></span>
<span id="cb16-3"><a href="#cb16-3"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">fill=</span>Gender) <span class="at">position=</span><span class="st">"full"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details><summary>answer</summary><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>schools <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Phase <span class="sc">==</span> <span class="st">"Secondary"</span>), </span>
<span id="cb17-2"><a href="#cb17-2"></a>       <span class="fu">aes</span>(<span class="at">x=</span>Region)) <span class="sc">+</span> <span class="co"># 1 no aes() around the x value # 2 missing close brackets</span></span>
<span id="cb17-3"><a href="#cb17-3"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">fill=</span>Gender), <span class="at">position=</span><span class="st">"fill"</span>) <span class="co"># 3 missing comma # 4 position="full" rather than fill </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="2" type="1">
<li>Create a bar chart showing the total number of students for each grouping of “How satisfied are you with each of the following: The way that you look” <code>WB155Q02HA</code>. Adjust this graph to see if there is a difference for this among females and males:</li>
</ol>
<div class="cell">
<details><summary>answer</summary><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>PISA_2022,</span>
<span id="cb18-2"><a href="#cb18-2"></a>       <span class="fu">aes</span>(<span class="at">x=</span>WB155Q02HA)) <span class="sc">+</span></span>
<span id="cb18-3"><a href="#cb18-3"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb18-4"><a href="#cb18-4"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust=</span><span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>answer with gender added</summary><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>PISA_2022 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(WB155Q02HA)),</span>
<span id="cb19-2"><a href="#cb19-2"></a>       <span class="fu">aes</span>(<span class="at">x=</span>WB155Q02HA, <span class="at">fill=</span>ST004D01T)) <span class="sc">+</span></span>
<span id="cb19-3"><a href="#cb19-3"></a>  <span class="fu">geom_bar</span>(<span class="at">position=</span><span class="fu">position_dodge</span>()) <span class="sc">+</span></span>
<span id="cb19-4"><a href="#cb19-4"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust=</span><span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="3" type="1">
<li>Plot bars for the number of Females and Males <code>ST004D01T</code> who answer each grouping for: “Confident can do in future: : Finding learning resources online on my own” <code>ST355Q03JA</code>. Make sure that the bars <code>position_dodge()</code> each other so we can compare the heights.</li>
</ol>
<div class="cell">
<details><summary>answer</summary><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>graph_data <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(ST355Q03JA))</span>
<span id="cb20-2"><a href="#cb20-2"></a></span>
<span id="cb20-3"><a href="#cb20-3"></a>  <span class="fu">ggplot</span>(<span class="at">data=</span>graph_data,</span>
<span id="cb20-4"><a href="#cb20-4"></a>       <span class="fu">aes</span>(<span class="at">x=</span>ST355Q03JA, <span class="at">fill=</span>ST004D01T)) <span class="sc">+</span></span>
<span id="cb20-5"><a href="#cb20-5"></a>  <span class="fu">geom_bar</span>(<span class="at">position=</span><span class="fu">position_dodge</span>()) <span class="sc">+</span></span>
<span id="cb20-6"><a href="#cb20-6"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust=</span><span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="4" type="1">
<li>For France and the United Kingdom, plot the total number of students who gave each answer for <code>ST324Q11JA</code> “Agree/disagree: School has been a waste of time.”. Filter out all the <code>NA</code> values first <code>!is.na(...)</code>
</li>
</ol>
<div class="cell">
<details><summary>answer dataframe</summary><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>plot_data <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span> </span>
<span id="cb21-2"><a href="#cb21-2"></a>  <span class="fu">filter</span>(CNT <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"France"</span>, <span class="st">"United Kingdom"</span>),</span>
<span id="cb21-3"><a href="#cb21-3"></a>         <span class="sc">!</span><span class="fu">is.na</span>(ST324Q11JA))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details><summary>answer</summary><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="fu">ggplot</span>(plot_data,</span>
<span id="cb22-2"><a href="#cb22-2"></a>       <span class="fu">aes</span>(<span class="at">x=</span>ST324Q11JA, <span class="at">fill=</span>CNT)) <span class="sc">+</span></span>
<span id="cb22-3"><a href="#cb22-3"></a>  <span class="fu">geom_bar</span>(<span class="at">position=</span><span class="fu">position_dodge</span>()) <span class="sc">+</span></span>
<span id="cb22-4"><a href="#cb22-4"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="5" type="1">
<li>Using the <code>PISA_2022_school</code> dataset (available <a href="../Users/k1765032/Library/CloudStorage/GoogleDrive-richardandrewbrock@gmail.com/.shortcut-targets-by-id/1c3CkaEBOICzepArDfjQUP34W2BYhFjM4/PISR/Data/PISA/2022/PISA_school_2022.parquet">here</a> create a table that stores for each country <code>CNT</code>
</li>
</ol>
<ul>
<li>the total number of full-time teacher, <code>SC018Q01TA01</code>
</li>
<li>the total number of full-time teachers with a bachelors qualification <code>SC018Q08JA01</code>
</li>
<li>the total number of full-time teachers with a master’s qualification <code>SC018Q01TA01</code>
</li>
<li>the total number of full-time teachers with a doctoral qualification <code>SC018Q10JA01</code>
</li>
</ul>
<p>Add an additional column working out the % of teachers with master’s in each country, call this <code>per_MA</code></p>
<div class="cell">
<details><summary>creating the dataframe</summary><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>plot_workforce <span class="ot">&lt;-</span> PISA_2022_school <span class="sc">%&gt;%</span> </span>
<span id="cb23-2"><a href="#cb23-2"></a>  <span class="fu">group_by</span>(CNT) <span class="sc">%&gt;%</span> </span>
<span id="cb23-3"><a href="#cb23-3"></a>  <span class="fu">summarise</span>(<span class="at">schools =</span> <span class="fu">n</span>(),</span>
<span id="cb23-4"><a href="#cb23-4"></a>            <span class="at">total =</span> SC018Q01TA01 <span class="sc">%&gt;%</span> <span class="fu">sum</span>(<span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb23-5"><a href="#cb23-5"></a>            <span class="at">BA =</span> SC018Q08JA01 <span class="sc">%&gt;%</span> <span class="fu">sum</span>(<span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb23-6"><a href="#cb23-6"></a>            <span class="at">PHD =</span> SC018Q10JA01 <span class="sc">%&gt;%</span> <span class="fu">sum</span>(<span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb23-7"><a href="#cb23-7"></a>            <span class="at">MA =</span> SC018Q09JA01 <span class="sc">%&gt;%</span> <span class="fu">sum</span>(<span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb23-8"><a href="#cb23-8"></a>            <span class="at">per_MA =</span> MA <span class="sc">*</span><span class="dv">100</span> <span class="sc">/</span> total)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Using this dataframe plot a bar graph for each country of the <code>per_MA</code>, use the number of schools as a <code>fill</code>:</p>
<div class="cell">
<details><summary>creating the dataframe</summary><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>plot_workforce,</span>
<span id="cb24-2"><a href="#cb24-2"></a>       <span class="fu">aes</span>(<span class="at">x=</span>CNT, <span class="at">y=</span>per_MA, <span class="at">fill=</span>schools)) <span class="sc">+</span></span>
<span id="cb24-3"><a href="#cb24-3"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb24-4"><a href="#cb24-4"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust=</span><span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb24-5"><a href="#cb24-5"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"top"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="6" type="1">
<li>[Extension] Explore other patterns in the school and student pisa datasets.</li>
</ol>
</div>
</section></section><section id="geom_text" class="level2" data-number="2.3"><h2 data-number="2.3" class="anchored" data-anchor-id="geom_text">
<span class="header-section-number">2.3</span> geom_text</h2>
<p>Our bar charts look great, but finding the actual value of each bar can be a little clumsly if we have to get a ruler out and read off the y-axis. Better would be for us to have numbers listed at the top of each bar by adding a <code>geom_text</code> element:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>plot_cars <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(ST251Q01JA))</span>
<span id="cb25-2"><a href="#cb25-2"></a></span>
<span id="cb25-3"><a href="#cb25-3"></a><span class="fu">ggplot</span>(<span class="at">data =</span> plot_cars, </span>
<span id="cb25-4"><a href="#cb25-4"></a>       <span class="fu">aes</span>(<span class="at">x=</span>ST251Q01JA, <span class="at">fill=</span>OECD)) <span class="sc">+</span> </span>
<span id="cb25-5"><a href="#cb25-5"></a>  <span class="fu">geom_bar</span>(<span class="at">position=</span><span class="fu">position_dodge</span>()) <span class="sc">+</span></span>
<span id="cb25-6"><a href="#cb25-6"></a>  <span class="fu">geom_text</span>(<span class="at">stat=</span><span class="st">'count'</span>, </span>
<span id="cb25-7"><a href="#cb25-7"></a>            <span class="fu">aes</span>(<span class="at">label=</span>..count..), </span>
<span id="cb25-8"><a href="#cb25-8"></a>            <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width=</span><span class="fl">0.9</span>),</span>
<span id="cb25-9"><a href="#cb25-9"></a>            <span class="at">vjust=</span><span class="sc">-</span><span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02-4-Intro_to_graphs_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<ul>
<li>line 6 starts the <code>geom_text</code> command, telling the geom to use the <code>count</code> <code>stat</code>istic from ggplot, this means it will be able to fetch the number of rows in each grouping.</li>
<li>line 7 as we want the label to change for each bar element, we put <code>label=..count..</code> inside <code>aes</code>. The <code>x</code> location of the labels is inherited from line 4 and the <code>y</code> location will be calculated from the height of each bar</li>
<li>line 8 we want the labels to align to the bars, so we tell the <code>geom_text</code> to also <code>position_dodge</code>, passing a <code>width=0.9</code> to the dodge function, so the labels line up above the columns,</li>
<li>finally, on line 9, we vertically adjust the labels <code>vjust</code>, so they sit on top of the columns.</li>
</ul>
<p>Rather than adding the count, you might want to add the percentage that each bar represents, we can do this by changing the value given to label on line 5, below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> plot_cars, </span>
<span id="cb26-2"><a href="#cb26-2"></a>       <span class="fu">aes</span>(<span class="at">x=</span>ST251Q01JA, <span class="at">fill=</span>OECD)) <span class="sc">+</span> </span>
<span id="cb26-3"><a href="#cb26-3"></a>  <span class="fu">geom_bar</span>(<span class="at">position=</span><span class="fu">position_dodge</span>()) <span class="sc">+</span></span>
<span id="cb26-4"><a href="#cb26-4"></a>  <span class="fu">geom_text</span>(<span class="at">stat=</span><span class="st">'count'</span>, </span>
<span id="cb26-5"><a href="#cb26-5"></a>            <span class="fu">aes</span>(<span class="at">label=</span><span class="dv">100</span><span class="sc">*</span>(..count..<span class="sc">/</span><span class="fu">sum</span>(..count..)) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>), </span>
<span id="cb26-6"><a href="#cb26-6"></a>            <span class="at">group =</span> OECD), </span>
<span id="cb26-7"><a href="#cb26-7"></a>            <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width=</span><span class="fl">0.9</span>),</span>
<span id="cb26-8"><a href="#cb26-8"></a>            <span class="at">vjust=</span><span class="sc">-</span><span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02-4-Intro_to_graphs_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<p>Additionally, when we make graphs we often want to label the dataset, for example if we were to plot all the countries and their <code>PV1MATH</code> and <code>PV1READ</code> scores, we would get:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>plot_data <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb27-2"><a href="#cb27-2"></a>  <span class="fu">group_by</span>(OECD, CNT) <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="#cb27-3"></a>  <span class="fu">summarise</span>(<span class="at">m_read  =</span> <span class="fu">mean</span>(PV1READ, <span class="at">na.rm=</span><span class="st">"TRUE"</span>),</span>
<span id="cb27-4"><a href="#cb27-4"></a>            <span class="at">m_maths =</span> <span class="fu">mean</span>(PV1MATH, <span class="at">na.rm=</span><span class="st">"TRUE"</span>))</span>
<span id="cb27-5"><a href="#cb27-5"></a></span>
<span id="cb27-6"><a href="#cb27-6"></a><span class="fu">ggplot</span>(<span class="at">data=</span>plot_data, </span>
<span id="cb27-7"><a href="#cb27-7"></a>       <span class="fu">aes</span>(<span class="at">x=</span>m_read, <span class="at">y=</span>m_maths, <span class="at">colour=</span>OECD)) <span class="sc">+</span></span>
<span id="cb27-8"><a href="#cb27-8"></a>  <span class="fu">geom_point</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02-4-Intro_to_graphs_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<p>This looks great, but we don’t actually know which countries are which. To get this data we need to add text to the graph, using <code>geom_text</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>plot_data, </span>
<span id="cb28-2"><a href="#cb28-2"></a>       <span class="fu">aes</span>(<span class="at">x=</span>m_read, <span class="at">y=</span>m_maths, <span class="at">colour=</span>OECD)) <span class="sc">+</span></span>
<span id="cb28-3"><a href="#cb28-3"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb28-4"><a href="#cb28-4"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label=</span>CNT), </span>
<span id="cb28-5"><a href="#cb28-5"></a>            <span class="at">colour=</span><span class="st">"black"</span>, </span>
<span id="cb28-6"><a href="#cb28-6"></a>            <span class="at">check_overlap =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02-4-Intro_to_graphs_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<p>Here we have used <code>colour="black"</code> outside the <code>aes</code> to define the colour for all the labels, and <code>check_overlap = TRUE</code> which removes any labels that are on top of each other. It’s still a little bit hard to understand, and maybe we want to focus on just a few of the labels for countries we are interested in. For example</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="co"># make a vector of countries you want to have labels for</span></span>
<span id="cb29-2"><a href="#cb29-2"></a>focus_cnt <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"United Kingdom"</span>, <span class="st">"France"</span>, <span class="st">"Argentina"</span>)</span>
<span id="cb29-3"><a href="#cb29-3"></a></span>
<span id="cb29-4"><a href="#cb29-4"></a><span class="co"># add a new column to the plot_data where these countries are</span></span>
<span id="cb29-5"><a href="#cb29-5"></a>plot_data <span class="ot">&lt;-</span> plot_data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">focus =</span> CNT <span class="sc">%in%</span> focus_cnt)</span>
<span id="cb29-6"><a href="#cb29-6"></a></span>
<span id="cb29-7"><a href="#cb29-7"></a>plot_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 80 × 5
# Groups:   OECD [2]
   OECD  CNT                  m_read m_maths focus
   &lt;fct&gt; &lt;fct&gt;                 &lt;dbl&gt;   &lt;dbl&gt; &lt;lgl&gt;
 1 No    Albania                359.    368. FALSE
 2 No    United Arab Emirates   420.    434. FALSE
 3 No    Argentina              413.    389. TRUE 
 4 No    Bulgaria               405.    418. FALSE
 5 No    Brazil                 415.    380. FALSE
 6 No    Brunei Darussalam      428.    440. FALSE
 7 No    Dominican Republic     354.    340. FALSE
 8 No    Georgia                374.    390. FALSE
 9 No    Guatemala              377.    346. FALSE
10 No    Hong Kong (China)      504.    545. FALSE
# ℹ 70 more rows</code></pre>
</div>
</div>
<p>Now we can adjust out <code>geom_text</code> to only show those countries that we want to focus on:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>plot_data, </span>
<span id="cb31-2"><a href="#cb31-2"></a>       <span class="fu">aes</span>(<span class="at">x=</span>m_read, <span class="at">y=</span>m_maths, <span class="at">colour=</span>OECD)) <span class="sc">+</span></span>
<span id="cb31-3"><a href="#cb31-3"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb31-4"><a href="#cb31-4"></a>  <span class="fu">geom_text</span>(<span class="at">data=</span>plot_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(focus <span class="sc">==</span> <span class="cn">TRUE</span>),</span>
<span id="cb31-5"><a href="#cb31-5"></a>            <span class="fu">aes</span>(<span class="at">label=</span>CNT), </span>
<span id="cb31-6"><a href="#cb31-6"></a>            <span class="at">colour=</span><span class="st">"black"</span>, </span>
<span id="cb31-7"><a href="#cb31-7"></a>            <span class="at">check_overlap =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02-4-Intro_to_graphs_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<ul>
<li>line 5 changes the data that is being passed to the <code>geom_text</code>, it no longer uses the data defined in line 2, but has a new dataset, that is filtered on <code>focus == TRUE</code>, i.e.&nbsp;only containing the countries that we want.</li>
<li>Note that the <code>x</code> and <code>y</code> mappings from line 3 are inherited by line 6, it’s only the data that we have redefined</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>geom_text</code> is great, but you might find that <code>ggrepel</code> package useful as it’ll add lines connecting the text the data points. Using the <code>plot_data</code> from above:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb32-2"><a href="#cb32-2"></a></span>
<span id="cb32-3"><a href="#cb32-3"></a><span class="fu">ggplot</span>(<span class="at">data=</span>plot_data, </span>
<span id="cb32-4"><a href="#cb32-4"></a>       <span class="fu">aes</span>(<span class="at">x=</span>m_read, <span class="at">y=</span>m_maths, <span class="at">colour=</span>OECD)) <span class="sc">+</span></span>
<span id="cb32-5"><a href="#cb32-5"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb32-6"><a href="#cb32-6"></a>  <span class="fu">geom_text_repel</span>(<span class="at">data=</span>plot_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(focus <span class="sc">==</span> <span class="cn">TRUE</span>),</span>
<span id="cb32-7"><a href="#cb32-7"></a>            <span class="fu">aes</span>(<span class="at">label=</span>CNT),</span>
<span id="cb32-8"><a href="#cb32-8"></a>            <span class="at">box.padding =</span> <span class="fl">0.5</span>,</span>
<span id="cb32-9"><a href="#cb32-9"></a>            <span class="at">max.overlaps =</span> <span class="cn">Inf</span>,</span>
<span id="cb32-10"><a href="#cb32-10"></a>            <span class="at">colour=</span><span class="st">"black"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02-4-Intro_to_graphs_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</div>
</div>
</section></section><section id="faceting" class="level1" data-number="3"><h1 data-number="3">
<span class="header-section-number">3</span> faceting</h1>
<p>Faceting allows you to easily create multiple graphs from one dataset and one ggplot definition by splitting the data on different factors, by defining:</p>
<p><code>facet_grid(&lt;column_to_split&gt; ~ .)</code></p>
<p>or</p>
<p><code>facet_grid(. ~ &lt;column_to_split&gt;)</code></p>
<p>Looking at the <code>PISA_2022</code> dataset, we can plot the <code>HOMEPOS</code> and reading test outcome <code>PV1READ</code> variables against each other:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="co"># create a subset of the data for plotting</span></span>
<span id="cb33-2"><a href="#cb33-2"></a>plot_data <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span> </span>
<span id="cb33-3"><a href="#cb33-3"></a>  <span class="fu">select</span>(OECD, CNT, HOMEPOS, PV1READ) <span class="sc">%&gt;%</span></span>
<span id="cb33-4"><a href="#cb33-4"></a>  <span class="fu">filter</span>(CNT <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Germany"</span>, <span class="st">"Russian Federation"</span>, </span>
<span id="cb33-5"><a href="#cb33-5"></a>                    <span class="st">"United Kingdom"</span>))</span>
<span id="cb33-6"><a href="#cb33-6"></a></span>
<span id="cb33-7"><a href="#cb33-7"></a><span class="fu">ggplot</span>(<span class="at">data=</span>plot_data, <span class="fu">aes</span>(<span class="at">x=</span>HOMEPOS, <span class="at">y=</span>PV1READ)) <span class="sc">+</span> </span>
<span id="cb33-8"><a href="#cb33-8"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb33-9"><a href="#cb33-9"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb33-10"><a href="#cb33-10"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02-4-Intro_to_graphs_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<p>But it isn’t clear how this graph varies between countries. We could try plotting separate graphs for each country, but there is a faster way. Using:</p>
<p><code>+ facet_grid(CNT ~ .)</code></p>
<p>ggplot will automatically create graphs for subsets of <code>plot_data</code>, split on each different country in <code>CNT</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>plot_data, <span class="fu">aes</span>(<span class="at">x=</span>HOMEPOS, <span class="at">y=</span>PV1READ)) <span class="sc">+</span> </span>
<span id="cb34-2"><a href="#cb34-2"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb34-3"><a href="#cb34-3"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb34-4"><a href="#cb34-4"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb34-5"><a href="#cb34-5"></a>  <span class="fu">facet_grid</span>(CNT <span class="sc">~</span> .)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02-4-Intro_to_graphs_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<p>If the column you want to split on it on the left hand side of <code>facet_grid(CNT ~ .)</code>, then the graphs will be piled on top of each other, if it’s on the right hand side <code>facet_grid(. ~ CNT)</code>, then they’ll be side by side.</p>
<div class="question">
<p>Take a subset of the overall dataset, by filtering on a few countries, take another one of your plots and use <code>facet_grid(CNT ~ .)</code> to explore the graphs for different countries.</p>
</div>
<section id="exporting-plots" class="level2" data-number="3.1"><h2 data-number="3.1" class="anchored" data-anchor-id="exporting-plots">
<span class="header-section-number">3.1</span> Exporting plots</h2>
<p>ggplot can export data in a variety of formats suitable for printing, publication and the web. Once you have created a graph and stored it in an object <code>my_graph &lt;- ggplot(...</code>, the command to save the graph to your hard drive is:</p>
<p><code>ggsave(&lt;file_location_name_and_extension&gt;, &lt;object_name&gt;, width = 5, height = 4, device=&lt;file_ext&gt;)</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="fu">ggsave</span>(<span class="st">"my_graph.pdf"</span>, my_graph, <span class="at">width =</span> <span class="dv">5</span>, <span class="at">height =</span> <span class="dv">4</span>, <span class="at">device=</span><span class="st">"pdf"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you want to change the output format, just change the extension of the file you are saving:</p>
<ul>
<li>“poverty_size.pdf” perfect for publication and printing, potentially large file size</li>
<li>“poverty_size.svg” the same as pdf, also suitable for putting on webpages</li>
<li>“poverty_size.png” smaller file size, suitable for websites and presentations</li>
<li>“poverty_size.jpg” similar output to png</li>
</ul></section></section><section id="additional-support-on-graphing" class="level1" data-number="4"><h1 data-number="4">
<span class="header-section-number">4</span> Additional support on graphing</h1>
<section id="using-r-to-do-descriptive-statistics-and-plot-graphs" class="level2" data-number="4.1"><h2 data-number="4.1" class="anchored" data-anchor-id="using-r-to-do-descriptive-statistics-and-plot-graphs">
<span class="header-section-number">4.1</span> Using R to do descriptive statistics and plot graphs</h2>
<iframe width="560" height="315" src="https://www.youtube.com/embed/J6yN0y1sm5g?start=2" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="">
</iframe>
<p>You can find the code used in the video below:</p>
<div class="cell">
<details><summary>Show the code</summary><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a><span class="co"># Introduction to plotting graphs</span></span>
<span id="cb36-2"><a href="#cb36-2"></a><span class="co">#</span></span>
<span id="cb36-3"><a href="#cb36-3"></a><span class="co"># Download data from /Users/k1765032/Library/CloudStorage/GoogleDrive-richardandrewbrock@gmail.com/.shortcut-targets-by-id/1c3CkaEBOICzepArDfjQUP34W2BYhFjM4/PISR/Data/PISA/subset/Students_2022_RBDP_none_levels.rds</span></span>
<span id="cb36-4"><a href="#cb36-4"></a><span class="co"># You want the file: Students_2022_RBDP_none_levels.rds</span></span>
<span id="cb36-5"><a href="#cb36-5"></a><span class="co"># and place in your own file system</span></span>
<span id="cb36-6"><a href="#cb36-6"></a><span class="co"># change loc to load the data directly. Loading into R might take a few minutes</span></span>
<span id="cb36-7"><a href="#cb36-7"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb36-8"><a href="#cb36-8"></a>loc <span class="ot">&lt;-</span> <span class="st">"/Users/k1765032/Library/CloudStorage/GoogleDrive-richardandrewbrock@gmail.com/.shortcut-targets-by-id/1c3CkaEBOICzepArDfjQUP34W2BYhFjM4/PISR/Data/PISA/subset/Students_2022_RBDP_none_levels.rds"</span></span>
<span id="cb36-9"><a href="#cb36-9"></a>PISA_2022 <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(loc)</span>
<span id="cb36-10"><a href="#cb36-10"></a></span>
<span id="cb36-11"><a href="#cb36-11"></a><span class="co"># Calculating means of groups</span></span>
<span id="cb36-12"><a href="#cb36-12"></a><span class="co"># The PISA_2022 dataframe is piped to a new dataframe MeanPISA</span></span>
<span id="cb36-13"><a href="#cb36-13"></a><span class="co"># The data are grouped by the country variable (CNT)</span></span>
<span id="cb36-14"><a href="#cb36-14"></a><span class="co"># The countries of interest are chosen (UK, France, Germany and the US)</span></span>
<span id="cb36-15"><a href="#cb36-15"></a><span class="co"># The summarise function is used to output the mean and standard deviation score for each country</span></span>
<span id="cb36-16"><a href="#cb36-16"></a><span class="co"># on the Science Plausible Value (PV1SCIE) and NAs are ignored na.rm=TRUE</span></span>
<span id="cb36-17"><a href="#cb36-17"></a></span>
<span id="cb36-18"><a href="#cb36-18"></a>MeanPISA <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb36-19"><a href="#cb36-19"></a>  <span class="fu">group_by</span>(CNT)  <span class="sc">%&gt;%</span></span>
<span id="cb36-20"><a href="#cb36-20"></a>  <span class="fu">filter</span>(CNT<span class="sc">==</span><span class="st">"United Kingdom"</span> <span class="sc">|</span> CNT<span class="sc">==</span> <span class="st">"France"</span> <span class="sc">|</span> CNT<span class="sc">==</span> <span class="st">"Germany"</span> <span class="sc">|</span> CNT<span class="sc">==</span><span class="st">"United States"</span>)  <span class="sc">%&gt;%</span></span>
<span id="cb36-21"><a href="#cb36-21"></a>  <span class="fu">summarise</span>(<span class="at">mean_sci =</span> <span class="fu">mean</span>(PV1SCIE, <span class="at">na.rm=</span><span class="cn">TRUE</span>), <span class="at">sd_sci=</span> <span class="fu">sd</span>(PV1SCIE, <span class="at">na.rm=</span><span class="cn">TRUE</span>)) </span>
<span id="cb36-22"><a href="#cb36-22"></a><span class="fu">print</span>(MeanPISA)</span>
<span id="cb36-23"><a href="#cb36-23"></a></span>
<span id="cb36-24"><a href="#cb36-24"></a></span>
<span id="cb36-25"><a href="#cb36-25"></a><span class="co"># To plot data we can use the ggplot function. </span></span>
<span id="cb36-26"><a href="#cb36-26"></a><span class="co"># We will start by plotting a column graph use geom_col</span></span>
<span id="cb36-27"><a href="#cb36-27"></a><span class="co"># We specify the data set for ggplot to use (MeanPisa) and then </span></span>
<span id="cb36-28"><a href="#cb36-28"></a><span class="co"># define the x and y variables:</span></span>
<span id="cb36-29"><a href="#cb36-29"></a><span class="co"># ggplot(MeanPISA,</span></span>
<span id="cb36-30"><a href="#cb36-30"></a><span class="co">#       aes(x=CNT, y=mean_sci))</span></span>
<span id="cb36-31"><a href="#cb36-31"></a><span class="co"># geom_col() (Note the plus is on the line before) plots the graph and the fill colour is set to red</span></span>
<span id="cb36-32"><a href="#cb36-32"></a><span class="co"># The next three lines set the formatting of the axis text and add x and y axis labels</span></span>
<span id="cb36-33"><a href="#cb36-33"></a></span>
<span id="cb36-34"><a href="#cb36-34"></a><span class="fu">ggplot</span>(MeanPISA,</span>
<span id="cb36-35"><a href="#cb36-35"></a>       <span class="fu">aes</span>(<span class="at">x=</span>CNT, <span class="at">y=</span>mean_sci))<span class="sc">+</span></span>
<span id="cb36-36"><a href="#cb36-36"></a><span class="fu">geom_col</span>(<span class="at">fill=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb36-37"><a href="#cb36-37"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust=</span><span class="fl">0.95</span>, <span class="at">vjust=</span><span class="fl">0.2</span>, <span class="at">size=</span><span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb36-38"><a href="#cb36-38"></a>  <span class="fu">xlab</span>(<span class="st">"Country"</span>) <span class="sc">+</span></span>
<span id="cb36-39"><a href="#cb36-39"></a>  <span class="fu">ylab</span>(<span class="st">"Science Score"</span>)</span>
<span id="cb36-40"><a href="#cb36-40"></a></span>
<span id="cb36-41"><a href="#cb36-41"></a><span class="co"># For plotting a scatter plot or PISA reading scores against science scores</span></span>
<span id="cb36-42"><a href="#cb36-42"></a><span class="co">#, first we make a managable data set</span></span>
<span id="cb36-43"><a href="#cb36-43"></a><span class="co"># I will filter the data set to include only the UK data</span></span>
<span id="cb36-44"><a href="#cb36-44"></a><span class="co"># and remove any NAs</span></span>
<span id="cb36-45"><a href="#cb36-45"></a></span>
<span id="cb36-46"><a href="#cb36-46"></a>UKData <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb36-47"><a href="#cb36-47"></a>  <span class="fu">filter</span>(CNT<span class="sc">==</span><span class="st">"United Kingdom"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-48"><a href="#cb36-48"></a>  <span class="fu">drop_na</span>(PV1SCIE)</span>
<span id="cb36-49"><a href="#cb36-49"></a></span>
<span id="cb36-50"><a href="#cb36-50"></a><span class="co"># This time I will use ggplot to plot a scatter graph</span></span>
<span id="cb36-51"><a href="#cb36-51"></a><span class="co"># I feed UKDATA to ggplot, specify the x (PISA Reading score)</span></span>
<span id="cb36-52"><a href="#cb36-52"></a><span class="co"># And y (PISA science score). This time, I have linked the colour</span></span>
<span id="cb36-53"><a href="#cb36-53"></a><span class="co"># to a variable (ST004D01T) which is the gender value, giving</span></span>
<span id="cb36-54"><a href="#cb36-54"></a><span class="co"># plot points of different colours for boys and girls</span></span>
<span id="cb36-55"><a href="#cb36-55"></a><span class="co"># To produce a scatter plot, I use geom_point to plot points,</span></span>
<span id="cb36-56"><a href="#cb36-56"></a><span class="co"># Giving the size of point and the transparency (alpha=0.5) -</span></span>
<span id="cb36-57"><a href="#cb36-57"></a><span class="co"># some transparency of points is helpful when plots become dense</span></span>
<span id="cb36-58"><a href="#cb36-58"></a><span class="co"># The x and y lables are added</span></span>
<span id="cb36-59"><a href="#cb36-59"></a><span class="co"># Finally, a line is plotted - geom_smooth(method='lm')</span></span>
<span id="cb36-60"><a href="#cb36-60"></a><span class="co"># sets the line to a linear ('lm') line</span></span>
<span id="cb36-61"><a href="#cb36-61"></a></span>
<span id="cb36-62"><a href="#cb36-62"></a>  <span class="fu">ggplot</span>(UKData,</span>
<span id="cb36-63"><a href="#cb36-63"></a>       <span class="fu">aes</span>(<span class="at">x=</span>PV1READ, <span class="at">y=</span>PV1SCIE, <span class="at">colour=</span>ST004D01T)) <span class="sc">+</span></span>
<span id="cb36-64"><a href="#cb36-64"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="fl">0.1</span>, <span class="at">alpha=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb36-65"><a href="#cb36-65"></a>  <span class="fu">ylab</span>(<span class="st">"Science Score"</span>) <span class="sc">+</span></span>
<span id="cb36-66"><a href="#cb36-66"></a>  <span class="fu">xlab</span>(<span class="st">"Reading Score"</span>) <span class="sc">+</span></span>
<span id="cb36-67"><a href="#cb36-67"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">'lm'</span>)</span>
<span id="cb36-68"><a href="#cb36-68"></a>  </span>
<span id="cb36-69"><a href="#cb36-69"></a><span class="co"># Where R becomes very powerful is being able to produce multiple charts rapidly</span></span>
<span id="cb36-70"><a href="#cb36-70"></a><span class="co"># In the code below, I plot reading against science scores as above, but this time</span></span>
<span id="cb36-71"><a href="#cb36-71"></a><span class="co"># Use the entire data set - for the whole world!</span></span>
<span id="cb36-72"><a href="#cb36-72"></a><span class="co"># All the steps are the same, except, I use the facet_wrap, a way to create multiple</span></span>
<span id="cb36-73"><a href="#cb36-73"></a><span class="co"># graph panels - the instruction creates a set of graphs for each country  </span></span>
<span id="cb36-74"><a href="#cb36-74"></a>  </span>
<span id="cb36-75"><a href="#cb36-75"></a>  WorldData <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb36-76"><a href="#cb36-76"></a>    <span class="fu">drop_na</span>(PV1SCIE)</span>
<span id="cb36-77"><a href="#cb36-77"></a>  </span>
<span id="cb36-78"><a href="#cb36-78"></a>  <span class="fu">ggplot</span>(WorldData,</span>
<span id="cb36-79"><a href="#cb36-79"></a>         <span class="fu">aes</span>(<span class="at">x=</span>PV1READ, <span class="at">y=</span>PV1SCIE, <span class="at">colour=</span>ST004D01T)) <span class="sc">+</span></span>
<span id="cb36-80"><a href="#cb36-80"></a>    <span class="fu">geom_point</span>(<span class="at">size=</span><span class="fl">0.1</span>, <span class="at">alpha=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb36-81"><a href="#cb36-81"></a>    <span class="fu">ylab</span>(<span class="st">"Science Score"</span>) <span class="sc">+</span></span>
<span id="cb36-82"><a href="#cb36-82"></a>    <span class="fu">xlab</span>(<span class="st">"Reading Score"</span>) <span class="sc">+</span></span>
<span id="cb36-83"><a href="#cb36-83"></a>    <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">'lm'</span>) <span class="sc">+</span></span>
<span id="cb36-84"><a href="#cb36-84"></a>    <span class="fu">facet_wrap</span>(CNT<span class="sc">~</span>.)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>


</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>