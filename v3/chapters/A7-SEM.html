<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>MASTEMR - SEM</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><link rel="stylesheet" href="../css/mastemr.css">
</head>
<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg navbar-dark "><div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="index.qmd" class="navbar-brand navbar-brand-logo">
    <img src="../images/KCL_logo.png" alt="" class="navbar-logo"></a>
    <a class="navbar-brand" href="index.qmd">
    <span class="navbar-title">MASTEMR</span>
    </a>
  </div>
        <div class="quarto-navbar-tools ms-auto">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/A7-SEM.html">Additional tests</a></li><li class="breadcrumb-item"><a href="../chapters/A7-SEM.html">SEM</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto"><div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Sessions</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/01-Intro_to_quant_methods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">01 Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">02 Introduction to R</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/02-1-Intro_to_analysis_software.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/02-2-Intro_to_analysis_software.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Loading packages and exploring data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/02-3-Intro_to_analysis_software.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Piping and dplyr</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/02-4-Intro_to_graphs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Making graphs</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/03-Descriptive.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">03 Descriptive Statistics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/04-Presentations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">04 Presentations</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/05-Introduction_to_PISA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">05 Introduction to PISA</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/06-ChisqPISA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">06 Hypothesis testing and Chi-square tests</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/07-T-testsPISA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">07 T-tests</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/08-Writing_report.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">08 Writing a quantitative report</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/09-Assignment_3_tutorials.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">09 Assignment 3 tutorials</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/10-Correlation_and_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">10 Correlation and regression</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/11-selecting_statistical_tools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">11 Selecting statistical tools</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/12-value_of_quant.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">12 The value of quantitative methods</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/QandA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Questions and Answers</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Additional tests</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A7-SEM.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">SEM</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Appendicies</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A1-PISA_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">PISA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A2-DfE_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DfE England</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A3-TIMSS_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TIMSS, PIRLS and ICILS</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A4-Other_datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Other datasets</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A5-Self_Study_Tasks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Self Study Tasks</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li>
<a href="#structural-equation-modelling" id="toc-structural-equation-modelling" class="nav-link active" data-scroll-target="#structural-equation-modelling"><span class="header-section-number">1</span> Structural Equation Modelling</a>
  <ul class="collapse">
<li><a href="#a-simple-structural-model" id="toc-a-simple-structural-model" class="nav-link" data-scroll-target="#a-simple-structural-model"><span class="header-section-number">1.0.1</span> A simple structural model</a></li>
  <li>
<a href="#model-syntax" id="toc-model-syntax" class="nav-link" data-scroll-target="#model-syntax"><span class="header-section-number">1.1</span> Model Syntax</a>
  <ul class="collapse">
<li><a href="#modelling-a-latent-variable" id="toc-modelling-a-latent-variable" class="nav-link" data-scroll-target="#modelling-a-latent-variable"><span class="header-section-number">1.1.1</span> Modelling a latent variable</a></li>
  <li><a href="#formatting-a-path-diagram" id="toc-formatting-a-path-diagram" class="nav-link" data-scroll-target="#formatting-a-path-diagram"><span class="header-section-number">1.1.2</span> Formatting a path diagram</a></li>
  </ul>
</li>
  <li>
<a href="#tasks" id="toc-tasks" class="nav-link" data-scroll-target="#tasks"><span class="header-section-number">1.2</span> Tasks</a>
  <ul class="collapse">
<li><a href="#task-1---create-a-model-of-reading-score" id="toc-task-1---create-a-model-of-reading-score" class="nav-link" data-scroll-target="#task-1---create-a-model-of-reading-score"><span class="header-section-number">1.2.1</span> Task 1 - create a model of reading score</a></li>
  <li><a href="#task-2---modelling-a-latent-variable-for-the-home-environment" id="toc-task-2---modelling-a-latent-variable-for-the-home-environment" class="nav-link" data-scroll-target="#task-2---modelling-a-latent-variable-for-the-home-environment"><span class="header-section-number">1.2.2</span> Task 2 - Modelling a latent variable for the home environment</a></li>
  <li><a href="#task-3---building-a-more-complex-latent-varibale-sem" id="toc-task-3---building-a-more-complex-latent-varibale-sem" class="nav-link" data-scroll-target="#task-3---building-a-more-complex-latent-varibale-sem"><span class="header-section-number">1.2.3</span> Task 3 - building a more complex latent varibale SEM</a></li>
  </ul>
</li>
  </ul>
</li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">SEM</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><section id="structural-equation-modelling" class="level1" data-number="1"><h1 data-number="1">
<span class="header-section-number">1</span> Structural Equation Modelling</h1>
<p>Structural Equation Modelling (SEM) is an approach to represent the correlations between a number of variables linked to some phenomenon. A dependent variable (for example, scores on some test) might be linked to a number of independent variables (for example, hours of study, teacher’s level of experience, etc.). A powerful aspect of SEM is that it can be used to construct latent variables - variables which have explanatory usefulness but can’t be measured directly.</p>
<p>For example, a researcher might wish to investigate how home environment impacts students’ mathematics achievement. There is no single variable, no single score, that can be measured to say a young person’s home environment is a 7/10 or a 3/10. We might then consider their home environment a latent variable. We imagine that the nature of the circumstances in their home impacts their learning, but we cannot directly report the level of the home environment as a variable.</p>
<p>SEM allows us to propose a latent variable, like home environment, and calculate the contribution of a number of variables we can measure (e.g.&nbsp;the number of books in the home, parents’ occupation and level of education, family wealth, etc.) to the latent variable.</p>
<section id="a-simple-structural-model" class="level3" data-number="1.0.1"><h3 data-number="1.0.1" class="anchored" data-anchor-id="a-simple-structural-model">
<span class="header-section-number">1.0.1</span> A simple structural model</h3>
<p>Researchers use SEM to determine the correlations between a number of variable in a data set. It allows the relationship between multiple variables to be taken into account.</p>
<p>In the PISA data set, in the context of data related to UK students achievement in mathematics, a researcher might be interested in building a model of mathematics (<code>PV1MATH</code>) score by a number of variables in the data set, for example, reading score <code>PV1READ</code>), science score (<code>PV1SCIE</code>), family cultural capital (the index of economic, social and cultural status <code>ESCS</code>), wealth (<code>WEALTH</code>) and gender (<code>ST004D01T</code>). SEM can be used to represent the relationship between these variables and students’ mathematics achievement.</p>
<p>To create the SEM we will use the <code>lavaan</code> package - <code>lavaan</code> is a contraction of Latent Variable Analysis and allows us to fit a number of different SEMs to data. We will also need to install the <code>semPlot</code> package. The relationships between variables in SEMs are often represented as path diagrams - representations in which variables are represented as squares or circles and arrows labelled with correlation coefficients join the variables to represent the relationships.<code>semPlot</code> allows use to draw path diagrams</p>
</section><section id="model-syntax" class="level2" data-number="1.1"><h2 data-number="1.1" class="anchored" data-anchor-id="model-syntax">
<span class="header-section-number">1.1</span> Model Syntax</h2>
<p>To create the SEM of UK mathematics achievement we first create a subset <code>data.frame</code> of UK data, <code>UKdata</code>. As <code>lavaan</code> uses numeric variables we need to convert gender (<code>ST004D01T</code>) to a numeric variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># Load lavaan to create the SEM and semPlot to draw path diagrams</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(lavaan)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">library</span>(semPlot)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="co"># Create a subset of PISA data related to the UK containing the dependent variable of interest (PV1MATH) and the independent variables we are interested in</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>UKdata<span class="ot">&lt;-</span>PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb1-6"><a href="#cb1-6"></a>  <span class="fu">select</span>(CNT, PV1SCIE, PV1MATH, PV1READ, ESCS, HOMEPOS, ST004D01T)<span class="sc">%&gt;%</span></span>
<span id="cb1-7"><a href="#cb1-7"></a>  <span class="fu">filter</span>(CNT<span class="sc">==</span><span class="st">"United Kingdom"</span>)</span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="co"># lavaan requires numeric variables as input, gender is a character varibale in the data.frame so convert it.</span></span>
<span id="cb1-9"><a href="#cb1-9"></a>UKdata<span class="sc">$</span>ST004D01T<span class="ot">&lt;-</span><span class="fu">as.numeric</span>(UKdata<span class="sc">$</span>ST004D01T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The first step is to create the model. Models in <code>lavaan</code> are represented as a dependent variable <code>y</code>, linked to a number of independent variables <code>x1</code>, <code>x2</code>, <code>x3</code>, etc. The <code>~</code> symbol is the regression operator. A simple regression forumla might then take the form of:</p>
<p>y ~ x1 + x2 + x3</p>
<p>To indicate a variable is a latent variable we use the <code>=~</code> operator. So to define a model in which the latent variable <code>f1</code> varies with three indepdent variables we would write:</p>
<p>f1 =~ x1 + x2 + x3</p>
<p>In some cases, the independent variables may correlate. For example, if we are investigating mathematics achievement (the dependent variable, <code>y</code>), by looking at the independent variables of reading (<code>x1</code>) and science score (<code>x2</code>), it may be the case that reading and science cores covary (that is changes to one impacts the other). In this case, we can specify covariance in our model by stating:</p>
<p>y ~ x1 + x2 The regression model x1 ~ x2 Indicating the covariance</p>
<p>In our case, considering UK mathematics achievement, we can set up a model that mathematics score <code>PV1MATH</code> varies with science score <code>PV1SCIE</code>, reading score <code>PV1READ</code>, cultural resources in the home <code>ESCS</code>, a wealth proxy measure, HOMEPOS and gender <code>ST004D01T</code>: <code>model&lt;-"PV1MATH ~ PV1SCIE + PV1READ + ESCS + HOMEPOS"</code></p>
<p>We then pass the model, and the <code>data.frame</code> to the <code>sem</code> function: <code>fit&lt;-sem(model, data=UKdata)</code>. This produces a model as the ouput <code>fit</code>. To see the results we call <code>summary(fit)</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>model<span class="ot">&lt;-</span><span class="st">"PV1MATH ~ PV1SCIE + PV1READ + ESCS + HOMEPOS"</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>fit<span class="ot">&lt;-</span><span class="fu">sem</span>(model, <span class="at">data=</span>UKdata)</span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="fu">summary</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>lavaan 0.6.17 ended normally after 1 iteration

  Estimator                                         ML
  Optimization method                           NLMINB
  Number of model parameters                         5

                                                  Used       Total
  Number of observations                         11083       12972

Model Test User Model:
                                                      
  Test statistic                                 0.000
  Degrees of freedom                                 0

Parameter Estimates:

  Standard errors                             Standard
  Information                                 Expected
  Information saturated (h1) model          Structured

Regressions:
                   Estimate   Std.Err  z-value  P(&gt;|z|)
  PV1MATH ~                                            
    PV1SCIE            0.565    0.007   85.604    0.000
    PV1READ            0.267    0.006   41.953    0.000
    ESCS               5.432    0.734    7.404    0.000
    HOMEPOS            1.027    0.716    1.434    0.151

Variances:
                   Estimate   Std.Err  z-value  P(&gt;|z|)
   .PV1MATH         2006.033   26.948   74.441    0.000</code></pre>
</div>
</div>
<p>In the regressions table, the function returns the value of the regression coefficients for each independent variable, and the P value (<code>P(&gt;|z|)</code>). Note in the model above all the independent variables are significant, but the largest loading comes from the <code>WEALTH</code> variable, with the science (<code>PV1SCIE</code>) and reading (<code>PV1READ</code>) scores contributing comparatively little.</p>
<p>Finally, to produce a visual representation of the model, we pass our model, <code>fit</code> to the <code>semPaths</code> function (from the <code>semPlot</code> package we loaded above). We can specify was we want displayed on the lines, in this case the estimate of the regression coefficients between the variables.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="A7-SEM_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<p>In path diagrams, directly measured variables, manifest variables, are shown as squares. Latent variables are represented as circles. Single headed arrows represent the regression effects between variables. The curved arrows starting and ending on a square or circle indicate the variances of those variables. When curved arrows start and end on different variables, they represent covariance.</p>
<p>One issue to note here is the difference in the variance for the science and mathematics scores. <code>PV1SCIE</code>, <code>PV1READ</code> and <code>PV1MATH</code> are test scores and so have a large variance (the maximum and minimum science scores, for example, are 0.0 and 895.4). The variance of the two test variables is much greater that for <code>HOMEPOS</code> (Min=-10.0741 mean=-0.4447, Max=15.240) and <code>ESCS</code> (Min=-6.841 mean=-0.310, Max=7.380).</p>
<p>To resolve this difference, we can use the scale function to create a similar scale for <code>PV1SCIE</code>, <code>PV1MATH</code> and <code>PV1READ</code>. The <code>scale</code> function sets the mean of the variable to 0 and the variance to 1.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>UKdata<span class="sc">$</span>PV1READ<span class="ot">&lt;-</span><span class="fu">scale</span>(UKdata<span class="sc">$</span>PV1READ)</span>
<span id="cb4-2"><a href="#cb4-2"></a>UKdata<span class="sc">$</span>PV1MATH<span class="ot">&lt;-</span><span class="fu">scale</span>(UKdata<span class="sc">$</span>PV1MATH)</span>
<span id="cb4-3"><a href="#cb4-3"></a>UKdata<span class="sc">$</span>PV1SCIE<span class="ot">&lt;-</span><span class="fu">scale</span>(UKdata<span class="sc">$</span>PV1SCIE)</span>
<span id="cb4-4"><a href="#cb4-4"></a></span>
<span id="cb4-5"><a href="#cb4-5"></a>fit<span class="ot">&lt;-</span><span class="fu">sem</span>(model, <span class="at">data=</span>UKdata)</span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="fu">summary</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>lavaan 0.6.17 ended normally after 1 iteration

  Estimator                                         ML
  Optimization method                           NLMINB
  Number of model parameters                         5

                                                  Used       Total
  Number of observations                         11083       12972

Model Test User Model:
                                                      
  Test statistic                                 0.000
  Degrees of freedom                                 0

Parameter Estimates:

  Standard errors                             Standard
  Information                                 Expected
  Information saturated (h1) model          Structured

Regressions:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
  PV1MATH ~                                           
    PV1SCIE           0.607    0.007   85.604    0.000
    PV1READ           0.295    0.007   41.953    0.000
    ESCS              0.057    0.008    7.404    0.000
    HOMEPOS           0.011    0.008    1.434    0.151

Variances:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
   .PV1MATH           0.222    0.003   74.441    0.000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="fu">semPaths</span>(fit, <span class="at">whatLabels =</span> <span class="st">"Estimate"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="A7-SEM_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<p>Scaling the test scores gives a more balanced model.</p>
<p>We can make the model more complex, by adding that two or our independent variables, reading (<code>PV1READ</code>) and science (<code>PV1SCIE</code>) scores may co-vary, and vary with other independent variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>model<span class="ot">&lt;-</span><span class="st">"PV1MATH ~ PV1SCIE + PV1READ + ESCS + HOMEPOS</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="st">        PV1READ ~~ PV1SCIE</span></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="st">        PV1READ ~ PV1SCIE + PV1MATH + ESCS + HOMEPOS</span></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="st">        PV1SCIE ~ PV1READ + PV1MATH + ESCS + HOMEPOS"</span></span>
<span id="cb7-5"><a href="#cb7-5"></a>fit<span class="ot">&lt;-</span><span class="fu">sem</span>(model, <span class="at">data=</span>UKdata)</span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="fu">summary</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>lavaan 0.6.17 ended normally after 23 iterations

  Estimator                                         ML
  Optimization method                           NLMINB
  Number of model parameters                        16

                                                  Used       Total
  Number of observations                         11083       12972

Model Test User Model:
                                                      
  Test statistic                                    NA
  Degrees of freedom                                -4
  P-value (Unknown)                                 NA

Parameter Estimates:

  Standard errors                             Standard
  Information                                 Expected
  Information saturated (h1) model          Structured

Regressions:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
  PV1MATH ~                                           
    PV1SCIE           0.454       NA                  
    PV1READ           0.171       NA                  
    ESCS              0.113       NA                  
    HOMEPOS           0.071       NA                  
  PV1READ ~                                           
    PV1SCIE           0.242       NA                  
    PV1MATH           0.386       NA                  
 [ reached getOption("max.print") -- omitted 7 rows ]

Covariances:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
 .PV1READ ~~                                          
   .PV1SCIE           0.065       NA                  

Variances:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
   .PV1MATH           0.282       NA                  
   .PV1READ           0.383       NA                  
   .PV1SCIE           0.340       NA                  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="fu">semPaths</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="A7-SEM_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="fu">semPaths</span>(fit, <span class="at">whatLabels =</span> <span class="st">"Estimate"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="A7-SEM_files/figure-html/unnamed-chunk-7-2.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<section id="modelling-a-latent-variable" class="level3" data-number="1.1.1"><h3 data-number="1.1.1" class="anchored" data-anchor-id="modelling-a-latent-variable">
<span class="header-section-number">1.1.1</span> Modelling a latent variable</h3>
<p>As introduced above, we can use SEM to model a latent variable. For example, we might assume that students have some underlying variable linked to their general intelligence. However, we have no way to directly measure their general intelligence. We do have data on their achievement in science (<code>PV1SCIE</code>), mathematics (<code>PV1MATH</code>) and reading (<code>PV1READ</code>) we might assume that as the latent variable of general achievement increases so does achievement in science, mathematics and reading.</p>
<p>To perform the analysis, we use the <code>=~</code> operator in our model, which indicates a latent variable. This time, our model then sets out that we are interested in a <code>lv</code> (latent variable) which varies with science (<code>PV1SCIE</code>), mathematics (<code>PV1MATH</code>) and reading (<code>PV1READ</code>) scores:</p>
<p>model&lt;-“lv =~ PV1SCIE + PV1READ + PV1MATH”</p>
<p>Then we run the model using <code>sem</code> in the same way as above, and plot the model using <code>semPaths</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># For a latent variable</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="co"># =~ means a latent variable</span></span>
<span id="cb11-3"><a href="#cb11-3"></a>model<span class="ot">&lt;-</span><span class="st">"lv =~ PV1SCIE + PV1READ + PV1MATH"</span></span>
<span id="cb11-4"><a href="#cb11-4"></a></span>
<span id="cb11-5"><a href="#cb11-5"></a>fit<span class="ot">&lt;-</span><span class="fu">sem</span>(model, <span class="at">data=</span>UKdata)</span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="fu">summary</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>lavaan 0.6.17 ended normally after 18 iterations

  Estimator                                         ML
  Optimization method                           NLMINB
  Number of model parameters                         6

  Number of observations                         12972

Model Test User Model:
                                                      
  Test statistic                                 0.000
  Degrees of freedom                                 0

Parameter Estimates:

  Standard errors                             Standard
  Information                                 Expected
  Information saturated (h1) model          Structured

Latent Variables:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
  lv =~                                               
    PV1SCIE           1.000                           
    PV1READ           0.919    0.006  143.596    0.000
    PV1MATH           1.015    0.006  175.355    0.000

Variances:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
   .PV1SCIE           0.145    0.003   43.323    0.000
   .PV1READ           0.278    0.004   66.360    0.000
   .PV1MATH           0.119    0.003   36.723    0.000
    lv                0.855    0.013   67.872    0.000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="fu">semPaths</span>(fit, <span class="at">whatLabels =</span> <span class="st">"Estimate"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="A7-SEM_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<p>The mode raises the question of how strong does correlation between independent variables and a proposed latent variable need to be. Cho and colleagues <span class="citation" data-cites="cho2020">(<a href="#ref-cho2020" role="doc-biblioref"><strong>cho2020?</strong></a>)</span> suggest that:</p>
<blockquote class="blockquote">
<p>“When N = 100, researchers may choose a GFI [Meaning Goodness-of-Fit Index] cutoff value of .89 …When N &gt; 100, researchers may choose a GFI cutoff value of .93” <span class="citation" data-cites="cho2020">(<a href="#ref-cho2020" role="doc-biblioref"><strong>cho2020?</strong></a>)</span></p>
</blockquote>
<p>We can develop a more complex latent variable model. Let us assume that UK students reading scores depend on two latent variables, home environment (e.g.&nbsp;number of books, parental level of education etc) and cognitive ability (e.g.&nbsp;as reported by science and mathematics scores). Here are some relevant variables:</p>
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 79%">
</colgroup>
<thead><tr class="header">
<th>Item name</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>ST005Q01JA</td>
<td>What is the <highest level="" of="" schooling=""> completed by your mother?</highest>
</td>
</tr>
<tr class="even">
<td>ST007Q01JA</td>
<td>What is the <highest level="" of="" schooling=""> completed by your father?</highest>
</td>
</tr>
<tr class="odd">
<td>ST256Q02JA</td>
<td>In your home: Classic literature (e.g.&nbsp;<shakespeare>)</shakespeare>
</td>
</tr>
<tr class="even">
<td>ST255Q01JA</td>
<td>How many books are there in your home?</td>
</tr>
<tr class="odd">
<td>HOMEPOS</td>
<td>Family Wealth</td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co"># Create a UK dataframe with plausible values</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>UKdata<span class="ot">&lt;-</span>PISA_2022<span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3"></a>  <span class="fu">select</span>(CNT, ESCS, HOMEPOS, ST007Q01JA, ST256Q02JA, ST255Q01JA,</span>
<span id="cb14-4"><a href="#cb14-4"></a>         PV1READ, PV1SCIE, PV1MATH)<span class="sc">%&gt;%</span></span>
<span id="cb14-5"><a href="#cb14-5"></a>  <span class="fu">filter</span>(CNT<span class="sc">==</span><span class="st">"United Kingdom"</span>)</span>
<span id="cb14-6"><a href="#cb14-6"></a></span>
<span id="cb14-7"><a href="#cb14-7"></a><span class="co"># Make varibale numeric for lavan</span></span>
<span id="cb14-8"><a href="#cb14-8"></a>UKdata<span class="sc">$</span>ST007Q01JA<span class="ot">&lt;-</span><span class="fu">as.numeric</span>(UKdata<span class="sc">$</span>ST007Q01JA)</span>
<span id="cb14-9"><a href="#cb14-9"></a>UKdata<span class="sc">$</span>ST256Q02JA<span class="ot">&lt;-</span><span class="fu">as.numeric</span>(UKdata<span class="sc">$</span>ST256Q02JA)</span>
<span id="cb14-10"><a href="#cb14-10"></a>UKdata<span class="sc">$</span>ST255Q01JA<span class="ot">&lt;-</span><span class="fu">as.numeric</span>(UKdata<span class="sc">$</span>ST255Q01JA)</span>
<span id="cb14-11"><a href="#cb14-11"></a></span>
<span id="cb14-12"><a href="#cb14-12"></a></span>
<span id="cb14-13"><a href="#cb14-13"></a><span class="co"># Scale the test scores</span></span>
<span id="cb14-14"><a href="#cb14-14"></a>UKdata<span class="sc">$</span>PV1READ<span class="ot">&lt;-</span><span class="fu">scale</span>(UKdata<span class="sc">$</span>PV1READ)</span>
<span id="cb14-15"><a href="#cb14-15"></a>UKdata<span class="sc">$</span>PV1MATH<span class="ot">&lt;-</span><span class="fu">scale</span>(UKdata<span class="sc">$</span>PV1MATH)</span>
<span id="cb14-16"><a href="#cb14-16"></a>UKdata<span class="sc">$</span>PV1SCIE<span class="ot">&lt;-</span><span class="fu">scale</span>(UKdata<span class="sc">$</span>PV1SCIE)</span>
<span id="cb14-17"><a href="#cb14-17"></a><span class="co"># Propose a model with two latent variables - one related to home (lvh), the other cognitive ability (lva)</span></span>
<span id="cb14-18"><a href="#cb14-18"></a>model<span class="ot">&lt;-</span><span class="st">"lvi =~ ESCS + HOMEPOS + ST007Q01JA + ST256Q02JA + ST255Q01JA</span></span>
<span id="cb14-19"><a href="#cb14-19"></a><span class="st">        lvc =~ PV1MATH + PV1READ</span></span>
<span id="cb14-20"><a href="#cb14-20"></a><span class="st">        PV1SCIE ~ lvi + lvc"</span></span>
<span id="cb14-21"><a href="#cb14-21"></a><span class="co"># Fit the model</span></span>
<span id="cb14-22"><a href="#cb14-22"></a>fit<span class="ot">&lt;-</span><span class="fu">sem</span>(model, <span class="at">data=</span>UKdata)</span>
<span id="cb14-23"><a href="#cb14-23"></a><span class="fu">summary</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>lavaan 0.6.17 ended normally after 32 iterations

  Estimator                                         ML
  Optimization method                           NLMINB
  Number of model parameters                        18

                                                  Used       Total
  Number of observations                          9156       12972

Model Test User Model:
                                                      
  Test statistic                              1743.454
  Degrees of freedom                                18
  P-value (Chi-square)                           0.000

Parameter Estimates:

  Standard errors                             Standard
  Information                                 Expected
  Information saturated (h1) model          Structured

Latent Variables:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
  lvi =~                                              
    ESCS              1.000                           
    HOMEPOS           1.133    0.012   91.099    0.000
    ST007Q01JA       -0.435    0.012  -37.662    0.000
    ST256Q02JA        0.947    0.020   46.529    0.000
    ST255Q01JA        1.381    0.019   72.078    0.000
  lvc =~                                              
    PV1MATH           1.000                           
 [ reached getOption("max.print") -- omitted 1 row ]

Regressions:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
  PV1SCIE ~                                           
    lvi               0.012    0.009    1.326    0.185
    lvc               0.991    0.008  121.309    0.000

Covariances:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
  lvi ~~                                              
    lvc               0.282    0.008   33.407    0.000

Variances:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
   .ESCS              0.239    0.005   46.204    0.000
   .HOMEPOS           0.148    0.005   28.609    0.000
   .ST007Q01JA        0.495    0.007   66.043    0.000
   .ST256Q02JA        1.448    0.022   65.016    0.000
   .ST255Q01JA        0.963    0.016   58.664    0.000
   .PV1MATH           0.122    0.004   30.114    0.000
   .PV1READ           0.293    0.005   56.485    0.000
   .PV1SCIE           0.155    0.004   36.360    0.000
 [ reached getOption("max.print") -- omitted 2 rows ]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="fu">semPaths</span>(fit, <span class="at">whatLabels =</span> <span class="st">"Estimate"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="A7-SEM_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<p>Interesting features to note are a) the much higher loading of the cognitive latent variable (lvc has a loading of 0.71) than the home environment (liv, loading 0.02); b) the roughly equal contribution of mathematics and reading scores to lvb (the cognitive ability latent variable); c) and interesting to note the negative loadings of parental education (ST005, and ST007) on the home enviroment latent variable.</p>
<p>Note the dotted line from the ESCS variable (truncated here to ESC) indicates that ESCS is acting as a marker variable, that is, it is fixed at 1.0, and the other variables determined relative to it. The same is true for <code>PV1MATH</code> for the ability latent variable.</p>
</section><section id="formatting-a-path-diagram" class="level3" data-number="1.1.2"><h3 data-number="1.1.2" class="anchored" data-anchor-id="formatting-a-path-diagram">
<span class="header-section-number">1.1.2</span> Formatting a path diagram</h3>
<p>There are a number of formatting options in the <code>semPaths</code> function.</p>
<p>Starting from this plot:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="fu">semPaths</span>(fit, <span class="at">whatLabels =</span> <span class="st">"Estimate"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="A7-SEM_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<ul>
<li>To rotate the plot (<code>rotation=2</code>):</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="fu">semPaths</span>(fit, <span class="at">whatLabels =</span> <span class="st">"Estimate"</span>, <span class="at">rotation=</span><span class="dv">2</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="A7-SEM_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<ul>
<li>To change the colour of the lines (<code>edge.color="blue"</code>) and the size of the nodes (<code>sizeMan=8</code>):</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="fu">semPaths</span>(fit, <span class="at">whatLabels =</span> <span class="st">"Estimate"</span>, <span class="at">rotation=</span><span class="dv">2</span>, <span class="at">edge.color=</span><span class="st">"blue"</span>, <span class="at">sizeMan =</span><span class="dv">8</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="A7-SEM_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<ul>
<li>To link the thickness of lines to their value (<code>"std"</code>):</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="fu">semPaths</span>(fit, <span class="at">whatLabels =</span> <span class="st">"Estimate"</span>, <span class="at">rotation=</span><span class="dv">2</span>, <span class="at">edge.color=</span><span class="st">"blue"</span>, </span>
<span id="cb20-2"><a href="#cb20-2"></a>         <span class="at">sizeMan =</span><span class="dv">5</span>, <span class="st">"std"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="A7-SEM_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<ul>
<li>To make the labels larger (<code>edge.label.cex = 0.8</code>):</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="fu">semPaths</span>(fit, <span class="at">whatLabels =</span> <span class="st">"Estimate"</span>, <span class="at">rotation=</span><span class="dv">2</span>, <span class="at">edge.color=</span><span class="st">"blue"</span>, </span>
<span id="cb21-2"><a href="#cb21-2"></a>         <span class="at">sizeMan =</span><span class="dv">5</span>, <span class="st">"std"</span>, <span class="at">edge.label.cex =</span> <span class="fl">0.8</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="A7-SEM_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<ul>
<li>To add a title (<code>title("PISA path diagram")</code>):</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="fu">semPaths</span>(fit, <span class="at">whatLabels =</span> <span class="st">"Estimate"</span>, <span class="at">rotation=</span><span class="dv">2</span>, <span class="at">edge.color=</span><span class="st">"blue"</span>, </span>
<span id="cb22-2"><a href="#cb22-2"></a>         <span class="at">sizeMan =</span><span class="dv">5</span>, <span class="st">"std"</span>, <span class="at">edge.label.cex =</span> <span class="fl">0.8</span>) </span>
<span id="cb22-3"><a href="#cb22-3"></a><span class="fu">title</span>(<span class="st">"PISA path diagram"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="A7-SEM_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
<ul>
<li>To give longer node names (<code>nodeNames=nodenames</code>):</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>nodenames<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"Economic, social and cultural status"</span>,</span>
<span id="cb23-2"><a href="#cb23-2"></a>             <span class="st">"Wealth"</span>,<span class="st">"Maternal Schooling"</span>,<span class="st">"Paternal Schooling"</span>,</span>
<span id="cb23-3"><a href="#cb23-3"></a>             <span class="st">"In home: classical literature"</span>,<span class="st">"Books in home"</span>,</span>
<span id="cb23-4"><a href="#cb23-4"></a>             <span class="st">"Math score"</span>, <span class="st">"Reading score"</span>, <span class="st">"Science Score"</span>)</span>
<span id="cb23-5"><a href="#cb23-5"></a><span class="fu">semPaths</span>(fit, <span class="at">whatLabels =</span> <span class="st">"Estimate"</span>, <span class="at">rotation=</span><span class="dv">2</span>, <span class="at">edge.color=</span><span class="st">"blue"</span>, </span>
<span id="cb23-6"><a href="#cb23-6"></a>         <span class="at">sizeMan =</span><span class="dv">5</span>, <span class="st">"std"</span>,, <span class="at">edge.label.cex =</span> <span class="fl">0.8</span>, <span class="at">nodeNames=</span>nodenames)</span>
<span id="cb23-7"><a href="#cb23-7"></a><span class="fu">title</span>(<span class="st">"PISA path diagram"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="A7-SEM_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section></section><section id="tasks" class="level2" data-number="1.2"><h2 data-number="1.2" class="anchored" data-anchor-id="tasks">
<span class="header-section-number">1.2</span> Tasks</h2>
<section id="task-1---create-a-model-of-reading-score" class="level3" data-number="1.2.1"><h3 data-number="1.2.1" class="anchored" data-anchor-id="task-1---create-a-model-of-reading-score">
<span class="header-section-number">1.2.1</span> Task 1 - create a model of reading score</h3>
<div class="question">
<p>Make a SEM of reading scores in the PISA data for students in the United States. Consider co-variation between independent variables. First consider what independent variables in the data set might influence reading scores. Some potential items of interest include:</p>
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 79%">
</colgroup>
<thead><tr class="header">
<th>Item name</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>ST005Q01JA</td>
<td>What is the <highest level="" of="" schooling=""> completed by your mother?</highest>
</td>
</tr>
<tr class="even">
<td>ST007Q01JA</td>
<td>What is the <highest level="" of="" schooling=""> completed by your father?</highest>
</td>
</tr>
<tr class="odd">
<td>ST256Q02JA</td>
<td>In your home: Classic literature (e.g.&nbsp;<shakespeare>)</shakespeare>
</td>
</tr>
<tr class="even">
<td>ST255Q01JA</td>
<td>How many books are there in your home?</td>
</tr>
<tr class="odd">
<td>HOMEPOS</td>
<td>Family Wealth</td>
</tr>
<tr class="even">
<td>ESCS</td>
<td>Index of economic, social and cultural status</td>
</tr>
<tr class="odd">
<td>ST254Q02JA</td>
<td>How many of the following [digital devices] are in your</td>
</tr>
<tr class="even">
<td></td>
<td>[home]: Desktop computers</td>
</tr>
</tbody>
</table>
</div>
<p>::: call-out warning</p>
<p>Don’t forget to convert any non-numeric variables to numeric</p>
<p>:::</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="co"># Using ST255Q01JA  How many books are there in your home?</span></span>
<span id="cb24-2"><a href="#cb24-2"></a><span class="co"># ST254Q02JA    How many in your home: Computers (desktop computer, portable laptop, or notebook)</span></span>
<span id="cb24-3"><a href="#cb24-3"></a>USdata<span class="ot">&lt;-</span>PISA_2022<span class="sc">%&gt;%</span></span>
<span id="cb24-4"><a href="#cb24-4"></a>  <span class="fu">select</span>(CNT, ESCS, HOMEPOS, PV1READ, ST255Q01JA, ST254Q02JA)<span class="sc">%&gt;%</span></span>
<span id="cb24-5"><a href="#cb24-5"></a>  <span class="fu">filter</span>(CNT<span class="sc">==</span><span class="st">"United States"</span>)</span>
<span id="cb24-6"><a href="#cb24-6"></a><span class="co"># Making ST255Q01JA and ST012Q06NA numeric</span></span>
<span id="cb24-7"><a href="#cb24-7"></a>USdata<span class="sc">$</span>ST255Q01JA<span class="ot">&lt;-</span><span class="fu">as.numeric</span>(USdata<span class="sc">$</span>ST255Q01JA)</span>
<span id="cb24-8"><a href="#cb24-8"></a>USdata<span class="sc">$</span>ST254Q02JA<span class="ot">&lt;-</span><span class="fu">as.numeric</span>(USdata<span class="sc">$</span>ST254Q02JA)</span>
<span id="cb24-9"><a href="#cb24-9"></a></span>
<span id="cb24-10"><a href="#cb24-10"></a></span>
<span id="cb24-11"><a href="#cb24-11"></a>model<span class="ot">&lt;-</span><span class="st">"PV1READ ~ ESCS + HOMEPOS + ST255Q01JA+ ST254Q02JA"</span></span>
<span id="cb24-12"><a href="#cb24-12"></a></span>
<span id="cb24-13"><a href="#cb24-13"></a>fit<span class="ot">&lt;-</span><span class="fu">sem</span>(model, <span class="at">data=</span>USdata)</span>
<span id="cb24-14"><a href="#cb24-14"></a><span class="fu">summary</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>lavaan 0.6.17 ended normally after 1 iteration

  Estimator                                         ML
  Optimization method                           NLMINB
  Number of model parameters                         5

                                                  Used       Total
  Number of observations                          4163        4552

Model Test User Model:
                                                      
  Test statistic                                 0.000
  Degrees of freedom                                 0

Parameter Estimates:

  Standard errors                             Standard
  Information                                 Expected
  Information saturated (h1) model          Structured

Regressions:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
  PV1READ ~                                           
    ESCS             14.866    2.326    6.390    0.000
    HOMEPOS          15.340    2.984    5.141    0.000
    ST255Q01JA       21.151    1.413   14.965    0.000
    ST254Q02JA      -20.733    2.150   -9.642    0.000

Variances:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
   .PV1READ        9987.581  218.913   45.623    0.000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="fu">semPaths</span>(fit, <span class="at">whatLabels =</span> <span class="st">"Estimate"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="A7-SEM_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section><section id="task-2---modelling-a-latent-variable-for-the-home-environment" class="level3" data-number="1.2.2"><h3 data-number="1.2.2" class="anchored" data-anchor-id="task-2---modelling-a-latent-variable-for-the-home-environment">
<span class="header-section-number">1.2.2</span> Task 2 - Modelling a latent variable for the home environment</h3>
<div class="question">
<p>There are a number of variables in the PISA data set that could be used to model the home environment (e.g.&nbsp;Number of books in the home, number of computers, etc.). Using the home environment for UK students as a latent variable, create a model of the home environment.</p>
</div>
<p>::: call-out warning</p>
<p>Don’t forget to convert any non-numeric variables to numeric</p>
<p>:::</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="co"># Using ST251Q06JA  How many of these items are there at your [home]: Musical instruments (e.g. guitar, piano, [country-specific example])</span></span>
<span id="cb27-2"><a href="#cb27-2"></a><span class="co"># and ST251Q07JA    How many of these items are there at your [home]: Works of art (e.g. paintings, sculptures, [country-specific example])</span></span>
<span id="cb27-3"><a href="#cb27-3"></a>UKdata<span class="ot">&lt;-</span>PISA_2022<span class="sc">%&gt;%</span></span>
<span id="cb27-4"><a href="#cb27-4"></a>  <span class="fu">select</span>(CNT, ESCS, HOMEPOS, ST251Q06JA, ST251Q07JA)<span class="sc">%&gt;%</span></span>
<span id="cb27-5"><a href="#cb27-5"></a>  <span class="fu">filter</span>(CNT<span class="sc">==</span><span class="st">"United Kingdom"</span>)</span>
<span id="cb27-6"><a href="#cb27-6"></a><span class="co"># Making variables numeric</span></span>
<span id="cb27-7"><a href="#cb27-7"></a>UKdata<span class="sc">$</span>ST251Q06JA<span class="ot">&lt;-</span><span class="fu">as.numeric</span>(UKdata<span class="sc">$</span>ST251Q06JA)</span>
<span id="cb27-8"><a href="#cb27-8"></a>UKdata<span class="sc">$</span>ST251Q07JA<span class="ot">&lt;-</span><span class="fu">as.numeric</span>(UKdata<span class="sc">$</span>ST251Q07JA)</span>
<span id="cb27-9"><a href="#cb27-9"></a>model<span class="ot">&lt;-</span><span class="st">"lv =~ ESCS + HOMEPOS + ST251Q06JA + ST251Q07JA "</span></span>
<span id="cb27-10"><a href="#cb27-10"></a></span>
<span id="cb27-11"><a href="#cb27-11"></a>fit<span class="ot">&lt;-</span><span class="fu">sem</span>(model, <span class="at">data=</span>UKdata)</span>
<span id="cb27-12"><a href="#cb27-12"></a><span class="fu">summary</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>lavaan 0.6.17 ended normally after 23 iterations

  Estimator                                         ML
  Optimization method                           NLMINB
  Number of model parameters                         8

                                                  Used       Total
  Number of observations                         10916       12972

Model Test User Model:
                                                      
  Test statistic                                86.359
  Degrees of freedom                                 2
  P-value (Chi-square)                           0.000

Parameter Estimates:

  Standard errors                             Standard
  Information                                 Expected
  Information saturated (h1) model          Structured

Latent Variables:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
  lv =~                                               
    ESCS              1.000                           
    HOMEPOS           1.278    0.016   82.129    0.000
    ST251Q06JA        0.930    0.016   58.374    0.000
    ST251Q07JA        0.936    0.018   52.611    0.000

Variances:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
   .ESCS              0.312    0.006   51.116    0.000
   .HOMEPOS           0.054    0.007    7.564    0.000
   .ST251Q06JA        0.960    0.014   70.282    0.000
   .ST251Q07JA        1.263    0.018   71.398    0.000
    lv                0.474    0.011   44.235    0.000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="fu">semPaths</span>(fit, <span class="at">whatLabels =</span> <span class="st">"Estimate"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="A7-SEM_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>
</section><section id="task-3---building-a-more-complex-latent-varibale-sem" class="level3" data-number="1.2.3"><h3 data-number="1.2.3" class="anchored" data-anchor-id="task-3---building-a-more-complex-latent-varibale-sem">
<span class="header-section-number">1.2.3</span> Task 3 - building a more complex latent varibale SEM</h3>
<div class="question">
<p>You believe that there are two latent variables underlying UK students’ performance in science - a science self-identity variable (related to the home environment, for example, gender, parents’ level of education) and a cognitive ability variable (indicated by performance in other subjects). Propose a model of science performance based on these two latent variables - linking each latent variable to multiple independent variables. Determine how much variance your model explains</p>
</div>
<p>::: call-out warning</p>
<p>Don’t forget to convert any non-numeric variables to numeric and consider scaling the test scores</p>
<p>:::</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="co"># Create a UK data frame with plausible values</span></span>
<span id="cb30-2"><a href="#cb30-2"></a>UKdata<span class="ot">&lt;-</span>PISA_2022<span class="sc">%&gt;%</span></span>
<span id="cb30-3"><a href="#cb30-3"></a>  <span class="fu">select</span>(CNT, ESCS, HOMEPOS, ST005Q01JA, ST007Q01JA, PV1READ, PV1SCIE, </span>
<span id="cb30-4"><a href="#cb30-4"></a>         PV1MATH, ST004D01T)<span class="sc">%&gt;%</span></span>
<span id="cb30-5"><a href="#cb30-5"></a>  <span class="fu">filter</span>(CNT<span class="sc">==</span><span class="st">"United Kingdom"</span>)</span>
<span id="cb30-6"><a href="#cb30-6"></a><span class="co"># Convert to numeric where not numeric</span></span>
<span id="cb30-7"><a href="#cb30-7"></a>UKdata<span class="sc">$</span>ST005Q01JA<span class="ot">&lt;-</span><span class="fu">as.numeric</span>(UKdata<span class="sc">$</span>ST005Q01JA)</span>
<span id="cb30-8"><a href="#cb30-8"></a>UKdata<span class="sc">$</span>ST007Q01JA<span class="ot">&lt;-</span><span class="fu">as.numeric</span>(UKdata<span class="sc">$</span>ST007Q01JA)</span>
<span id="cb30-9"><a href="#cb30-9"></a>UKdata<span class="sc">$</span>ST004D01T<span class="ot">&lt;-</span><span class="fu">as.numeric</span>(UKdata<span class="sc">$</span>ST004D01T)</span>
<span id="cb30-10"><a href="#cb30-10"></a></span>
<span id="cb30-11"><a href="#cb30-11"></a><span class="co"># Scale the test scores</span></span>
<span id="cb30-12"><a href="#cb30-12"></a>UKdata<span class="sc">$</span>PV1READ<span class="ot">&lt;-</span><span class="fu">scale</span>(UKdata<span class="sc">$</span>PV1READ)</span>
<span id="cb30-13"><a href="#cb30-13"></a>UKdata<span class="sc">$</span>PV1MATH<span class="ot">&lt;-</span><span class="fu">scale</span>(UKdata<span class="sc">$</span>PV1MATH)</span>
<span id="cb30-14"><a href="#cb30-14"></a>UKdata<span class="sc">$</span>PV1SCIE<span class="ot">&lt;-</span><span class="fu">scale</span>(UKdata<span class="sc">$</span>PV1SCIE)</span>
<span id="cb30-15"><a href="#cb30-15"></a><span class="co"># Propose a model with two latent variables - one related to identity (lvi), the other ability (lva)</span></span>
<span id="cb30-16"><a href="#cb30-16"></a>model<span class="ot">&lt;-</span><span class="st">"lvi =~ ESCS + HOMEPOS + ST005Q01JA + ST007Q01JA + ST004D01T</span></span>
<span id="cb30-17"><a href="#cb30-17"></a><span class="st">        lva =~ PV1MATH + PV1READ</span></span>
<span id="cb30-18"><a href="#cb30-18"></a><span class="st">        PV1SCIE ~ lvi + lva"</span></span>
<span id="cb30-19"><a href="#cb30-19"></a><span class="co"># Fit the model</span></span>
<span id="cb30-20"><a href="#cb30-20"></a>fit<span class="ot">&lt;-</span><span class="fu">sem</span>(model, <span class="at">data=</span>UKdata)</span>
<span id="cb30-21"><a href="#cb30-21"></a><span class="fu">summary</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>lavaan 0.6.17 ended normally after 34 iterations

  Estimator                                         ML
  Optimization method                           NLMINB
  Number of model parameters                        18

                                                  Used       Total
  Number of observations                          9683       12972

Model Test User Model:
                                                      
  Test statistic                              1738.699
  Degrees of freedom                                18
  P-value (Chi-square)                           0.000

Parameter Estimates:

  Standard errors                             Standard
  Information                                 Expected
  Information saturated (h1) model          Structured

Latent Variables:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
  lvi =~                                              
    ESCS              1.000                           
    HOMEPOS           0.833    0.010   79.702    0.000
    ST005Q01JA       -0.430    0.008  -51.306    0.000
    ST007Q01JA       -0.437    0.009  -47.015    0.000
    ST004D01T         0.001    0.006    0.175    0.861
  lva =~                                              
    PV1MATH           1.000                           
 [ reached getOption("max.print") -- omitted 1 row ]

Regressions:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
  PV1SCIE ~                                           
    lvi               0.004    0.007    0.518    0.605
    lva               0.991    0.008  131.633    0.000

Covariances:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
  lvi ~~                                              
    lva               0.312    0.009   33.677    0.000

Variances:
                   Estimate  Std.Err  z-value  P(&gt;|z|)
   .ESCS              0.046    0.007    7.049    0.000
   .HOMEPOS           0.327    0.007   49.672    0.000
   .ST005Q01JA        0.366    0.005   67.130    0.000
   .ST007Q01JA        0.470    0.007   67.762    0.000
   .ST004D01T         0.250    0.004   69.581    0.000
   .PV1MATH           0.122    0.004   30.788    0.000
   .PV1READ           0.296    0.005   57.937    0.000
   .PV1SCIE           0.157    0.004   37.728    0.000
 [ reached getOption("max.print") -- omitted 2 rows ]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="fu">semPaths</span>(fit, <span class="at">whatLabels =</span> <span class="st">"Estimate"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="A7-SEM_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" style="width:95.0%"></p>
</div>
</div>


</section></section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>