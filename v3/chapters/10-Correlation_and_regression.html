<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>10 Correlation and regression – MASTEMR</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><link rel="stylesheet" href="../css/mastemr.css">
</head>
<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../images/KCL_logo.png" alt="" class="navbar-logo"></a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">MASTEMR</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/10-Correlation_and_regression.html">10 Correlation and regression</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto"><div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Sessions</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/01-Intro_to_quant_methods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">01 Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">02 Introduction to R</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/02-1-Intro_to_analysis_software.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/02-2-Intro_to_analysis_software.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Loading packages and exploring data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/02-3-Intro_to_analysis_software.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Piping and dplyr</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/02-4-Intro_to_graphs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Making graphs</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/03-Descriptive.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">03 Descriptive Statistics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/04-Introduction_to_PISA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">04 Introduction to PISA</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/05-Presentations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">05 Presentations</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/06-T-testsPISA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">06 T-tests</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/07-ChisqPISA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">07 Hypothesis testing and Chi-square tests</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/08-Writing_report.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">08 Writing a quantitative report</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/09-Assignment_3_tutorials.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">09 Assignment 3 tutorials</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/10-Correlation_and_regression.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">10 Correlation and regression</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/11-selecting_statistical_tools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">11 Selecting statistical tools</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/12-value_of_quant.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">12 The value of quantitative methods</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Additional tests</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A8-SEM.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SEM</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendicies</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A1-PISA_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">PISA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A2-DfE_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DfE England</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A3-TIMSS_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TIMSS, PIRLS and ICILS</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A4-Other_datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Other datasets</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A5-Self_Study_Tasks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Self Study Tasks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/A6-QandA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Questions and Answers</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li>
<a href="#pre-reading-and-pre-session-tasks" id="toc-pre-reading-and-pre-session-tasks" class="nav-link active" data-scroll-target="#pre-reading-and-pre-session-tasks"><span class="header-section-number">1</span> Pre-reading and pre-session tasks</a>
  <ul class="collapse">
<li><a href="#pre-reading" id="toc-pre-reading" class="nav-link" data-scroll-target="#pre-reading"><span class="header-section-number">1.1</span> Pre-reading</a></li>
  <li><a href="#pre-session-task" id="toc-pre-session-task" class="nav-link" data-scroll-target="#pre-session-task"><span class="header-section-number">1.2</span> Pre-session task</a></li>
  </ul>
</li>
  <li><a href="#correlation-and-linear-regression" id="toc-correlation-and-linear-regression" class="nav-link" data-scroll-target="#correlation-and-linear-regression"><span class="header-section-number">2</span> Correlation and linear regression</a></li>
  <li>
<a href="#correlation" id="toc-correlation" class="nav-link" data-scroll-target="#correlation"><span class="header-section-number">3</span> Correlation</a>
  <ul class="collapse">
<li><a href="#other-correlation-coefficients" id="toc-other-correlation-coefficients" class="nav-link" data-scroll-target="#other-correlation-coefficients"><span class="header-section-number">3.1</span> Other correlation-coefficients</a></li>
  <li><a href="#checking-the-assumptions-of-the-model" id="toc-checking-the-assumptions-of-the-model" class="nav-link" data-scroll-target="#checking-the-assumptions-of-the-model"><span class="header-section-number">3.2</span> Checking the assumptions of the model</a></li>
  <li><a href="#reporting-correlations" id="toc-reporting-correlations" class="nav-link" data-scroll-target="#reporting-correlations"><span class="header-section-number">3.3</span> Reporting correlations</a></li>
  <li><a href="#questions-correlation" id="toc-questions-correlation" class="nav-link" data-scroll-target="#questions-correlation"><span class="header-section-number">3.4</span> Questions: Correlation</a></li>
  </ul>
</li>
  <li>
<a href="#regression" id="toc-regression" class="nav-link" data-scroll-target="#regression"><span class="header-section-number">4</span> Regression</a>
  <ul class="collapse">
<li><a href="#linear-models-and-regression" id="toc-linear-models-and-regression" class="nav-link" data-scroll-target="#linear-models-and-regression"><span class="header-section-number">4.1</span> Linear models and regression</a></li>
  <li><a href="#r-squared" id="toc-r-squared" class="nav-link" data-scroll-target="#r-squared"><span class="header-section-number">4.2</span> R squared</a></li>
  <li><a href="#questions-regression" id="toc-questions-regression" class="nav-link" data-scroll-target="#questions-regression"><span class="header-section-number">4.3</span> Questions: Regression</a></li>
  </ul>
</li>
  <li>
<a href="#multivariable-linear-regression" id="toc-multivariable-linear-regression" class="nav-link" data-scroll-target="#multivariable-linear-regression"><span class="header-section-number">5</span> Multivariable linear regression</a>
  <ul class="collapse">
<li><a href="#checking-the-assumptions-of-the-model-1" id="toc-checking-the-assumptions-of-the-model-1" class="nav-link" data-scroll-target="#checking-the-assumptions-of-the-model-1"><span class="header-section-number">5.1</span> Checking the assumptions of the model</a></li>
  <li><a href="#reporting-regression" id="toc-reporting-regression" class="nav-link" data-scroll-target="#reporting-regression"><span class="header-section-number">5.2</span> Reporting regression</a></li>
  <li><a href="#questions-multivariable-regression" id="toc-questions-multivariable-regression" class="nav-link" data-scroll-target="#questions-multivariable-regression"><span class="header-section-number">5.3</span> Questions: Multivariable regression</a></li>
  </ul>
</li>
  <li>
<a href="#logistic-regression" id="toc-logistic-regression" class="nav-link" data-scroll-target="#logistic-regression"><span class="header-section-number">6</span> Logistic regression</a>
  <ul class="collapse">
<li><a href="#checking-the-assumptions-of-logistic-regression" id="toc-checking-the-assumptions-of-logistic-regression" class="nav-link" data-scroll-target="#checking-the-assumptions-of-logistic-regression"><span class="header-section-number">6.1</span> Checking the assumptions of logistic regression</a></li>
  </ul>
</li>
  <li><a href="#seminar-tasks" id="toc-seminar-tasks" class="nav-link" data-scroll-target="#seminar-tasks"><span class="header-section-number">7</span> Seminar Tasks</a></li>
  <li>
<a href="#extension-topics" id="toc-extension-topics" class="nav-link" data-scroll-target="#extension-topics"><span class="header-section-number">8</span> Extension topics</a>
  <ul class="collapse">
<li><a href="#sec-z-values" id="toc-sec-z-values" class="nav-link" data-scroll-target="#sec-z-values"><span class="header-section-number">8.1</span> Standardising results with z-values</a></li>
  <li><a href="#sec-Stoet-Geary" id="toc-sec-Stoet-Geary" class="nav-link" data-scroll-target="#sec-Stoet-Geary"><span class="header-section-number">8.2</span> Recreating Stoet and Geary’s paper</a></li>
  <li><a href="#loading-data-sets" id="toc-loading-data-sets" class="nav-link" data-scroll-target="#loading-data-sets"><span class="header-section-number">8.3</span> Loading data sets</a></li>
  <li><a href="#sec-leftjoin" id="toc-sec-leftjoin" class="nav-link" data-scroll-target="#sec-leftjoin"><span class="header-section-number">8.4</span> Linking data using <code>left_join</code></a></li>
  <li><a href="#sec-standard-stoet-geary" id="toc-sec-standard-stoet-geary" class="nav-link" data-scroll-target="#sec-standard-stoet-geary"><span class="header-section-number">8.5</span> Standardising PISA results</a></li>
  </ul>
</li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">10 Correlation and regression</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><!-- Correlation 
https://docs.google.com/presentation/d/1QlXhCOaFMRyg8IJ2JczKkpjx26eS9BRi/edit#slide=id.p1--><!-- Correlation 
https://docs.google.com/presentation/d/1QlXhCOaFMRyg8IJ2JczKkpjx26eS9BRi/edit#slide=id.p1
@mikk2016relationships

DOCTR slides
https://docs.google.com/presentation/d/1j2IhhnBSrg0sM4HuUE5thO0rMLz2W48scylbdPOmAlo/edit#slide=id.p 
--><section id="pre-reading-and-pre-session-tasks" class="level1" data-number="1"><h1 data-number="1">
<span class="header-section-number">1</span> Pre-reading and pre-session tasks</h1>
<section id="pre-reading" class="level2" data-number="1.1"><h2 data-number="1.1" class="anchored" data-anchor-id="pre-reading">
<span class="header-section-number">1.1</span> Pre-reading</h2>
</section><section id="pre-session-task" class="level2" data-number="1.2"><h2 data-number="1.2" class="anchored" data-anchor-id="pre-session-task">
<span class="header-section-number">1.2</span> Pre-session task</h2>
</section></section><section id="correlation-and-linear-regression" class="level1" data-number="2"><h1 data-number="2">
<span class="header-section-number">2</span> Correlation and linear regression</h1>
<p>In this session we will be exploring the use of <strong>linear regression</strong> to describe data and predict results. We will be looking for patterns within the PISA data sets, as well we trying to recreate some of the controversial findings from <span class="citation" data-cites="stoet2018gender">Stoet and Geary (<a href="#ref-stoet2018gender" role="doc-biblioref">2018</a>)</span> by linking <code>PISA_2018</code> data to global gender equality indices using the <code>left_join</code> function.</p>
<p>There are two types of statistics that we can create:</p>
<p><strong>Descriptive statistics</strong> describe/summarise a data set. E.g. what’s the average height of a woman, how many people called George were born in Somerset each year since 1921?</p>
<p><strong>Inferential statistics</strong> estimate something from a set of data, make generalisations about larger populations. E.g. If I know the height of a woman, can I predict her shoe size? If I meet someone called George, what is the likelihood that they were born in Somerset?</p>
<p>The first few sessions of this course taught you how to use R to perform descriptive statistics, with you finding the <code>mean</code>, <code>max</code>, <code>min</code> etc of data. Following sessions have given you a range of inferential tools, for example chi-square, t-tests and ANOVA. This session will introduce you to <em>linear regression</em> a means by which you can predict the value of a variable based on the value of another variable. Before we can start using linear regression we will introduce you to <em>correlation</em>, another type of inferential statistics.</p>
</section><section id="correlation" class="level1" data-number="3"><h1 data-number="3">
<span class="header-section-number">3</span> Correlation</h1>
<p>Correlation gives the direction and strength of the relationship between two numeric variables. For example we might see a relationship between the reading level of a student and their maths results in the UK: the better a student is at reading, typically, the higher their maths grade. Correlation allows us to describe this relation statistically:</p>
<div class="cell">
<details class="code-fold"><summary>code</summary><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>corr_data <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span> </span>
<span id="cb1-2"><a href="#cb1-2"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-3"><a href="#cb1-3"></a>  <span class="fu">select</span>(PV1MATH, PV1READ, ST004D01T)</span>
<span id="cb1-4"><a href="#cb1-4"></a></span>
<span id="cb1-5"><a href="#cb1-5"></a>corr <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(corr_data<span class="sc">$</span>PV1MATH, corr_data<span class="sc">$</span>PV1READ, <span class="at">method =</span> <span class="st">"pearson"</span>)</span>
<span id="cb1-6"><a href="#cb1-6"></a>corr_est <span class="ot">&lt;-</span> <span class="fu">signif</span>(corr[[<span class="st">"estimate"</span>]],<span class="dv">4</span>)</span>
<span id="cb1-7"><a href="#cb1-7"></a></span>
<span id="cb1-8"><a href="#cb1-8"></a></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="fu">ggplot</span>(<span class="at">data =</span> corr_data, <span class="fu">aes</span>(PV1MATH, PV1READ)) <span class="sc">+</span></span>
<span id="cb1-10"><a href="#cb1-10"></a>  <span class="fu">geom_point</span>(<span class="at">alpha=</span><span class="fl">0.1</span>) <span class="sc">+</span> </span>
<span id="cb1-11"><a href="#cb1-11"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb1-12"><a href="#cb1-12"></a>  <span class="fu">geom_text</span>(<span class="at">label=</span><span class="fu">paste</span>(<span class="st">"r = "</span>, corr_est), <span class="fu">aes</span>(<span class="at">x=</span><span class="dv">700</span>,<span class="at">y=</span><span class="sc">-</span><span class="fl">4.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="10-Correlation_and_regression_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>The graph above shows that there is a correlation between Maths score and Reading score. This relationship is a <em>positive</em> one, i.e.&nbsp;as the reading level of an individual increases the maths grade is also likely to increase. The strength, <em>correlation coefficient</em> (<code>Pearson's r</code>) of the relationship between these two numeric fields is 0.7974. The correlation coefficient runs from -1 to +1.</p>
<ul>
<li>If the correlation coefficient (r) is <em>negative</em>, i.e.&nbsp;as one factor increase the other declines, the slope of the line of best-fit will be negative. E.g “The more time you spend running on a treadmill, the more calories you will burn”</li>
<li>If the correlation coefficient (r) is <em>positive</em>, i.e.&nbsp;as one factor increase the other increases, the slope of the line of best-fit will be positive. E.g. “As the temperature decreases, more heaters are purchased.”</li>
<li>If the correlation coefficient (r) is 0, i.e one factor increasing doesn’t impact the other factor, the slope of the line of best-fit will be flat. E.g. “the number of trees in a city has no relation to the number of chocolate bars purchased by children”</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="10-Correlation_and_regression_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>To run the correlation test in R we use the <code>cor.test</code> function:</p>
<p><code>cor.test(&lt;vector1&gt;, &lt;vector2&gt;, method = "pearson")</code></p>
<p>For our data we will be using the <code>PV1MATH</code> and <code>PV1READ</code> columns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="fu">cor.test</span>(corr_data<span class="sc">$</span>PV1MATH, corr_data<span class="sc">$</span>PV1READ, <span class="at">method =</span> <span class="st">"pearson"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's product-moment correlation

data:  corr_data$PV1MATH and corr_data$PV1READ
t = 150.47, df = 12970, p-value &lt; 2.2e-16
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 0.7909995 0.8035376
sample estimates:
      cor 
0.7973546 </code></pre>
</div>
</div>
<ul>
<li>
<code>df</code> the number of ways that the data can vary, the larger this number the more ways the data could have been different</li>
<li>
<code>p-value</code> significance of the result, can we dismiss the null-hypothesis that there isn’t a relationship between maths score and wealth as the p-value is less than <code>0.05</code>
</li>
<li>
<code>sample estimates</code> the strength of the relationship between the factors</li>
<li>
<code>confidence intervals</code> the upper and lower limit of where the correlation coefficient is likely to lie, with 95% confidence.</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Degrees of freedom (<code>df</code>)</p>
<p>Two individuals from different countries might have a weight difference of 5 kg. So what?! But if <em>average</em> weights between <em>whole</em> populations of countries vary by 5 kg then this becomes much more interesting.</p>
<p>Roughly: The number of independent values that can vary without questioning the significance of the model. So the more <code>df</code> you have, the safer your model. Degrees of freedom can be calculated by looking at the number of values that can vary, often this is the number of observations that you have minus one – if you had just one element it wouldn’t be able to vary against anything else.</p>
</div>
</div>
<section id="other-correlation-coefficients" class="level2" data-number="3.1"><h2 data-number="3.1" class="anchored" data-anchor-id="other-correlation-coefficients">
<span class="header-section-number">3.1</span> Other correlation-coefficients</h2>
<p>When looking for correlations in data that is <em>non-parametric</em>, i.e.&nbsp;not normally distributed you could use <em>Spearman’s rank order correlation-coefficient (rho ρ)</em> rather than <em>Pearson’s r</em>. <code>cor.test(... method = "...")</code> allows you to specify the <code>method</code> used for correlation, you can set this to Spearman’s rho by writing <code>method = "spearman"</code></p>
<p>Data will need to contain continuous or ordinal variables. The Spearman correlation coefficient is based on the <em>ranked</em> values for each variable rather than the raw data. The Spearman correlation between two variables is equal to the Pearson correlation between the rank values of those two variables.</p>
<p>We want to look at the correlation between students self-efficacy in digital competencies (<code>ICTEFFIC</code>) and wealth (<code>HOMEPOS</code>) for students in the the UK. To make the data set manageable, let us examine girls whose mother or father is a software developer</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># create a data set for the UK, including the HOMEPOS and ICTEFFIC variables</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>sub_data <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span> </span>
<span id="cb4-3"><a href="#cb4-3"></a>              <span class="fu">select</span>(CNT, HOMEPOS, ICTEFFIC, ST004D01T, OCOD1, OCOD2) <span class="sc">%&gt;%</span></span>
<span id="cb4-4"><a href="#cb4-4"></a>              <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-5"><a href="#cb4-5"></a>              <span class="fu">filter</span>(ST004D01T <span class="sc">==</span> <span class="st">"Female"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-6"><a href="#cb4-6"></a>              <span class="fu">filter</span>(OCOD1 <span class="sc">==</span> <span class="st">"Software developers"</span> <span class="sc">|</span> OCOD2 <span class="sc">==</span> <span class="st">"Software developers"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It is unclear if <code>ICTEFFIC</code>, self-efficacy in digital competencies, is <em>normalised</em>. We can graph it with <code>geom_density</code> to find out:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="fu">ggplot</span>(sub_data) <span class="sc">+</span> </span>
<span id="cb5-2"><a href="#cb5-2"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x=</span>ICTEFFIC))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="10-Correlation_and_regression_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>The data doesn’t look very normal.</p>
<p>We can run the <em>Shapiro-Wilk Test</em> to check for the the normality of the data, any alpha value greater than <code>0.05</code> means we can assume that the data is normally distributed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="fu">shapiro.test</span>(sub_data<span class="sc">$</span>ICTEFFIC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  sub_data$ICTEFFIC
W = 0.85272, p-value = 0.0001823</code></pre>
</div>
</div>
<p>In this case the data <em>isn’t</em> normally distributed as <code>p &lt; 0.05</code> and we need to use a non-parametric correlation test. We need to run <em>Spearman</em> rather than <em>Pearson</em>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="fu">cor.test</span>(sub_data<span class="sc">$</span>HOMEPOS, sub_data<span class="sc">$</span>ICTEFFIC, <span class="at">method =</span> <span class="st">"spearman"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Spearman's rank correlation rho

data:  sub_data$HOMEPOS and sub_data$ICTEFFIC
S = 9301.1, p-value = 0.5459
alternative hypothesis: true rho is not equal to 0
sample estimates:
       rho 
-0.1025489 </code></pre>
</div>
</div>
<p>The result shows no significant correlation (<code>p=0.5459</code>) between wealth and IT self-efficacy for girls who home at least one parent who is a software developer</p>
</section><section id="checking-the-assumptions-of-the-model" class="level2" data-number="3.2"><h2 data-number="3.2" class="anchored" data-anchor-id="checking-the-assumptions-of-the-model">
<span class="header-section-number">3.2</span> Checking the assumptions of the model</h2>
<p>For you to conduct the correct correlation test you need to be sure that the data meet several criteria. First, as noted above, the data should be <em>normally distributed</em> for a pearson test to be conducted. You can check the <strong>normality</strong> of the data using the <code>shapiro.test</code> function and/or by graphing the data. For large data sets such as PISA (n &gt; 5,000), the <code>shapiro.test</code> won’t work and you might want to use the graph to check; alternatively you can also use the <em>central limit theorem</em>, which means that when you have a sufficiently large sample you can presume that the data is normally distributed <span class="citation" data-cites="field2012discovering">(<a href="#ref-field2012discovering" role="doc-biblioref">Field, Miles, and Field 2012</a>)</span>. As a rule of thumb <em>“30 is the magic number”</em>, and any samples you are studying with 30 or more data items can be treated as parametric, e.g.&nbsp;you could use <em>pearson</em> when running correlation analysis on 30 or more items. This is a rough rule of thumb and you should always check the normality of your data before when checking and presenting any result any tests.</p>
<p>You also need to expect a <em>linear relationship</em> between the two variables. For example, if you were to plot the data and it looked like a curve, you might want to use a different test. You can use the <code>ggplot</code> function to plot the data and see if it looks linear. The graph below shows data that doesn’t appear to be linearly related.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="10-Correlation_and_regression_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>The data should be of paired observations. If you have missing data in one of the variables you should remove the missing data from the other variable using <code><a href="https://rdrr.io/r/stats/na.fail.html">na.omit()</a></code> e.g.:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>PISA_2015 <span class="ot">&lt;-</span> PISA_2015 <span class="sc">%&gt;%</span> <span class="fu">select</span>(PV1MATH, PV1SCIE) <span class="sc">%&gt;%</span> <span class="fu">na.omit</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>When dealing with non-parametric and small data sets you can also use <strong>Kendall’s Tau</strong> i.e.&nbsp;<code>cor.test(... method = "kendall")</code></p>
</section><section id="reporting-correlations" class="level2" data-number="3.3"><h2 data-number="3.3" class="anchored" data-anchor-id="reporting-correlations">
<span class="header-section-number">3.3</span> Reporting correlations</h2>
<p>To interpret the correlation co-efficient of a model we can use the following table:</p>
<table class="caption-top table">
<thead><tr class="header">
<th>Correlation co-efficient</th>
<th>Relationship</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>.70 or higher</td>
<td>very strong positive</td>
</tr>
<tr class="even">
<td>.40 to .69</td>
<td>strong positive</td>
</tr>
<tr class="odd">
<td>.30 to .39</td>
<td>moderate positive</td>
</tr>
<tr class="even">
<td>.20 to .29</td>
<td>weak positive</td>
</tr>
<tr class="odd">
<td>.01 to .19</td>
<td>negligible or none</td>
</tr>
<tr class="even">
<td>0</td>
<td>no relationship</td>
</tr>
<tr class="odd">
<td>-.01 to -.19</td>
<td>negligible or none</td>
</tr>
<tr class="even">
<td>-.20 to -.29</td>
<td>weak negative</td>
</tr>
<tr class="odd">
<td>-.30 to -.39</td>
<td>moderate negative</td>
</tr>
<tr class="even">
<td>-.40 to -.69</td>
<td>strong negative</td>
</tr>
<tr class="odd">
<td>-.70 or higher</td>
<td>very strong negative</td>
</tr>
</tbody>
</table>
<p>When writing a report we might present our findings like this:</p>
<blockquote class="blockquote">
<p>There was no significant relationship between the perceived quality of sleep and its impact on Mood, <em>r</em> = -.12, <em>p</em> = .17</p>
</blockquote>
<p>or</p>
<blockquote class="blockquote">
<p>There is a significant very strong correlation between overall well-being and life satisfaction, <em>r</em> = .86, <em>p</em> = .00</p>
</blockquote>
</section><section id="questions-correlation" class="level2" data-number="3.4"><h2 data-number="3.4" class="anchored" data-anchor-id="questions-correlation">
<span class="header-section-number">3.4</span> Questions: Correlation</h2>
<div class="question">
<p>Use <code>cor.test</code> to explore the following relationships:</p>
<ol type="1">
<li>
<code>PV1MATH</code> to <code>PV1SCIE</code>, is this a stronger relationship than that between Maths and Reading? Why might they be different?</li>
</ol>
<div class="cell">
<details class="code-fold"><summary>answer</summary><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="fu">cor.test</span>(PISA_2022<span class="sc">$</span>PV1MATH, PISA_2022<span class="sc">$</span>PV1SCIE, <span class="at">method =</span> <span class="st">"pearson"</span>)</span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="co">#&gt; cor 0.8888601</span></span>
<span id="cb11-3"><a href="#cb11-3"></a></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="fu">cor.test</span>(PISA_2022<span class="sc">$</span>PV1MATH, PISA_2022<span class="sc">$</span>PV1READ, <span class="at">method =</span> <span class="st">"pearson"</span>)</span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="co">#&gt; cor 0.8312513</span></span>
<span id="cb11-6"><a href="#cb11-6"></a></span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="co">#&gt; very slightly, yes!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="2" type="1">
<li>How does the correlation of wealth <code>HOMEPOS</code> of females <code>ST004D01T</code> and their Reading <code>PV1READ</code> scores compare to males? Why might they be different?</li>
</ol>
<div class="cell">
<details class="code-fold"><summary>answer</summary><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>data <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ST004D01T <span class="sc">==</span> <span class="st">"Female"</span>)</span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="fu">cor.test</span>(data<span class="sc">$</span>HOMEPOS, data<span class="sc">$</span>PV1READ, <span class="at">method =</span> <span class="st">"pearson"</span>)</span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="co">#&gt; 0.4972371 </span></span>
<span id="cb12-4"><a href="#cb12-4"></a></span>
<span id="cb12-5"><a href="#cb12-5"></a>data <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ST004D01T <span class="sc">==</span> <span class="st">"Male"</span>)</span>
<span id="cb12-6"><a href="#cb12-6"></a><span class="fu">cor.test</span>(data<span class="sc">$</span>HOMEPOS, data<span class="sc">$</span>PV1READ, <span class="at">method =</span> <span class="st">"pearson"</span>)</span>
<span id="cb12-7"><a href="#cb12-7"></a><span class="co">#&gt; cor 0.4216684 </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="3" type="1">
<li>How does life satisfaction <code>ST016Q01NA</code> correlate with the science score of students?</li>
</ol>
<div class="cell">
<details class="code-fold"><summary>answer</summary><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="fu">cor.test</span>(PISA_2022<span class="sc">$</span>ST016Q01NA, PISA_2022<span class="sc">$</span>PV1SCIE, <span class="at">method =</span> <span class="st">"pearson"</span>)</span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="co">#&gt; -0.06439345</span></span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="co">#&gt; there is negligible or no correlation between these variables</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="4" type="1">
<li>How does parental involvement in education <code>PARINVOL</code> correlate with reading outcomes for students in Germany (<strong>HINT:</strong> you might want to check the normality of this data!):</li>
</ol>
<div class="cell">
<details class="code-fold"><summary>answer</summary><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>mdl_data <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>  <span class="fu">mutate</span>(<span class="at">gender =</span> ST004D01T) <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(PARINVOL),</span>
<span id="cb14-4"><a href="#cb14-4"></a>         CNT <span class="sc">==</span> <span class="st">"Germany"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-5"><a href="#cb14-5"></a>  <span class="fu">select</span>(CNT, gender, PARINVOL, PV1READ)</span>
<span id="cb14-6"><a href="#cb14-6"></a></span>
<span id="cb14-7"><a href="#cb14-7"></a><span class="fu">shapiro.test</span>(mdl_data<span class="sc">$</span>PARINVOL)</span>
<span id="cb14-8"><a href="#cb14-8"></a><span class="co">#&gt; not normally distributed!</span></span>
<span id="cb14-9"><a href="#cb14-9"></a><span class="co">#&gt; W = 0.96017, p-value &lt; 2.2e-16</span></span>
<span id="cb14-10"><a href="#cb14-10"></a><span class="fu">ggplot</span>(mdl_data) <span class="sc">+</span> </span>
<span id="cb14-11"><a href="#cb14-11"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x=</span>PARINVOL))</span>
<span id="cb14-12"><a href="#cb14-12"></a></span>
<span id="cb14-13"><a href="#cb14-13"></a><span class="fu">shapiro.test</span>(mdl_data<span class="sc">$</span>PV1READ)</span>
<span id="cb14-14"><a href="#cb14-14"></a><span class="co">#&gt; not normally distributed!</span></span>
<span id="cb14-15"><a href="#cb14-15"></a><span class="co">#W = 0.99362, p-value = 4.224e-08</span></span>
<span id="cb14-16"><a href="#cb14-16"></a><span class="fu">ggplot</span>(mdl_data) <span class="sc">+</span> </span>
<span id="cb14-17"><a href="#cb14-17"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x=</span>PV1READ))</span>
<span id="cb14-18"><a href="#cb14-18"></a></span>
<span id="cb14-19"><a href="#cb14-19"></a><span class="co">#&gt; as the data isn't normally distributed we need to use a non-parametric test, i.e. spearman's rho</span></span>
<span id="cb14-20"><a href="#cb14-20"></a><span class="fu">cor.test</span>(mdl_data<span class="sc">$</span>PARINVOL, mdl_data<span class="sc">$</span>PV1READ, <span class="at">method =</span> <span class="st">"spearman"</span>)</span>
<span id="cb14-21"><a href="#cb14-21"></a><span class="co">#&gt; p-value &lt; 2.2e-16</span></span>
<span id="cb14-22"><a href="#cb14-22"></a><span class="co">#&gt; rho -0.2962208</span></span>
<span id="cb14-23"><a href="#cb14-23"></a></span>
<span id="cb14-24"><a href="#cb14-24"></a><span class="co"># or as a graph</span></span>
<span id="cb14-25"><a href="#cb14-25"></a><span class="fu">ggplot</span>(mdl_data, <span class="fu">aes</span>(<span class="at">x=</span>PARINVOL, <span class="at">y=</span>PV1READ)) <span class="sc">+</span> </span>
<span id="cb14-26"><a href="#cb14-26"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb14-27"><a href="#cb14-27"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="5" type="1">
<li>Using the <em>full</em> <a href="https://emckclac-my.sharepoint.com/:u:/g/personal/k1926273_kcl_ac_uk/EQwPwPa-bzBFp1ne6LlrT0MBSh_q-YSKzFb2Jp8ybcwztQ?e=cNcFNw">PISA data set</a>, for the <code>United Kingdom</code> How does the sense of belonging to school <code>BELONG</code> correlate with the item that measures bullying <code>BULLIED</code>? How does the UK compare against other countries?</li>
</ol>
<div class="cell">
<details class="code-fold"><summary>answer</summary><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>data <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span>)</span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="fu">cor.test</span>(data<span class="sc">$</span>BELONG, data<span class="sc">$</span>BULLIED, <span class="at">method =</span> <span class="st">"pearson"</span>)</span>
<span id="cb15-3"><a href="#cb15-3"></a><span class="co">#&gt; -0.3797393</span></span>
<span id="cb15-4"><a href="#cb15-4"></a><span class="co">#&gt; there is a moderate negative correlation between these variables,</span></span>
<span id="cb15-5"><a href="#cb15-5"></a><span class="co">#&gt; students who are bullied less have a greater sense of belonging                                                </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you want to find all the <code>numeric</code> fields, i.e.&nbsp;the fields that you can easily run correlation calculations on, use the following code to list them:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>PISA_2022 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">where</span>(is.numeric)) <span class="sc">%&gt;%</span> <span class="fu">names</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "CNTSCHID"   "CNTSTUID"   "ST016Q01NA" "WB151Q01HA" "WB152Q01HA"
 [6] "WB156Q01HA" "BELONG"     "BULLIED"    "DISCLIM"    "HOMEPOS"   
[11] "ESCS"       "ATTCONFM"   "ICTEFFIC"   "STUBMI"     "PQMIMP"    
[16] "PARINVOL"   "PV1MATH"    "PV1READ"    "PV1SCIE"   </code></pre>
</div>
</div>
</div>
</div>
</section></section><section id="regression" class="level1" data-number="4"><h1 data-number="4">
<span class="header-section-number">4</span> Regression</h1>
<p>Correlation allows us to see the strength of the relationship but it doesn’t allow us to <em>predict</em> what would happen if a variable changed. “When the wind blows, the trees move. When the trees move, the wind blows.” Which is it? Correlation suggests there is a link but tells us nothing about causation. To do this we need <em>regression</em>.</p>
<table class="caption-top table">
<caption>differences and similarities between correlation and regression</caption>
<colgroup>
<col style="width: 50%">
<col style="width: 49%">
</colgroup>
<thead><tr class="header">
<th>Correlation</th>
<th>Regression</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>an example of inferential statistics</td>
<td>an example of inferential statistics</td>
</tr>
<tr class="even">
<td>give direction and strength of the relationship between two (or more) numeric variables</td>
<td>give direction and strength of the relationship between two (or more) variables</td>
</tr>
<tr class="odd">
<td>Relationship between variables</td>
<td>The extent to which one variable <u>predicts</u> another</td>
</tr>
<tr class="even">
<td>Effect only (no cause)</td>
<td>Cause and effect</td>
</tr>
<tr class="odd">
<td>p(x,y) == p(y,x)</td>
<td>One way (e.g.&nbsp;education affects income differently from how income affects education)</td>
</tr>
<tr class="even">
<td>Single point/value</td>
<td>An equation that creates a best fitting line</td>
</tr>
</tbody>
</table>
<p>Regression is a way of <em>predicting</em> the value of one <em>dependent</em> variable from one or more <em>independent</em> variables by creating a hypothetical model of the relationship between them.</p>
<ul>
<li>
<strong>independent variable(s)</strong> - the cause of the change that is independent of other variables</li>
<li>
<strong>dependent variable</strong> - the effect of the cause</li>
</ul>
<p>For example we could have a model that predicts the value of a house - the <em>dependent</em> variable - based on the number of bedrooms, the size of the garden, and the distance from the city centre - the <em>independent</em> variables.</p>
<p>For regression to work we need to have a large enough sample size, the means to explain any relationships, and relationships that are not spurious, i.e.&nbsp;that it is not due to third variables. For example….</p>
<section id="linear-models-and-regression" class="level2" data-number="4.1"><h2 data-number="4.1" class="anchored" data-anchor-id="linear-models-and-regression">
<span class="header-section-number">4.1</span> Linear models and regression</h2>
<p>The model used is a <strong>linear</strong> one, therefore, we describe the relationship using the equation of a straight line. In linear regression, with one dependent and one independent variable, we use the <em>Method of Least Squares</em> to find the line of best fit. The means finding a straight line that passes as close as possible to all the points. The distance between a point and this line is called a <em>residual</em>. The line of best fit is the line where the sum of the residuals squared is the smallest number possible.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="images/method_of_least_squares.png" class="img-fluid figure-img"></p>
<figcaption>Method of Least Squares</figcaption></figure>
</div>
<p>The line that is created can be described by the equation:</p>
<p><code>Output = Intercept + Coefficient * Input</code> <!--F-statistic = a measure of the ratio of the variation explained by the model and the variation attributable to unsystematic factors (the error of the model).--></p>
<p>Let’s use linear regression to explore the relationship between the score in maths(<code>PV1MATH</code>) and the score in reading (<code>PV1READ</code>). To build this model we use the <code>lm</code> command:</p>
<p><code>lm(&lt;dependent_var&gt; ~ &lt;independent_var&gt; , data=&lt;dataframe&gt;)</code></p>
<p>The first part defines the model we are going to explore, listing the dependent variable and separating it from the independent variable[s] with a tilde <code>~</code>. You can specify multiple independent variables by adding more plusses, but for the example here we are only going to use one. Once the model has been built we can feed it into the <code>summary(&lt;mdl&gt;)</code> command to output the results:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>mdl_math_read <span class="ot">&lt;-</span> <span class="fu">lm</span>(PV1MATH <span class="sc">~</span> PV1READ, <span class="at">data=</span>PISA_2022)</span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="fu">summary</span>(mdl_math_read)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = PV1MATH ~ PV1READ, data = PISA_2022)

Residuals:
    Min      1Q  Median      3Q     Max 
-273.61  -38.33   -2.48   36.01  323.51 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 1.021e+02  2.981e-01   342.5   &lt;2e-16 ***
PV1READ     7.731e-01  6.599e-04  1171.5   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 56.61 on 613742 degrees of freedom
Multiple R-squared:  0.691, Adjusted R-squared:  0.691 
F-statistic: 1.372e+06 on 1 and 613742 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>If you look at the <code>Coefficents:</code> table we can see that <code>PV1READ</code> is significant in explaining the outcome of the model as the p-value <code>Pr(&gt;|t|)</code> is less than 0.001 <code>&lt;2e-16 ***</code>. The null hypothesis is that one variable does not predict another, we can dismiss this. By looking at the <code>Estimate</code> we can also see by how much a <code>PV1MATH</code> grade would increase if the <code>PV1READ</code> increased by one: <code>0.7731</code>. Additionally, we have <em>R<sup>2</sup></em> value of <code>0.691</code>, this suggests that the model is very good at explaining the value of the dependent variable, 69.1% of the variance in the <code>PV1MATH</code> grade is explained by the <code>PV1READ</code> grade.</p>
</section><section id="r-squared" class="level2" data-number="4.2"><h2 data-number="4.2" class="anchored" data-anchor-id="r-squared">
<span class="header-section-number">4.2</span> R squared</h2>
<p>With large data sets you will often find a statistically significant difference, but <em>p-values</em> should be read with caution as the larger the data set you use the more likely you are to get a low <em>p-value</em>. The actual magnitude of a significant difference might be very small. <strong>r-squared</strong> and <strong>adjusted r-squared</strong> are ways for you to report on the magnitude of a significant difference and when you report the findings from a linear model you should be looking at the <code>p</code> and the <code>R^2^</code> values. You have already met <em>R</em>, this is the correlation coefficient from earlier, <em>R<sup>2</sup></em> is this value squared:</p>
<ul>
<li>
<strong>R</strong> - The correlation between the observed values of the outcome, and the values predicted by the model.</li>
<li>
<strong>R<sup>2</sup></strong> - The proportion of variance in the dependent variable accounted for by the model.</li>
<li>
<strong>Adj. R<sup>2</sup></strong> - An estimate of R<sup>2</sup> in the population (shrinkage), often very similar to plain R<sup>2</sup>.</li>
</ul>
<!--Effect size measurements include Cohen's d, Glass' g and Pearson's r--><p>Imagine we take two experiments a) and b)</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="images/effectsize.png" class="img-fluid figure-img"></p>
<figcaption>(a) larger effect-size; (b) smaller effect-size from <span class="citation" data-cites="coe2002s">Coe (<a href="#ref-coe2002s" role="doc-biblioref">2002</a>)</span></figcaption></figure>
</div>
<p>Both have statistically significant results, but it’s clear that the impact of the intervention in graph a) is larger as there is less overlap between the curves, i.e.&nbsp;there is more difference between the the outcomes.</p>
<blockquote class="blockquote">
<p>if the difference were as in graph (a) it would be very significant; in graph (b), on the other hand, the difference might hardly be noticeable <span class="citation" data-cites="coe2002s">(<a href="#ref-coe2002s" role="doc-biblioref">Coe 2002, p2</a>)</span></p>
</blockquote>
<p>Different effect sizes have different meanings and there is some debate on how to interpret them, with different interpretations for different fields of research <span class="citation" data-cites="schafer2019meaningfulness">(<a href="#ref-schafer2019meaningfulness" role="doc-biblioref">Schäfer and Schwarz 2019</a>)</span></p>
<table class="caption-top table">
<caption>How to interpret effect sizes <span class="citation" data-cites="cohen1962statistical">(<a href="#ref-cohen1962statistical" role="doc-biblioref">Cohen 1962</a>)</span>
</caption>
<thead><tr class="header">
<th>Effect size value</th>
<th>Effect size</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>0.0 to 0.19</td>
<td>negligible</td>
</tr>
<tr class="even">
<td>0.2 to 0.49</td>
<td>small</td>
</tr>
<tr class="odd">
<td>0.5 to 0.79</td>
<td>medium</td>
</tr>
<tr class="even">
<td>0.8+</td>
<td>large</td>
</tr>
</tbody>
</table>
<p>However, acceptable effect sizes in social sciences - including education - are often very low. You might be familiar with the Education Endowment Foundation’s <em>Teaching and Learning Toolkit</em> which outlines the <em>Impact</em> of different interventions on student learning. For example, repeating a year is seen to decrease student progress by 3 months and providing students with feedback is seen to increase student progress by 6 months. Behind the scenes they are using effect-sizes to predict the impact of educational interventions. In their model an effect-size of 0.1 is considered to have “Low impact”, but also an effect size of this magnitude is translated to 2 months progress in the Toolkit <span class="citation" data-cites="higgins2016sutton">(<a href="#ref-higgins2016sutton" role="doc-biblioref">Higgins et al. 2016, 5</a>)</span>.</p>
</section><section id="questions-regression" class="level2" data-number="4.3"><h2 data-number="4.3" class="anchored" data-anchor-id="questions-regression">
<span class="header-section-number">4.3</span> Questions: Regression</h2>
<div class="question">
<ol type="1">
<li>Run a regression model to look at how wealth <code>HOMEPOS</code> influences Maths grades in Kazakhstan What is the impact of increasing the wealth of students by one unit? How does this model compare against the same model for science and reading scores?</li>
</ol>
<div class="cell">
<details class="code-fold"><summary>answer</summary><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>mdl <span class="ot">&lt;-</span> <span class="fu">lm</span>(PV1MATH <span class="sc">~</span> HOMEPOS, </span>
<span id="cb20-2"><a href="#cb20-2"></a>          <span class="at">data=</span>PISA_2022 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(CNT<span class="sc">==</span><span class="st">"Kazakhstan"</span>))</span>
<span id="cb20-3"><a href="#cb20-3"></a><span class="fu">summary</span>(mdl)</span>
<span id="cb20-4"><a href="#cb20-4"></a><span class="co">#&gt; HOMEPOS    33.432 </span></span>
<span id="cb20-5"><a href="#cb20-5"></a><span class="co">#&gt; R-squared:  0.1018</span></span>
<span id="cb20-6"><a href="#cb20-6"></a></span>
<span id="cb20-7"><a href="#cb20-7"></a>mdl <span class="ot">&lt;-</span> <span class="fu">lm</span>(PV1READ <span class="sc">~</span> HOMEPOS, </span>
<span id="cb20-8"><a href="#cb20-8"></a>          <span class="at">data=</span>PISA_2022 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(CNT<span class="sc">==</span><span class="st">"Kazakhstan"</span>))</span>
<span id="cb20-9"><a href="#cb20-9"></a><span class="fu">summary</span>(mdl)</span>
<span id="cb20-10"><a href="#cb20-10"></a><span class="co">#&gt; HOMEPOS    37.1606 </span></span>
<span id="cb20-11"><a href="#cb20-11"></a><span class="co">#&gt; R-squared:  0.1258</span></span>
<span id="cb20-12"><a href="#cb20-12"></a></span>
<span id="cb20-13"><a href="#cb20-13"></a>mdl <span class="ot">&lt;-</span> <span class="fu">lm</span>(PV1SCIE <span class="sc">~</span> HOMEPOS, </span>
<span id="cb20-14"><a href="#cb20-14"></a>          <span class="at">data=</span>PISA_2022 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(CNT<span class="sc">==</span><span class="st">"Kazakhstan"</span>))</span>
<span id="cb20-15"><a href="#cb20-15"></a><span class="fu">summary</span>(mdl)</span>
<span id="cb20-16"><a href="#cb20-16"></a><span class="co">#&gt; HOMEPOS    33.5009</span></span>
<span id="cb20-17"><a href="#cb20-17"></a><span class="co">#&gt; R-squared:  0.1089</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="2" type="1">
<li>Run a regression model to look at how science grades predict Maths outcomes in UK students. How does this compare to students in France?</li>
</ol>
<div class="cell">
<details class="code-fold"><summary>answer</summary><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>mdl <span class="ot">&lt;-</span> <span class="fu">lm</span>(PV1MATH <span class="sc">~</span> PV1SCIE, </span>
<span id="cb21-2"><a href="#cb21-2"></a>          <span class="at">data=</span>PISA_2022 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(CNT<span class="sc">==</span><span class="st">"United Kingdom"</span>))</span>
<span id="cb21-3"><a href="#cb21-3"></a><span class="fu">summary</span>(mdl)</span>
<span id="cb21-4"><a href="#cb21-4"></a><span class="co">#&gt; Estimate = 0.80789</span></span>
<span id="cb21-5"><a href="#cb21-5"></a><span class="co">#&gt; p&lt;0.001</span></span>
<span id="cb21-6"><a href="#cb21-6"></a><span class="co">#&gt; R2 = 0.7533</span></span>
<span id="cb21-7"><a href="#cb21-7"></a></span>
<span id="cb21-8"><a href="#cb21-8"></a>mdl <span class="ot">&lt;-</span> <span class="fu">lm</span>(PV1MATH <span class="sc">~</span> PV1SCIE, </span>
<span id="cb21-9"><a href="#cb21-9"></a>          <span class="at">data=</span>PISA_2022 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(CNT<span class="sc">==</span><span class="st">"France"</span>))</span>
<span id="cb21-10"><a href="#cb21-10"></a><span class="fu">summary</span>(mdl)</span>
<span id="cb21-11"><a href="#cb21-11"></a><span class="co">#&gt; Estimate = 0.793547</span></span>
<span id="cb21-12"><a href="#cb21-12"></a><span class="co">#&gt; p&lt;0.001</span></span>
<span id="cb21-13"><a href="#cb21-13"></a><span class="co">#&gt; R2 = 0.8012</span></span>
<span id="cb21-14"><a href="#cb21-14"></a></span>
<span id="cb21-15"><a href="#cb21-15"></a><span class="co">#&gt; both models are significant, but the model in France has a higher R squared </span></span>
<span id="cb21-16"><a href="#cb21-16"></a><span class="co">#&gt; value, i.e. Science is a better at explaining the variance in maths outcomes </span></span>
<span id="cb21-17"><a href="#cb21-17"></a><span class="co">#&gt; in France than it is in the UK.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="3" type="1">
<li>Create a linear model to look at parental involvement <code>PARINVOL</code> influences Maths grades for female students in Germany and Hong Kong (China). If we use the Education Endowment Foundation’s interpretation of effect sizes <span class="citation" data-cites="higgins2016sutton">(<a href="#ref-higgins2016sutton" role="doc-biblioref">Higgins et al. 2016, 4</a>)</span> what is the impact of increasing parental involvement on student grades in each country?</li>
</ol>
<div class="cell">
<details class="code-fold"><summary>answer</summary><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>mdl <span class="ot">&lt;-</span> <span class="fu">lm</span>(PV1MATH <span class="sc">~</span> PARINVOL, </span>
<span id="cb22-2"><a href="#cb22-2"></a>          <span class="at">data=</span>PISA_2022 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ST004D01T<span class="sc">==</span><span class="st">"Female"</span>,</span>
<span id="cb22-3"><a href="#cb22-3"></a>                                    CNT<span class="sc">==</span><span class="st">"Germany"</span>))</span>
<span id="cb22-4"><a href="#cb22-4"></a><span class="fu">summary</span>(mdl)</span>
<span id="cb22-5"><a href="#cb22-5"></a><span class="co">#&gt; Estimate = -41.864</span></span>
<span id="cb22-6"><a href="#cb22-6"></a><span class="co">#&gt; p&lt;0.001</span></span>
<span id="cb22-7"><a href="#cb22-7"></a><span class="co">#&gt; R2 = 0.1289</span></span>
<span id="cb22-8"><a href="#cb22-8"></a><span class="co">#&gt; this is just above 0.1, meaning the model has a "Low impact" effect size </span></span>
<span id="cb22-9"><a href="#cb22-9"></a><span class="co">#&gt; if we use the Education Endowment Foundation's interpretation of effect sizes</span></span>
<span id="cb22-10"><a href="#cb22-10"></a><span class="co">#&gt; However, increased parental involvement decreases Maths scores!?</span></span>
<span id="cb22-11"><a href="#cb22-11"></a></span>
<span id="cb22-12"><a href="#cb22-12"></a>mdl <span class="ot">&lt;-</span> <span class="fu">lm</span>(PV1MATH <span class="sc">~</span> PARINVOL, </span>
<span id="cb22-13"><a href="#cb22-13"></a>          <span class="at">data=</span>PISA_2022 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ST004D01T<span class="sc">==</span><span class="st">"Female"</span>,</span>
<span id="cb22-14"><a href="#cb22-14"></a>                                    CNT<span class="sc">==</span><span class="st">"Hong Kong (China)"</span>))</span>
<span id="cb22-15"><a href="#cb22-15"></a><span class="fu">summary</span>(mdl)</span>
<span id="cb22-16"><a href="#cb22-16"></a></span>
<span id="cb22-17"><a href="#cb22-17"></a><span class="co">#&gt; Estimate = -4.614</span></span>
<span id="cb22-18"><a href="#cb22-18"></a><span class="co">#&gt; p&lt;0.001</span></span>
<span id="cb22-19"><a href="#cb22-19"></a><span class="co">#&gt; R2 = 0.001756</span></span>
<span id="cb22-20"><a href="#cb22-20"></a><span class="co">#&gt; Parental involvement has a negligible effect on Maths scores in Hong Kong</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="4" type="1">
<li>Is it reasonable to presume that using 5 interventions from the education endowment foundation toolkit, each with effect-sizes of 0.1, i.e.&nbsp;2 months improvement, will increase the progress for the average student in your class by 10 months (5 * 2)?</li>
</ol>
<div class="cell">
<details class="code-fold"><summary>answer</summary><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="co">#&gt; Probably not! The effect of the interventions might not be additive, and the </span></span>
<span id="cb23-2"><a href="#cb23-2"></a><span class="co">#&gt; effect of the interventions might not be the same for all students.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</section></section><section id="multivariable-linear-regression" class="level1" data-number="5"><h1 data-number="5">
<span class="header-section-number">5</span> Multivariable linear regression</h1>
<p>So far we have looked at the impact of a single independent variable on a single dependent variable. We are now going to look at building models that contain multiple independent variables, of both continuous and discrete values. For example, we might want to see how Gender (<code>ST004D01T</code>) and Reading score (<code>PV1READ</code>) help predict a maths score. To add extra independent variables, use the plus symbol <code>+</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>mdl <span class="ot">&lt;-</span> <span class="fu">lm</span>(PV1MATH <span class="sc">~</span> PV1READ <span class="sc">+</span> gender, </span>
<span id="cb24-2"><a href="#cb24-2"></a>          <span class="at">data =</span> PISA_2022 <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">gender =</span> ST004D01T))</span>
<span id="cb24-3"><a href="#cb24-3"></a><span class="fu">summary</span>(mdl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = PV1MATH ~ PV1READ + gender, data = PISA_2022 %&gt;% 
    rename(gender = ST004D01T))

Residuals:
     Min       1Q   Median       3Q      Max 
-289.474  -37.253   -2.099   35.295  309.126 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 8.363e+01  3.086e-01   271.0   &lt;2e-16 ***
PV1READ     7.863e-01  6.478e-04  1213.8   &lt;2e-16 ***
genderMale  2.528e+01  1.419e-01   178.2   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 55.2 on 613662 degrees of freedom
  (79 observations deleted due to missingness)
Multiple R-squared:  0.7062,    Adjusted R-squared:  0.7062 
F-statistic: 7.375e+05 on 2 and 613662 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Both independent variables are significant (<code>p&lt;0.001</code>), and the <em>R<sup>2</sup></em> of the model is high at <code>0.7062</code>, this model explains 71% of the variance in Maths grade. Looking at the Estimates, we see both independent variables presented, this means we can read them as if the other factor has been <em>controlled</em> for; e.g.&nbsp;what is the impact of reading score if the impact of gender has been taken into consideration. <code>PV1READ</code> is <code>0.786</code>, meaning for an increase of 1 in this score, the <code>PV1MATH</code> grade would increase by <code>0.786</code>. Gender is different, this is a <em>nominal</em> field, being either Male or Female, and <code>genderMale</code> is shown in the coefficients table. This means that the model has taken <code>gender == Female</code> as the base state, and modeled what happens if the gender were to change to Male. Interestingly, it suggests that when controlling for the reading grade, e.g.&nbsp;comparing females and males of the same reading score, males would do <code>25.28</code> points better in their <code>PV1MATH</code> grade than females(!). We’ll be exploring these gender differences a little further in section <a href="#sec-Stoet-Geary" class="quarto-xref">Section&nbsp;8.2</a>.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Picking variables for your regression model can be difficult. You might have a large number of potential predictors and you might not know which ones to include. Some predictors might also be correlated with each other, and this can cause problems in your model. For example, if you were to include the number of cars in a student’s household and the income of the family, these two variables might be highly correlated, as it seems likely richer families will have more cars. This is known as <em>multicollinearity</em> and can cause problems in your model, such as lower p values and larger standard errors.</p>
<p>There are a few methods to help you decide which variables to include in your model:</p>
<p>A rule of thumb is you need try to use predictors that you think make sense in explaining your model, variables that have some theoretical rationale behind their inclusion. You don’t want to have a wonderful model that when you come to write-up, you can’t explain; plus variables that make sense stand a good chance of being good predictors. For example, if you are trying to predict a student’s Mathematics score, you might want to include the student’s reading grade, along with their gender and their socio-economic status. You can find literature on all of these variables and could happily explain why you think they might be good predictors.</p>
<p>Next you can use <em>stepwise</em> selection to help you decide which variables to include in your model, by either starting with no variables and keep adding them to get the highest explanatory power of the model, or start with all the variables and remove them one by one until you get a model with the highest explanatory power (roughly the highest adj.R<sup>2</sup>). The <a href="http://www.stats.ox.ac.uk/pub/MASS4/">MASS</a> package comes with code to run the <code>AIC</code> (Akaike Information Criterion) stepwise process to help you do this. AIC is a measure of how well your model fits the data, but it also includes a penalty for the number of variables you use. This means that AIC will help you find the best model that uses the fewest variables. To use the AIC process, create a data frame with all the variables that you want to use and use <code>na.omit</code> to make sure that you have complete rows of data (warning, the more variables you use the slower this process will be):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>PISA_2022 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">where</span>(is.numeric)) <span class="sc">%&gt;%</span> <span class="fu">names</span>()</span>
<span id="cb26-2"><a href="#cb26-2"></a>mdl_data <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span> </span>
<span id="cb26-3"><a href="#cb26-3"></a>  <span class="fu">select</span>(PV1MATH, PV1READ, PV1SCIE, ST004D01T,</span>
<span id="cb26-4"><a href="#cb26-4"></a>         ESCS, HOMEPOS, OECD, ST253Q01JA,</span>
<span id="cb26-5"><a href="#cb26-5"></a>         ICTEFFIC, STUBMI, PQMIMP, PARINVOL) <span class="sc">%&gt;%</span> </span>
<span id="cb26-6"><a href="#cb26-6"></a>  <span class="fu">na.omit</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then use the <code>AIC</code> (Akaike Information Criterion) function to find the best model, to do this. Create a linear model using <code>lm</code>, with the model description <code>PV1MATH ~ .</code>, where <code>.</code> stands for <em>everything</em>, i.e.&nbsp;every other column in the <code>mdl_data</code> data frame. We then pass the <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> result to <code>stepAIC</code> to find the best model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb27-2"><a href="#cb27-2"></a>mdl <span class="ot">&lt;-</span> <span class="fu">lm</span>(PV1MATH <span class="sc">~</span> ., <span class="at">data =</span> mdl_data)</span>
<span id="cb27-3"><a href="#cb27-3"></a><span class="fu">stepAIC</span>(mdl, <span class="at">trace =</span> <span class="cn">TRUE</span>, <span class="at">direction=</span> <span class="st">"both"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<blockquote class="blockquote">
<p>Call: lm(formula = PV1MATH ~ PV1READ + PV1SCIE + ST004D01T + ESCS + HOMEPOS + OECD + ST253Q01JA + ICTEFFIC + STUBMI, data = mdl_data) In this case <em>Parent Attitudes Toward Mathematics (WLE)</em> <code>PQMIMP</code> and <em>Parental Involvement (WLE)</em> <code>PARINVOL</code> were not seen to be contributing enough to the model to be included(?!).</p>
</blockquote>
</div>
</div>
<section id="checking-the-assumptions-of-the-model-1" class="level2" data-number="5.1"><h2 data-number="5.1" class="anchored" data-anchor-id="checking-the-assumptions-of-the-model-1">
<span class="header-section-number">5.1</span> Checking the assumptions of the model</h2>
<p>Like the other statistical models you have met so far, linear regression has a number of assumptions that need to be met for the model to be valid. These are:</p>
<ul>
<li>
<strong>Independence</strong>: The residuals should be independent of each other, i.e.&nbsp;the residuals from one observation should not predict the residuals from another observation, there shouldn’t be patterns in the residuals. We can test the independence of the residuals using the <em>Durbin Watson</em> test from the <a href="https://r-forge.r-project.org/projects/car/">car</a> package. Where p-values of &lt; 0.05 indicate that the residuals are <em>not</em> independent.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="fu">library</span>(car)</span>
<span id="cb28-2"><a href="#cb28-2"></a>mdl <span class="ot">&lt;-</span> <span class="fu">lm</span>(PV1READ <span class="sc">~</span> PV1MATH <span class="sc">+</span> ST004D01T <span class="sc">+</span> ESCS, </span>
<span id="cb28-3"><a href="#cb28-3"></a>          <span class="at">data =</span> PISA_2022 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span>))</span>
<span id="cb28-4"><a href="#cb28-4"></a><span class="fu">durbinWatsonTest</span>(mdl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> lag Autocorrelation D-W Statistic p-value
   1     0.002082558      1.995719   0.786
 Alternative hypothesis: rho != 0</code></pre>
</div>
</div>
<p>In this test, we can see that the p-value is &gt; 0.05 meaning we can assume that the residuals <em>are</em> independent.</p>
<ul>
<li>
<strong>No multicollinearity</strong>: The independent variables should not be correlated with each other, e.g.&nbsp;having <code>PV1MATH</code> and <code>PV1SCIE</code> in a model, which are highly correlated, might make it difficult to work out which of the scores is having the impact. You might be able to alleviate this issue by creating a composite variable: <code>composite_score = (PV1MATH + PV1SCIE) / 2</code> and using this in your model instead. <span class="citation" data-cites="field2012discovering">Field, Miles, and Field (<a href="#ref-field2012discovering" role="doc-biblioref">2012</a>)</span> suggest that if the correlation between two variables is “above 0.80 or 0.90” (p.276), then you might have a problem with multicollinearity, the actual correlation between these two fields is 0.89. More advanced checks can use the <code>vif()</code> function from the <a href="https://r-forge.r-project.org/projects/car/">car</a> package to check for multicollinearity. This function will calculate the <em>Variance Inflation Factor</em> (VIF) for each variable in the model. A VIF of 1 means that the variable is not correlated with any other variables, and a VIF of 5 or more means that the variable is highly correlated with other variables.(ibid. p293)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="fu">library</span>(car)</span>
<span id="cb30-2"><a href="#cb30-2"></a>mdl <span class="ot">&lt;-</span> <span class="fu">lm</span>(PV1READ <span class="sc">~</span> PV1MATH <span class="sc">+</span> PV1SCIE <span class="sc">+</span> ST004D01T, </span>
<span id="cb30-3"><a href="#cb30-3"></a>          <span class="at">data =</span> PISA_2022 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span>))</span>
<span id="cb30-4"><a href="#cb30-4"></a><span class="co"># They are close to 5, consider removing one of the PV1 variables or combining them</span></span>
<span id="cb30-5"><a href="#cb30-5"></a><span class="fu">vif</span>(mdl) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  PV1MATH   PV1SCIE ST004D01T 
 4.082640  4.066330  1.008424 </code></pre>
</div>
</div>
<ul>
<li>
<strong>Normality</strong>: The residuals should be normally distributed. To check this we can use <em>Q-Q plots</em>. The <em>Shapiro-Wilk</em> test is also used for smaller data sets where there are n &lt; 5000 observations.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a>mdl <span class="ot">&lt;-</span> <span class="fu">lm</span>(PV1READ <span class="sc">~</span> PV1MATH <span class="sc">+</span> PV1SCIE <span class="sc">+</span> ST004D01T, </span>
<span id="cb32-2"><a href="#cb32-2"></a>          <span class="at">data =</span> PISA_2022 <span class="sc">%&gt;%</span> </span>
<span id="cb32-3"><a href="#cb32-3"></a>            <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span>))</span>
<span id="cb32-4"><a href="#cb32-4"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb32-5"><a href="#cb32-5"></a><span class="fu">plot</span>(mdl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="10-Correlation_and_regression_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>There is some deviation from the red line in the Q-Q Residuals plot, but the residuals are close to the line within the x-axis <code>[-2,2]</code> range and we can assume the data is normally distributed with some confidence.</p>
<ul>
<li>
<strong>Homoscedasticity</strong>: The residuals (the difference between the observed and predicted values) should be equal across all values of the independent variables. This means that the variance of the residuals should be constant. You can use <code>ols_plot_resid_fit</code> from the <a href="https://olsrr.rsquaredacademy.com/">olsrr</a> package to check for the normality and homoscedasticity of the model. The data points should be spread randomly, with no funneling from one end to another:</li>
</ul>
<!-- from: https://bookdown.org/jimr1603/Intermediate_R_-_R_for_Survey_Analysis/testing-regression-assumptions.html 

https://stats.stackexchange.com/questions/642992/trust-the-graphs-or-go-with-breusch-pagan-and-whites-tests-for-homoscedasticity?noredirect=1#comment1201800_642992

# studentized residuals
#ols_plot_resid_stud(mdl)
#ols_plot_resid_stand(mdl)
stud_resids <- studres(mdl)
ggplot(data=data.frame(x=PISA_2022 %>% 
                         filter(!is.na(ST004D01T)) %>% 
                         pull(PV1READ),
                       y=studres(mdl)),
       aes(x=x, y=y)) +
  geom_point() +
  geom_smooth(method = "lm") +
  ylab('Studentized Residuals') +
  xlab('Displacement')
  

plot(PISA_2022 %>% filter(!is.na(ST004D01T)) %>% pull(PV1READ),
     stud_resids,  ylab='Studentized Residuals', xlab='Displacement') 
abline(0, 0)
sum(abs(stud_resids)>2)/
length(stud_resids)

--><div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="fu">library</span>(olsrr)</span>
<span id="cb33-2"><a href="#cb33-2"></a>mdl <span class="ot">&lt;-</span> <span class="fu">lm</span>(PV1READ <span class="sc">~</span> PV1MATH <span class="sc">+</span> PV1SCIE <span class="sc">+</span> ST004D01T, </span>
<span id="cb33-3"><a href="#cb33-3"></a>          <span class="at">data =</span> PISA_2022 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span>))</span>
<span id="cb33-4"><a href="#cb33-4"></a></span>
<span id="cb33-5"><a href="#cb33-5"></a><span class="fu">ols_plot_resid_fit</span>(mdl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="10-Correlation_and_regression_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>These plots looks good for a random distribution of residuals, but we can add to our analysis by using the <em>Breusch-Pagan</em> test - <code>ols_test_breusch_pagan()</code> in the <a href="https://olsrr.rsquaredacademy.com/">olsrr</a> package:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a><span class="fu">library</span>(olsrr)</span>
<span id="cb34-2"><a href="#cb34-2"></a>mdl <span class="ot">&lt;-</span> <span class="fu">lm</span>(PV1READ <span class="sc">~</span> PV1MATH <span class="sc">+</span> PV1SCIE <span class="sc">+</span> ST004D01T, </span>
<span id="cb34-3"><a href="#cb34-3"></a>          <span class="at">data =</span> PISA_2022 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span>))</span>
<span id="cb34-4"><a href="#cb34-4"></a></span>
<span id="cb34-5"><a href="#cb34-5"></a><span class="fu">ols_test_breusch_pagan</span>(mdl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 Breusch Pagan Test for Heteroskedasticity
 -----------------------------------------
 Ho: the variance is constant            
 Ha: the variance is not constant        

               Data                 
 -----------------------------------
 Response : PV1READ 
 Variables: fitted values of PV1READ 

         Test Summary           
 -------------------------------
 DF            =    1 
 Chi2          =    47.53604 
 Prob &gt; Chi2   =    5.400197e-12 </code></pre>
</div>
</div>
<p>The result here of p&lt;0.05 suggests that there is a degree of <em>heteroscedasticity</em> in the model, for example, we might find that students with high reading scores do relatively badly at maths, when compared to those with lower reading scores, this looks marginally true:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="10-Correlation_and_regression_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>However, the <em>Breusch-Pagan</em> test does appear to be at odds with the graphs above and it is the case that with large data sets (PISA is <em>huge</em>) many of these model significance tests can overstate the issue, i.e.&nbsp;they report significance when the actual actual effect on the model is very small. A good way of thinking about this is the story of <em>The Princess and the Pea</em>, however many mattresses were placed underneath the princess, she could still feel the pea at the bottom of the pile of mattresses. For everyone else the pea wasn’t important at all, when they saw how many mattresses there were <span class="citation" data-cites="dave2023cv">(<a href="#ref-dave2023cv" role="doc-biblioref">(https://stats.stackexchange.com/users/247274/dave), n.d.</a>)</span>. The mattresses are our data samples, and the princess is our <em>Breusch-Pagan</em> test complaining about something that actually isn’t that important given the large data set we are using. The graphs look fine and we can assume that homoscedasticity is not a problem in our model. Good graphs can often overrule the output of model tests if the data set is large enough <span class="citation" data-cites="schmidt2018linear">(<a href="#ref-schmidt2018linear" role="doc-biblioref">Schmidt and Finan 2018</a>)</span>.</p>
<p>Not meeting all of the assumptions needed for linear models doesn’t mean we can’t report the linear model results, but we should make note of the assumptions that we have checked and the results of these checks to help readers better understand the limitations of the analysis and the robustness of the results. Additionally, we might want to:</p>
<ul>
<li>
<em>log-transform</em> the outcome variable if you think the relationship might be logarithmic, or apply <em>square root</em> or <em>cube root</em> transforms</li>
<li>combine the two PV score predictors into one to avoid the potential multi-collinearity,</li>
<li>focus on particular countries rather than the whole data set, or</li>
<li>split our data so we only look at high, medium or low performing students only. <!--- use weighted regression-->
</li>
</ul>
<p>Other types of regression, such as <em>multilevel</em> models might be able to help you get past these issues as it will allow you to run multiple models on different subsets of the data.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>To find out more about the assumptions when using linear models, please see <span class="citation" data-cites="field2012discovering">Field, Miles, and Field (<a href="#ref-field2012discovering" role="doc-biblioref">2012</a>)</span> and a great <a href="https://sscc.wisc.edu/sscc/pubs/RegDiag-R/index.html">book</a> by the University of Wisconsin</p>
<p>You might also want to utilise the <a href="https://easystats.github.io/easystats/">easystats</a> package which will help you check the assumptions of your model using the <code>check_model()</code> command</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a><span class="fu">library</span>(easystats)</span>
<span id="cb36-2"><a href="#cb36-2"></a></span>
<span id="cb36-3"><a href="#cb36-3"></a>mdl <span class="ot">&lt;-</span> <span class="fu">lm</span>(PV1READ <span class="sc">~</span> PV1SCIE <span class="sc">+</span> ST004D01T, </span>
<span id="cb36-4"><a href="#cb36-4"></a>          <span class="at">data =</span> PISA_2022 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span>))</span>
<span id="cb36-5"><a href="#cb36-5"></a></span>
<span id="cb36-6"><a href="#cb36-6"></a><span class="fu">check_model</span>(mdl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="10-Correlation_and_regression_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<!--
R has a package to help you check the validity of your models: _{{gvlma}}_ Global Validation of Linear Models Assumptions. This package will check the assumptions of the model, such as the normality of the residuals, the linearity of the model, and the homoscedasticity of the residuals. To use this package, you need to install it first, then run the `gvlma()` function on your model:




::: {.cell}
::: {.cell-output .cell-output-stdout}

```

Call:
lm(formula = PV1READ ~ PV1SCIE, data = PISA_2022)

Coefficients:
(Intercept)      PV1SCIE  
    45.8447       0.8711  


ASSESSMENT OF THE LINEAR MODEL ASSUMPTIONS
USING THE GLOBAL TEST ON 4 DEGREES-OF-FREEDOM:
Level of Significance =  0.05 

Call:
 gvlma(x = mdl) 

                       Value p-value                   Decision
Global Stat        3352.0529  0.0000 Assumptions NOT satisfied!
Skewness              0.1649  0.6847    Assumptions acceptable.
Kurtosis           3217.4103  0.0000 Assumptions NOT satisfied!
Link Function       133.7435  0.0000 Assumptions NOT satisfied!
Heteroscedasticity    0.7341  0.3916    Assumptions acceptable.
```


:::

::: {.cell-output-display}
![](10-Correlation_and_regression_files/figure-html/unnamed-chunk-37-1.png){width=95%}
:::
:::




It is necessary to complete these tests when putting together models. With these tests, some of the results above might be called into question!
-->
</section><section id="reporting-regression" class="level2" data-number="5.2"><h2 data-number="5.2" class="anchored" data-anchor-id="reporting-regression">
<span class="header-section-number">5.2</span> Reporting regression</h2>
<p>When reporting linear regression we should make note of the <em>estimate</em> (also known as beta <em>β-value</em>) of each factor along with their <em>p-values</em>. We need to know the <em>R<sup>2</sup></em> and <em>p-value</em> for the model as well as the <em>F-statistic</em> and the <em>degrees of freedom</em>. We can then construct a few sentences to explain our findings <span class="citation" data-cites="statology2021">(<a href="#ref-statology2021" role="doc-biblioref">Zach 2021</a>)</span>:</p>
<blockquote class="blockquote">
<p>Simple linear regression was used to test if [predictor variable] significantly predicted [response variable]. The overall regression was statistically significant (R2 = [R2 value], F(df regression, df residual) = [F-value], p = [p-value]). It was found that [predictor variable] significantly predicted [response variable] (β = [β-value], p = [p-value]).</p>
</blockquote>
<p>For the example above, this would be:</p>
<blockquote class="blockquote">
<p>Simple linear regression was used to test if a student reading grade significantly predicted student maths grade. The overall regression was statistically significant (R<sup>2</sup> = 0.7062, F(1,613662) = 737500, p = &lt;0.001). It was found that reading grade significantly predicted maths grade (β = 0.7863, p = &lt;0.001).</p>
</blockquote>
<p>Alternatively, you could make use of the <code>easystats</code> package which will do most of the heavy lifting for you:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a><span class="fu">library</span>(easystats)</span>
<span id="cb37-2"><a href="#cb37-2"></a>mdl <span class="ot">&lt;-</span> <span class="fu">lm</span>(PV1MATH <span class="sc">~</span> PV1READ, <span class="at">data=</span>PISA_2022)</span>
<span id="cb37-3"><a href="#cb37-3"></a><span class="fu">summary</span>(mdl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = PV1MATH ~ PV1READ, data = PISA_2022)

Residuals:
    Min      1Q  Median      3Q     Max 
-273.61  -38.33   -2.48   36.01  323.51 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 1.021e+02  2.981e-01   342.5   &lt;2e-16 ***
PV1READ     7.731e-01  6.599e-04  1171.5   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 56.61 on 613742 degrees of freedom
Multiple R-squared:  0.691, Adjusted R-squared:  0.691 
F-statistic: 1.372e+06 on 1 and 613742 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a><span class="fu">report</span>(mdl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>We fitted a linear model (estimated using OLS) to predict PV1MATH with PV1READ
(formula: PV1MATH ~ PV1READ). The model explains a statistically significant
and substantial proportion of variance (R2 = 0.69, F(1, 613742) = 1.37e+06, p &lt;
.001, adj. R2 = 0.69). The model's intercept, corresponding to PV1READ = 0, is
at 102.10 (95% CI [101.52, 102.69], t(613742) = 342.54, p &lt; .001). Within this
model:

  - The effect of PV1READ is statistically significant and positive (beta = 0.77,
95% CI [0.77, 0.77], t(613742) = 1171.47, p &lt; .001; Std. beta = 0.83, 95% CI
[0.83, 0.83])

Standardized parameters were obtained by fitting the model on a standardized
version of the dataset. 95% Confidence Intervals (CIs) and p-values were
computed using a Wald t-distribution approximation.</code></pre>
</div>
</div>
<!--
### Science self efficacy

We can also try and recreate fig. 4 from @stoet2018gender, looking at how self-efficacy in science `SCIEEFF` varies given the GGGI `Overall.Score`:
-->
<p>You might also find that you want to convert the results of a linear model into a data frame for further analysis or plotting. To do this we can use the <a href="https://broom.tidymodels.org/">broom</a> package and the <code>tidy()</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb41-2"><a href="#cb41-2"></a>mdl <span class="ot">&lt;-</span> <span class="fu">lm</span>(PV1MATH <span class="sc">~</span> PV1READ, <span class="at">data=</span>PISA_2022)</span>
<span id="cb41-3"><a href="#cb41-3"></a><span class="fu">tidy</span>(mdl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 5
  term        estimate std.error statistic p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
1 (Intercept)  102.     0.298         343.       0
2 PV1READ        0.773  0.000660     1171.       0</code></pre>
</div>
</div>
</section><section id="questions-multivariable-regression" class="level2" data-number="5.3"><h2 data-number="5.3" class="anchored" data-anchor-id="questions-multivariable-regression">
<span class="header-section-number">5.3</span> Questions: Multivariable regression</h2>
<div class="question">
<ol type="1">
<li>Can you explain the result of the following multivariable regression model</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a>mdl <span class="ot">&lt;-</span> <span class="fu">lm</span>(PV1MATH <span class="sc">~</span> ST016Q01NA <span class="sc">+</span> ST004D01T, <span class="at">data =</span> PISA_2022)</span>
<span id="cb43-2"><a href="#cb43-2"></a><span class="fu">summary</span>(mdl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = PV1MATH ~ ST016Q01NA + ST004D01T, data = PISA_2022)

Residuals:
    Min      1Q  Median      3Q     Max 
-446.40  -74.65   -8.02   68.69  476.42 

Coefficients:
               Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   446.31124    0.40789 1094.19   &lt;2e-16 ***
ST016Q01NA     -1.81287    0.05404  -33.55   &lt;2e-16 ***
ST004D01TMale   7.33878    0.28095   26.12   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 99.97 on 517070 degrees of freedom
  (96671 observations deleted due to missingness)
Multiple R-squared:  0.003065,  Adjusted R-squared:  0.003061 
F-statistic: 794.8 on 2 and 517070 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>answer</summary><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a><span class="co"># The model is significant, p &lt; 0.001, but the overall model has a very </span></span>
<span id="cb45-2"><a href="#cb45-2"></a><span class="co"># small/insignificant effect size, R2 = 0.003, meaning the model explains </span></span>
<span id="cb45-3"><a href="#cb45-3"></a><span class="co"># very little of the variance in maths scores. The estimate for ST016Q01NA </span></span>
<span id="cb45-4"><a href="#cb45-4"></a><span class="co"># statistically significant with an estimate of -1.8, meaning for every </span></span>
<span id="cb45-5"><a href="#cb45-5"></a><span class="co"># point increase in student satisfaction with life, their grades went down.</span></span>
<span id="cb45-6"><a href="#cb45-6"></a><span class="co"># When controlling for life satisfaction, student gender was also </span></span>
<span id="cb45-7"><a href="#cb45-7"></a><span class="co"># significant, with males typically getting 7.3 points more than females.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="2" type="1">
<li>Create a multivariable analysis to look at the impact of gender <code>ST004D01T</code> and parental involvement <code>PARINVOL</code> on reading scores. What is wrong with this model, how could you improve this model?</li>
</ol>
<div class="cell">
<details class="code-fold"><summary>answer</summary><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a>mdl <span class="ot">&lt;-</span> <span class="fu">lm</span>(PV1READ <span class="sc">~</span> ST004D01T <span class="sc">+</span> PARINVOL, <span class="at">data =</span> PISA_2022)</span>
<span id="cb46-2"><a href="#cb46-2"></a><span class="fu">summary</span>(mdl)</span>
<span id="cb46-3"><a href="#cb46-3"></a></span>
<span id="cb46-4"><a href="#cb46-4"></a><span class="co"># the R2 is very low, you could try adding more variables to the model</span></span>
<span id="cb46-5"><a href="#cb46-5"></a><span class="co"># you could also try using the stepwise selection method to find the best model</span></span>
<span id="cb46-6"><a href="#cb46-6"></a><span class="co"># PARINVOL can be seen on table: 19.118</span></span>
<span id="cb46-7"><a href="#cb46-7"></a><span class="co"># https://www.oecd.org/pisa/data/pisa2022technicalreport/PISA-2022-Technical-Report-Ch-19-PISA-Tables.xlsx</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="3" type="1">
<li>For the following model, check that the assumptions needed for multivariable analysis have been met:</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a>mdl <span class="ot">&lt;-</span> <span class="fu">lm</span>(PV1SCIE <span class="sc">~</span> other_grades <span class="sc">+</span> ST004D01T <span class="sc">+</span> ESCS, </span>
<span id="cb47-2"><a href="#cb47-2"></a>          <span class="at">data =</span> PISA_2022 <span class="sc">%&gt;%</span> </span>
<span id="cb47-3"><a href="#cb47-3"></a>            <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"Brazil"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb47-4"><a href="#cb47-4"></a>            <span class="fu">mutate</span>(<span class="at">other_grades =</span> (PV1MATH <span class="sc">+</span> PV1READ)<span class="sc">/</span><span class="dv">2</span>))</span>
<span id="cb47-5"><a href="#cb47-5"></a><span class="fu">summary</span>(mdl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details class="code-fold"><summary>answer</summary><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a><span class="co"># quickest way:</span></span>
<span id="cb48-2"><a href="#cb48-2"></a><span class="fu">library</span>(easystats)</span>
<span id="cb48-3"><a href="#cb48-3"></a><span class="fu">check_model</span>(mdl)</span>
<span id="cb48-4"><a href="#cb48-4"></a></span>
<span id="cb48-5"><a href="#cb48-5"></a><span class="co"># For individual tests:    </span></span>
<span id="cb48-6"><a href="#cb48-6"></a><span class="fu">library</span>(car)</span>
<span id="cb48-7"><a href="#cb48-7"></a><span class="fu">library</span>(olsrr)</span>
<span id="cb48-8"><a href="#cb48-8"></a></span>
<span id="cb48-9"><a href="#cb48-9"></a>mdl <span class="ot">&lt;-</span> <span class="fu">lm</span>(PV1SCIE <span class="sc">~</span> other_grades <span class="sc">+</span> ST004D01T <span class="sc">+</span> ESCS, </span>
<span id="cb48-10"><a href="#cb48-10"></a>          <span class="at">data =</span> PISA_2022 <span class="sc">%&gt;%</span> </span>
<span id="cb48-11"><a href="#cb48-11"></a>            <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"Brazil"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb48-12"><a href="#cb48-12"></a>            <span class="fu">mutate</span>(<span class="at">other_grades =</span> (PV1MATH <span class="sc">+</span> PV1READ)<span class="sc">/</span><span class="dv">2</span>))</span>
<span id="cb48-13"><a href="#cb48-13"></a></span>
<span id="cb48-14"><a href="#cb48-14"></a><span class="co"># Independence</span></span>
<span id="cb48-15"><a href="#cb48-15"></a><span class="fu">durbinWatsonTest</span>(mdl)</span>
<span id="cb48-16"><a href="#cb48-16"></a><span class="co">#&gt; lag Autocorrelation D-W Statistic p-value</span></span>
<span id="cb48-17"><a href="#cb48-17"></a><span class="co">#&gt;   1      0.01650897      1.966672   0.094</span></span>
<span id="cb48-18"><a href="#cb48-18"></a><span class="co"># p&gt;0.05 therefore we can assume values are independent</span></span>
<span id="cb48-19"><a href="#cb48-19"></a></span>
<span id="cb48-20"><a href="#cb48-20"></a><span class="co"># No multicollinearity</span></span>
<span id="cb48-21"><a href="#cb48-21"></a><span class="fu">vif</span>(mdl)</span>
<span id="cb48-22"><a href="#cb48-22"></a><span class="co">#&gt; other_grades    ST004D01T         ESCS </span></span>
<span id="cb48-23"><a href="#cb48-23"></a><span class="co">#&gt;     1.161354     1.004684     1.163242 </span></span>
<span id="cb48-24"><a href="#cb48-24"></a><span class="co"># no value over 5, therefore we can assume no multicollinearity</span></span>
<span id="cb48-25"><a href="#cb48-25"></a></span>
<span id="cb48-26"><a href="#cb48-26"></a><span class="co"># Normality and Homoscedasticity</span></span>
<span id="cb48-27"><a href="#cb48-27"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb48-28"><a href="#cb48-28"></a><span class="fu">plot</span>(mdl)</span>
<span id="cb48-29"><a href="#cb48-29"></a><span class="co"># QQ plot looks good and no funneling</span></span>
<span id="cb48-30"><a href="#cb48-30"></a></span>
<span id="cb48-31"><a href="#cb48-31"></a><span class="co"># Breusch-Pagan test p&gt;0.05</span></span>
<span id="cb48-32"><a href="#cb48-32"></a><span class="co"># therefore data is Homoscedastic</span></span>
<span id="cb48-33"><a href="#cb48-33"></a><span class="fu">ols_test_breusch_pagan</span>(mdl)</span>
<span id="cb48-34"><a href="#cb48-34"></a></span>
<span id="cb48-35"><a href="#cb48-35"></a><span class="co">#All tests check out, we can use the model</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="4" type="1">
<li>Create your own multivariable analysis and present your findings to another person in your group. Are you able to explain the results to them? Does the model meet the assumptions necessary for a multivariable analysis?</li>
</ol>
</div>
</section></section><section id="logistic-regression" class="level1" data-number="6"><h1 data-number="6">
<span class="header-section-number">6</span> Logistic regression</h1>
<p>Sometimes the dependent variable will be <em>boolean</em>, that is a field that can only have two values, e.g.&nbsp;<code>True/False</code>, <code>Yes/No</code>, <code>High/Low</code>, etc. Unfortunately we can’t use the linear model to do this as it assumes that the dependent variable is <em>continuous</em>, not <em>binary</em> (or boolean). However, we can run <em>logistic</em> regression models using the <code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code> command where the <code>family=</code> parameter is set to <code>binomial</code>. For example, let’s imagine we want to predict whether a student scored in the top 5% of maths scores in the United Kingdom by looking at the gender and the wealth of a student (using the <code>ESCS</code> field).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a><span class="co"># calculate whether a maths score is in the top 5% of scores for the UK</span></span>
<span id="cb49-2"><a href="#cb49-2"></a>PISA_2022_top_5 <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span> </span>
<span id="cb49-3"><a href="#cb49-3"></a>  <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb49-4"><a href="#cb49-4"></a>  <span class="fu">select</span>(CNT, PV1MATH, PV1SCIE, PV1READ, ESCS, ST004D01T) <span class="sc">%&gt;%</span></span>
<span id="cb49-5"><a href="#cb49-5"></a>  <span class="fu">rename</span>(<span class="at">gender =</span> ST004D01T) <span class="sc">%&gt;%</span></span>
<span id="cb49-6"><a href="#cb49-6"></a>  <span class="co"># add column with the percentage score for PV1MATH</span></span>
<span id="cb49-7"><a href="#cb49-7"></a>  <span class="fu">mutate</span>(<span class="at">top_5_per =</span> </span>
<span id="cb49-8"><a href="#cb49-8"></a>           <span class="fu">ifelse</span>(PV1MATH <span class="sc">&gt;</span> <span class="fu">quantile</span>(PV1MATH, <span class="at">probs =</span> <span class="fl">0.95</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb49-9"><a href="#cb49-9"></a>                        <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb49-10"><a href="#cb49-10"></a>         <span class="at">z_ESCS =</span> <span class="fu">scale</span>(ESCS)) <span class="co"># gives a standardised score for ESCS</span></span>
<span id="cb49-11"><a href="#cb49-11"></a></span>
<span id="cb49-12"><a href="#cb49-12"></a><span class="fu">glm</span>(top_5_per <span class="sc">~</span> gender <span class="sc">+</span> z_ESCS, </span>
<span id="cb49-13"><a href="#cb49-13"></a>    <span class="at">data =</span> PISA_2022_top_5, <span class="at">family=</span><span class="st">"binomial"</span>) <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = top_5_per ~ gender + z_ESCS, family = "binomial", 
    data = PISA_2022_top_5)

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -3.43365    0.07642 -44.933  &lt; 2e-16 ***
genderMale   0.41138    0.08682   4.738 2.15e-06 ***
z_ESCS       0.95106    0.05411  17.576  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 4683.7  on 11083  degrees of freedom
Residual deviance: 4279.8  on 11081  degrees of freedom
  (1888 observations deleted due to missingness)
AIC: 4285.8

Number of Fisher Scoring iterations: 6</code></pre>
</div>
</div>
<p>We can see that Male students are significantly more likely to be in the top 5% for maths scores when you control for the wealth of the student, increasing the log odds by 0.41 units. The wealth of the student is also significant in predicting whether a student is in the top 5% of maths scores, with one standard deviation change<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> in wealth resulting a log odds increase of 0.95 units.</p>
<p>You can also use the <em>odds ratios</em>, which some people find easier to interpret, by setting the <code>exponentiate</code> parameter to <code>TRUE</code> in the <code>tbl_regression</code> command from the <a href="https://github.com/ddsjoberg/gtsummary">gtsummary</a> package:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a><span class="fu">library</span>(gtsummary)</span>
<span id="cb51-2"><a href="#cb51-2"></a><span class="fu">glm</span>(top_5_per <span class="sc">~</span> gender <span class="sc">+</span> z_ESCS , </span>
<span id="cb51-3"><a href="#cb51-3"></a>    <span class="at">data =</span> PISA_2022_top_5, <span class="at">family=</span><span class="st">"binomial"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb51-4"><a href="#cb51-4"></a>  <span class="fu">tbl_regression</span>(<span class="at">exponentiate =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="qvhhotujos" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#qvhhotujos table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#qvhhotujos thead, #qvhhotujos tbody, #qvhhotujos tfoot, #qvhhotujos tr, #qvhhotujos td, #qvhhotujos th {
  border-style: none;
}

#qvhhotujos p {
  margin: 0;
  padding: 0;
}

#qvhhotujos .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#qvhhotujos .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#qvhhotujos .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#qvhhotujos .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#qvhhotujos .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qvhhotujos .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qvhhotujos .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qvhhotujos .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#qvhhotujos .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#qvhhotujos .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#qvhhotujos .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#qvhhotujos .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#qvhhotujos .gt_spanner_row {
  border-bottom-style: hidden;
}

#qvhhotujos .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#qvhhotujos .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#qvhhotujos .gt_from_md > :first-child {
  margin-top: 0;
}

#qvhhotujos .gt_from_md > :last-child {
  margin-bottom: 0;
}

#qvhhotujos .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#qvhhotujos .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#qvhhotujos .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#qvhhotujos .gt_row_group_first td {
  border-top-width: 2px;
}

#qvhhotujos .gt_row_group_first th {
  border-top-width: 2px;
}

#qvhhotujos .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qvhhotujos .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#qvhhotujos .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#qvhhotujos .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qvhhotujos .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qvhhotujos .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#qvhhotujos .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#qvhhotujos .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#qvhhotujos .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qvhhotujos .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qvhhotujos .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#qvhhotujos .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qvhhotujos .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#qvhhotujos .gt_left {
  text-align: left;
}

#qvhhotujos .gt_center {
  text-align: center;
}

#qvhhotujos .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#qvhhotujos .gt_font_normal {
  font-weight: normal;
}

#qvhhotujos .gt_font_bold {
  font-weight: bold;
}

#qvhhotujos .gt_font_italic {
  font-style: italic;
}

#qvhhotujos .gt_super {
  font-size: 65%;
}

#qvhhotujos .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#qvhhotujos .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#qvhhotujos .gt_indent_1 {
  text-indent: 5px;
}

#qvhhotujos .gt_indent_2 {
  text-indent: 10px;
}

#qvhhotujos .gt_indent_3 {
  text-indent: 15px;
}

#qvhhotujos .gt_indent_4 {
  text-indent: 20px;
}

#qvhhotujos .gt_indent_5 {
  text-indent: 25px;
}

#qvhhotujos .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#qvhhotujos div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead><tr class="header gt_col_headings">
<th id="label" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"><strong>Characteristic</strong></th>
<th id="estimate" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">
<strong>OR</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span>
</th>
<th id="conf.low" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">
<strong>95% CI</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span>
</th>
<th id="p.value" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>p-value</strong></th>
</tr></thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="label">gender</td>
<td class="gt_row gt_center" headers="estimate"><br></td>
<td class="gt_row gt_center" headers="conf.low"><br></td>
<td class="gt_row gt_center" headers="p.value"><br></td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Female</td>
<td class="gt_row gt_center" headers="estimate">—</td>
<td class="gt_row gt_center" headers="conf.low">—</td>
<td class="gt_row gt_center" headers="p.value"><br></td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Male</td>
<td class="gt_row gt_center" headers="estimate">1.51</td>
<td class="gt_row gt_center" headers="conf.low">1.27, 1.79</td>
<td class="gt_row gt_center" headers="p.value">&lt;0.001</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">z_ESCS</td>
<td class="gt_row gt_center" headers="estimate">2.59</td>
<td class="gt_row gt_center" headers="conf.low">2.33, 2.88</td>
<td class="gt_row gt_center" headers="p.value">&lt;0.001</td>
</tr>
</tbody>
<tfoot class="gt_footnotes"><tr class="odd">
<td colspan="4" class="gt_footnote">
<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span> OR = Odds Ratio, CI = Confidence Interval</td>
</tr></tfoot>
</table>
</div>
</div>
</div>
<p>There are many other types of regression for different outcome variables, e.g.&nbsp;<em>ordinal</em> regression, <em>multilevel</em> regression, and <em>Poisson</em> regression for count data. We will not cover these here, but you can find out more about these in <span class="citation" data-cites="field2012discovering">Field, Miles, and Field (<a href="#ref-field2012discovering" role="doc-biblioref">2012</a>)</span>.</p>
<section id="checking-the-assumptions-of-logistic-regression" class="level2" data-number="6.1"><h2 data-number="6.1" class="anchored" data-anchor-id="checking-the-assumptions-of-logistic-regression">
<span class="header-section-number">6.1</span> Checking the assumptions of logistic regression</h2>
<p><span class="citation" data-cites="field2012discovering">Field, Miles, and Field (<a href="#ref-field2012discovering" role="doc-biblioref">2012</a>)</span> recommends that you check the assumptions of logistic regression by looking at :</p>
<ul>
<li>
<strong>Linearity</strong> - there exists a linear relationship between the predictors and the <em>logit</em> of the outcome variable (as the outcome can only assume two values, the logit is the natural log of the odds of the event happening)</li>
<li>
<strong>Independence of errors</strong> - data points should be independent of each other</li>
<li>
<strong>No-Multicollinearity</strong> - The independent variables should not be correlated with each other</li>
</ul>
<p>We can test these using a number of methods, for example, we can use the <code>vif()</code> function from the <a href="https://r-forge.r-project.org/projects/car/">car</a> package to check for multicollinearity, the <em>Hosmer-Lemeshow</em> <code>hltest()</code> from <a href="https://mlgs.netlify.app/">glmtoolbox</a> package to test for Linearity (note that large datasets might result in low p-values and this test “is to some extent obsolete”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>) and the <code>check_model</code> plots from the <a href="https://easystats.github.io/easystats/">easystats</a> package. For example</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a><span class="fu">library</span>(easystats)</span>
<span id="cb52-2"><a href="#cb52-2"></a><span class="fu">library</span>(glmtoolbox)</span>
<span id="cb52-3"><a href="#cb52-3"></a><span class="fu">library</span>(car)</span>
<span id="cb52-4"><a href="#cb52-4"></a></span>
<span id="cb52-5"><a href="#cb52-5"></a><span class="co"># make a logistic model </span></span>
<span id="cb52-6"><a href="#cb52-6"></a>mdl <span class="ot">&lt;-</span> <span class="fu">glm</span>(top_5_per <span class="sc">~</span> gender <span class="sc">+</span> z_ESCS <span class="sc">+</span> z_PV1READ, </span>
<span id="cb52-7"><a href="#cb52-7"></a>    <span class="at">data =</span> PISA_2022_top_5 <span class="sc">%&gt;%</span> </span>
<span id="cb52-8"><a href="#cb52-8"></a>      <span class="fu">mutate</span>(<span class="at">z_ESCS =</span> z_ESCS[,<span class="dv">1</span>],</span>
<span id="cb52-9"><a href="#cb52-9"></a>             <span class="at">z_PV1READ =</span> <span class="fu">scale</span>(PV1READ)[,<span class="dv">1</span>]), </span>
<span id="cb52-10"><a href="#cb52-10"></a>    <span class="at">family=</span><span class="st">"binomial"</span>)</span>
<span id="cb52-11"><a href="#cb52-11"></a></span>
<span id="cb52-12"><a href="#cb52-12"></a><span class="fu">vif</span>(mdl)</span>
<span id="cb52-13"><a href="#cb52-13"></a><span class="fu">hltest</span>(mdl)</span>
<span id="cb52-14"><a href="#cb52-14"></a>grphs <span class="ot">&lt;-</span> <span class="fu">check_model</span>(mdl)</span>
<span id="cb52-15"><a href="#cb52-15"></a>grphs<span class="sc">$</span>PP_CHECK</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="seminar-tasks" class="level1" data-number="7"><h1 data-number="7">
<span class="header-section-number">7</span> Seminar Tasks</h1>
<div class="question">
<p>Group discussion:</p>
<ul>
<li>What were the most important findings from Stoet and Geary’s paper?</li>
<li>How trustworthy are the results?</li>
<li>What do these results mean for gender equality in STEM?</li>
</ul>
<ol type="1">
<li>What are <em>Spearman’s Rho</em> and <em>Pearson’s r</em>? When might you use one rather than the other?</li>
</ol>
<div class="cell">
<details class="code-fold"><summary>answer</summary><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a><span class="co">#&gt; When the data you use has outliers or is not </span></span>
<span id="cb53-2"><a href="#cb53-2"></a><span class="co">#&gt; normally distributed (non-parametric) you should use Spearman's Rho</span></span>
<span id="cb53-3"><a href="#cb53-3"></a><span class="co">#&gt; you can test this by checking that shapiro.test p &gt;0.05</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="2" type="1">
<li>Identify dependent and independent variables in the following scenarios and select the most appropriate statistical test (from all that you have learnt) for the analysis.</li>
</ol>
<ul>
<li>The government is trying to understand which groups of people have been affected by a pandemic. They have data on healthcare professionals, education professionals and train drivers and the number of days taken off ill in the last 6 months.</li>
<li>A cigarette company, working in a country that still allows cigarette advertising(!), wants to work out which groups in society are not currently smoking that many cigarettes. They want to find out if city dwellers are more likely to smoke than people living in the countryside.</li>
<li>A netball team is trying to work out how likely their players are to get injured in a season. They have data on the number of injuries per player and the number of minutes each player has been playing netball.</li>
<li>A country is trying to find out whether girls or boys are better behaved in schools. They have access to school databases that record the number of bad behaviour slips for each student.</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>answer</summary><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a><span class="co"># The government is trying to understand which groups of people have been affected by a pandemic. They have data on healthcare professionals, education professionals and train drivers and the number of days taken off ill in the last 6 months.</span></span>
<span id="cb54-2"><a href="#cb54-2"></a><span class="co">#&gt; Dependendent: days off ill</span></span>
<span id="cb54-3"><a href="#cb54-3"></a><span class="co">#&gt; Independent: job role</span></span>
<span id="cb54-4"><a href="#cb54-4"></a><span class="co">#&gt; Suggested model: ANOVA to check if there are differences between jobs</span></span>
<span id="cb54-5"><a href="#cb54-5"></a></span>
<span id="cb54-6"><a href="#cb54-6"></a><span class="co"># A cigarette company, working in a country that still allows cigarette advertising(!), wants to work out which groups in society are not currently smoking that many cigarettes. They want to find out if city dwellers are more likely to smoke than people living in the countryside.</span></span>
<span id="cb54-7"><a href="#cb54-7"></a><span class="co">#&gt; Dependent: Smoker / Non Smoker</span></span>
<span id="cb54-8"><a href="#cb54-8"></a><span class="co">#&gt; Independent: City / Countryside residence</span></span>
<span id="cb54-9"><a href="#cb54-9"></a><span class="co">#&gt; Suggested model: Chi-square</span></span>
<span id="cb54-10"><a href="#cb54-10"></a></span>
<span id="cb54-11"><a href="#cb54-11"></a><span class="co"># A netball team is trying to work out how likely their players are to get injured in a season. They have data on the number of injuries per player and the number of minutes each player has been playing netball.</span></span>
<span id="cb54-12"><a href="#cb54-12"></a><span class="co">#&gt; Dependent: injuries</span></span>
<span id="cb54-13"><a href="#cb54-13"></a><span class="co">#&gt; Independent: time on court</span></span>
<span id="cb54-14"><a href="#cb54-14"></a><span class="co">#&gt; Suggested model: Linear model/regression</span></span>
<span id="cb54-15"><a href="#cb54-15"></a></span>
<span id="cb54-16"><a href="#cb54-16"></a><span class="co"># A country is trying to find out whether girls or boys are better behaved in schools. They have access to school databases that record the number of bad behaviour slips for each student.</span></span>
<span id="cb54-17"><a href="#cb54-17"></a><span class="co">#&gt; Dependent: behaviour slips</span></span>
<span id="cb54-18"><a href="#cb54-18"></a><span class="co">#&gt; Independent: Gender (Girls/Boys)</span></span>
<span id="cb54-19"><a href="#cb54-19"></a><span class="co">#&gt; Suggested model: t-test</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="3" type="1">
<li>Interpret this correlation coefficient between the Index of economic, social and cultural status <code>ESCS</code> and Home Possessions <code>HOMEPOS</code>
</li>
</ol>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's product-moment correlation

data:  PISA_2022$ESCS and PISA_2022$HOMEPOS
t = 999.75, df = 588185, p-value &lt; 2.2e-16
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 0.7924824 0.7943760
sample estimates:
      cor 
0.7934311 </code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>answer</summary><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1"></a><span class="co">#&gt; The Index of economic, social and cultural status `ESCS` is strongly</span></span>
<span id="cb56-2"><a href="#cb56-2"></a><span class="co">#&gt; correlated with home posessions `HOMEPOS`, with a correlation coefficient</span></span>
<span id="cb56-3"><a href="#cb56-3"></a><span class="co">#&gt; of 0.7934311. This model is significant with a p-value of &lt; 0.001</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="4" type="1">
<li>Interpret this linear model based on the FBI’s 2006 crime statistics. It explores the relationship between size of population (1,000s) and the number of murders (units)<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>:</li>
</ol>
<div class="cell">
<div class="cell-output-display">
<div id="rzjtnbwgaz" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#rzjtnbwgaz table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#rzjtnbwgaz thead, #rzjtnbwgaz tbody, #rzjtnbwgaz tfoot, #rzjtnbwgaz tr, #rzjtnbwgaz td, #rzjtnbwgaz th {
  border-style: none;
}

#rzjtnbwgaz p {
  margin: 0;
  padding: 0;
}

#rzjtnbwgaz .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#rzjtnbwgaz .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#rzjtnbwgaz .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#rzjtnbwgaz .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#rzjtnbwgaz .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rzjtnbwgaz .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rzjtnbwgaz .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rzjtnbwgaz .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#rzjtnbwgaz .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#rzjtnbwgaz .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#rzjtnbwgaz .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#rzjtnbwgaz .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#rzjtnbwgaz .gt_spanner_row {
  border-bottom-style: hidden;
}

#rzjtnbwgaz .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#rzjtnbwgaz .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#rzjtnbwgaz .gt_from_md > :first-child {
  margin-top: 0;
}

#rzjtnbwgaz .gt_from_md > :last-child {
  margin-bottom: 0;
}

#rzjtnbwgaz .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#rzjtnbwgaz .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#rzjtnbwgaz .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#rzjtnbwgaz .gt_row_group_first td {
  border-top-width: 2px;
}

#rzjtnbwgaz .gt_row_group_first th {
  border-top-width: 2px;
}

#rzjtnbwgaz .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rzjtnbwgaz .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#rzjtnbwgaz .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#rzjtnbwgaz .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rzjtnbwgaz .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rzjtnbwgaz .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#rzjtnbwgaz .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#rzjtnbwgaz .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#rzjtnbwgaz .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rzjtnbwgaz .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rzjtnbwgaz .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#rzjtnbwgaz .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rzjtnbwgaz .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#rzjtnbwgaz .gt_left {
  text-align: left;
}

#rzjtnbwgaz .gt_center {
  text-align: center;
}

#rzjtnbwgaz .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#rzjtnbwgaz .gt_font_normal {
  font-weight: normal;
}

#rzjtnbwgaz .gt_font_bold {
  font-weight: bold;
}

#rzjtnbwgaz .gt_font_italic {
  font-style: italic;
}

#rzjtnbwgaz .gt_super {
  font-size: 65%;
}

#rzjtnbwgaz .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#rzjtnbwgaz .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#rzjtnbwgaz .gt_indent_1 {
  text-indent: 5px;
}

#rzjtnbwgaz .gt_indent_2 {
  text-indent: 10px;
}

#rzjtnbwgaz .gt_indent_3 {
  text-indent: 15px;
}

#rzjtnbwgaz .gt_indent_4 {
  text-indent: 20px;
}

#rzjtnbwgaz .gt_indent_5 {
  text-indent: 25px;
}

#rzjtnbwgaz .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#rzjtnbwgaz div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead><tr class="header gt_col_headings">
<th id="_" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">_</th>
<th id="Estimate" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Estimate</th>
<th id="Std.-Error" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Std. Error</th>
<th id="t-value" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">t value</th>
<th id="Pr(>|t|)" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Pr(&gt;|t|)</th>
<th id="star" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">star</th>
</tr></thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="_">(Intercept)</td>
<td class="gt_row gt_right" headers="Estimate">-0.726</td>
<td class="gt_row gt_right" headers="Std. Error">0.089</td>
<td class="gt_row gt_right" headers="t value">-8.191</td>
<td class="gt_row gt_left" headers="Pr(>|t|)">&lt;2e-16</td>
<td class="gt_row gt_right" headers="star">***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="_">Pop_thou</td>
<td class="gt_row gt_right" headers="Estimate">0.103</td>
<td class="gt_row gt_right" headers="Std. Error">0.001</td>
<td class="gt_row gt_right" headers="t value">145.932</td>
<td class="gt_row gt_left" headers="Pr(>|t|)">&lt;2e-16</td>
<td class="gt_row gt_right" headers="star">***</td>
</tr>
</tbody>
<tfoot class="gt_sourcenotes"><tr class="odd">
<td colspan="6" class="gt_sourcenote">
<em>Adj R<sup>2</sup></em> 0.721</td>
</tr></tfoot>
</table>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>answer</summary><div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a><span class="co">#&gt; The model is pretty good at explaining the variance, The Adj. R2</span></span>
<span id="cb57-2"><a href="#cb57-2"></a><span class="co">#&gt; shows that population explains 72% of the variance in murders.</span></span>
<span id="cb57-3"><a href="#cb57-3"></a><span class="co">#&gt; The model is significant as p &lt; 0.001. For every increase in </span></span>
<span id="cb57-4"><a href="#cb57-4"></a><span class="co">#&gt; population of 1000 people, the model predicts another 0.1 deaths.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="5" type="1">
<li>Work out the correlation between a country’s <em>mean</em> female mathematics grade and <em>mean</em> male mathematics grade. Should you use <em>Spearman’s Rho</em> or <em>Pearson’s r</em> in your model? Why? EXTENSION: try plotting this data to see if the <code>cor.test</code> result is correct</li>
</ol>
<div class="cell">
<details class="code-fold"><summary>answer</summary><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1"></a>df <span class="ot">&lt;-</span> PISA_2022 <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(CNT, ST004D01T) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">maths =</span> <span class="fu">mean</span>(PV1MATH))</span>
<span id="cb58-2"><a href="#cb58-2"></a></span>
<span id="cb58-3"><a href="#cb58-3"></a>maths_male   <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ST004D01T <span class="sc">==</span> <span class="st">"Male"</span>)</span>
<span id="cb58-4"><a href="#cb58-4"></a>maths_female <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ST004D01T <span class="sc">==</span> <span class="st">"Female"</span>)</span>
<span id="cb58-5"><a href="#cb58-5"></a></span>
<span id="cb58-6"><a href="#cb58-6"></a><span class="co">#&gt; As the shapiro wilkes test has a p-value &gt; 0.05 for girls, </span></span>
<span id="cb58-7"><a href="#cb58-7"></a><span class="co">#&gt; we need to Spearman's Rho as the data is not normally distributed</span></span>
<span id="cb58-8"><a href="#cb58-8"></a></span>
<span id="cb58-9"><a href="#cb58-9"></a><span class="fu">shapiro.test</span>(maths_female<span class="sc">$</span>maths)</span>
<span id="cb58-10"><a href="#cb58-10"></a><span class="co">#&gt; p-value = 0.07514</span></span>
<span id="cb58-11"><a href="#cb58-11"></a></span>
<span id="cb58-12"><a href="#cb58-12"></a><span class="fu">shapiro.test</span>(maths_male<span class="sc">$</span>maths)</span>
<span id="cb58-13"><a href="#cb58-13"></a><span class="co">#&gt; p-value = 0.03921</span></span>
<span id="cb58-14"><a href="#cb58-14"></a></span>
<span id="cb58-15"><a href="#cb58-15"></a><span class="fu">cor.test</span>(maths_male<span class="sc">$</span>maths, maths_female<span class="sc">$</span>maths, <span class="at">method =</span> <span class="st">"spearman"</span>)</span>
<span id="cb58-16"><a href="#cb58-16"></a><span class="co">#&gt; 0.9874121</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="6" type="1">
<li>Create a linear model to explore the relationship between the Index of economic, social and cultural status (<code>ESCS</code>) and the grade in science (<code>PV1SCIE</code>)</li>
</ol>
<div class="cell">
<details class="code-fold"><summary>answer</summary><div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1"></a>mdl <span class="ot">&lt;-</span> <span class="fu">lm</span>(PV1SCIE <span class="sc">~</span> ESCS, <span class="at">data =</span> PISA_2022)</span>
<span id="cb59-2"><a href="#cb59-2"></a><span class="fu">summary</span>(mdl)</span>
<span id="cb59-3"><a href="#cb59-3"></a></span>
<span id="cb59-4"><a href="#cb59-4"></a><span class="co">#&gt; For every increase in ESCS score by 1 </span></span>
<span id="cb59-5"><a href="#cb59-5"></a><span class="co">#&gt; there is an increase in score of 40.0837 points, </span></span>
<span id="cb59-6"><a href="#cb59-6"></a><span class="co">#&gt; ESCS is a significant predictor p &lt;2e-16 ***, </span></span>
<span id="cb59-7"><a href="#cb59-7"></a><span class="co">#&gt; but the overall model has a low R squared value of 0.1837</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Add the student maths score <code>PV1MATH</code> this model, how does this change the outcome?</p>
<div class="cell">
<details class="code-fold"><summary>answer</summary><div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1"></a>mdl <span class="ot">&lt;-</span> <span class="fu">lm</span>(PV1SCIE <span class="sc">~</span> ESCS <span class="sc">+</span> PV1MATH, <span class="at">data =</span> PISA_2022)</span>
<span id="cb60-2"><a href="#cb60-2"></a><span class="fu">summary</span>(mdl)</span>
<span id="cb60-3"><a href="#cb60-3"></a></span>
<span id="cb60-4"><a href="#cb60-4"></a><span class="co">#&gt; For every increase in ESCS grade, </span></span>
<span id="cb60-5"><a href="#cb60-5"></a><span class="co">#&gt; there is now a science score increase of only 3.225, </span></span>
<span id="cb60-6"><a href="#cb60-6"></a><span class="co">#&gt; i.e. when controlling for maths outcomes, ESCS </span></span>
<span id="cb60-7"><a href="#cb60-7"></a><span class="co">#&gt;  explains less of the overall science grade. </span></span>
<span id="cb60-8"><a href="#cb60-8"></a><span class="co">#&gt; Both factors remain significant and the overall model </span></span>
<span id="cb60-9"><a href="#cb60-9"></a><span class="co">#&gt; now has a very high R squared value of 0.7905</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="7" type="1">
<li>Load the school level data set for 2022 (file <a href="https://emckclac-my.sharepoint.com/:u:/g/personal/k1926273_kcl_ac_uk/EaEQPEKYzR9MmiqLBYXOhmYBNXYg15UoDKGip-78kS1DvA?e=q74fyK">here</a>) and explore the fields.</li>
</ol>
<p>Using a linear model, how do “Shortage of educational staff” <code>STAFFSHORT</code> and “Shortage of educational material” <code>EDUSHORT</code> relate to “Student behaviour hindering learning” <code>STUBEHA</code></p>
<div class="cell">
<details class="code-fold"><summary>answer</summary><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1"></a>mdl <span class="ot">&lt;-</span> <span class="fu">lm</span>(STUBEHA <span class="sc">~</span> STAFFSHORT <span class="sc">+</span> EDUSHORT, <span class="at">data=</span>PISA_2022_school)</span>
<span id="cb61-2"><a href="#cb61-2"></a><span class="fu">summary</span>(mdl)</span>
<span id="cb61-3"><a href="#cb61-3"></a></span>
<span id="cb61-4"><a href="#cb61-4"></a><span class="co">#&gt; STAFFSHORT has a slightly larger estimate, 0.339116, than EDUSHORT, 0.190948</span></span>
<span id="cb61-5"><a href="#cb61-5"></a><span class="co">#&gt; This means as staff and educational resource shortages increase, so does</span></span>
<span id="cb61-6"><a href="#cb61-6"></a><span class="co">#&gt; student behaviour hindering learning.</span></span>
<span id="cb61-7"><a href="#cb61-7"></a><span class="co">#&gt; Both factors are significant p &lt;2e-16 ***</span></span>
<span id="cb61-8"><a href="#cb61-8"></a><span class="co">#&gt; The effect size of the overall model is relatively low, at 0.1983</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Adjust the model to incorporate the percentage of boys in a school (see <code>SC002Q01TA</code> and <code>SCHSIZE</code>), what difference does this make?</p>
<div class="cell">
<details class="code-fold"><summary>answer</summary><div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1"></a>tbl_beh_predict <span class="ot">&lt;-</span> PISA_2022_school <span class="sc">%&gt;%</span> </span>
<span id="cb62-2"><a href="#cb62-2"></a>  <span class="fu">mutate</span>(<span class="at">boy_per =</span> <span class="dv">100</span> <span class="sc">*</span> SC002Q01TA <span class="sc">/</span> SCHSIZE)</span>
<span id="cb62-3"><a href="#cb62-3"></a></span>
<span id="cb62-4"><a href="#cb62-4"></a>mdl <span class="ot">&lt;-</span> <span class="fu">lm</span>(STUBEHA <span class="sc">~</span> STAFFSHORT <span class="sc">+</span> EDUSHORT <span class="sc">+</span> boy_per, <span class="at">data=</span>tbl_beh_predict)</span>
<span id="cb62-5"><a href="#cb62-5"></a><span class="fu">summary</span>(mdl)</span>
<span id="cb62-6"><a href="#cb62-6"></a></span>
<span id="cb62-7"><a href="#cb62-7"></a><span class="co">#&gt; adding percentage of boys to the model increases the effect size to 0.2058,</span></span>
<span id="cb62-8"><a href="#cb62-8"></a><span class="co">#&gt; when controlling for boy_per the estimate of staff shortages</span></span>
<span id="cb62-9"><a href="#cb62-9"></a><span class="co">#&gt; decreases slightly, and the estimate of educational shortages</span></span>
<span id="cb62-10"><a href="#cb62-10"></a><span class="co">#&gt; increases. The estimate of boy_per is significant, for every </span></span>
<span id="cb62-11"><a href="#cb62-11"></a><span class="co">#&gt; one percent increase in boys in a school, student behaviour</span></span>
<span id="cb62-12"><a href="#cb62-12"></a><span class="co">#&gt; hindering learning increases by 0.002, this model shows an all </span></span>
<span id="cb62-13"><a href="#cb62-13"></a><span class="co">#&gt; girls school would likely have a student behaviour hindering</span></span>
<span id="cb62-14"><a href="#cb62-14"></a><span class="co">#&gt; learning value 0.2 lower than an all boys school!</span></span>
<span id="cb62-15"><a href="#cb62-15"></a><span class="co">#&gt; it'd be worth double checking to see if boy_per is parametric</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>How does the explanatory value of this model change if you only look at schools in the UK?</p>
<div class="cell">
<details class="code-fold"><summary>answer</summary><div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a>mdl <span class="ot">&lt;-</span> <span class="fu">lm</span>(STUBEHA <span class="sc">~</span> STAFFSHORT <span class="sc">+</span> EDUSHORT <span class="sc">+</span> boy_per, </span>
<span id="cb63-2"><a href="#cb63-2"></a>          <span class="at">data=</span>tbl_beh_predict <span class="sc">%&gt;%</span> <span class="fu">filter</span>(CNT <span class="sc">==</span> <span class="st">"United Kingdom"</span>))</span>
<span id="cb63-3"><a href="#cb63-3"></a><span class="fu">summary</span>(mdl)</span>
<span id="cb63-4"><a href="#cb63-4"></a></span>
<span id="cb63-5"><a href="#cb63-5"></a><span class="co">#&gt; for the UK the effect size is larger at 0.2291, more of the variance of</span></span>
<span id="cb63-6"><a href="#cb63-6"></a><span class="co">#&gt; STUBEHA is explained by this model than for other countries</span></span>
<span id="cb63-7"><a href="#cb63-7"></a><span class="co">#&gt; Educational resource shortages have a smaller impact on STUBEHA, </span></span>
<span id="cb63-8"><a href="#cb63-8"></a><span class="co">#&gt; than in other countries, with an estimate of 0.142237</span></span>
<span id="cb63-9"><a href="#cb63-9"></a><span class="co">#&gt; staff shortages have a bigger impact that other countries, with an</span></span>
<span id="cb63-10"><a href="#cb63-10"></a><span class="co">#&gt; estimate of 0.369571</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="8" type="1">
<li>Using <code>left_join</code> (see <a href="#sec-leftjoin" class="quarto-xref">Section&nbsp;8.4</a>), link each student record in <code>PISA_2022</code> to their school details (file <a href="https://emckclac-my.sharepoint.com/:u:/g/personal/k1926273_kcl_ac_uk/EaEQPEKYzR9MmiqLBYXOhmYBNXYg15UoDKGip-78kS1DvA?e=q74fyK">here</a>). You will need need to <code>select</code> a subset of the school table to cover: <code>CNT, CNTSCHID, SC016Q02TA, SC156Q03HA, SC156Q04HA, SC154Q01HA,</code> <code>SC154Q02WA, SC154Q05WA, SC154Q08WA, SC154Q09HA, STRATIO, CLSIZE,</code> <code>EDUSHORT, STAFFSHORT, STUBEHA</code>
</li>
</ol>
<div class="cell">
<details class="code-fold"><summary>left_join code</summary><div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1"></a><span class="co">#&gt; SC016Q02TA   Percentage of total funding for school year from: Student fees or school charges paid by parents</span></span>
<span id="cb64-2"><a href="#cb64-2"></a><span class="co">#&gt; SC035Q01NA   How student tests are used: [Standardised tests]: To guide students' learning</span></span>
<span id="cb64-3"><a href="#cb64-3"></a><span class="co">#&gt; SC035Q10TA   How student tests are used: [Standardised tests]: To compare the school with other schools</span></span>
<span id="cb64-4"><a href="#cb64-4"></a><span class="co">#&gt; SC035Q08TB   How student tests are used: Teacher-developed tests: To identify aspects of instruction or the curriculum that could be improved</span></span>
<span id="cb64-5"><a href="#cb64-5"></a><span class="co">#&gt; SC035Q09NA   How student tests are used: [Standardised tests]: To adapt teaching to the students' needs</span></span>
<span id="cb64-6"><a href="#cb64-6"></a><span class="co">#&gt; SC035Q09NB   How student tests are used: Teacher-developed tests: To adapt teaching to the students' needs</span></span>
<span id="cb64-7"><a href="#cb64-7"></a></span>
<span id="cb64-8"><a href="#cb64-8"></a><span class="co">#&gt; STRATIO  Student-Teacher ratio</span></span>
<span id="cb64-9"><a href="#cb64-9"></a><span class="co">#&gt; CLSIZE   Class Size (cheating here slightly as this is a nominal field which roughly maps to the continuous) - in test English</span></span>
<span id="cb64-10"><a href="#cb64-10"></a><span class="co">#&gt; EDUSHORT Shortage of educational material (WLE)</span></span>
<span id="cb64-11"><a href="#cb64-11"></a><span class="co">#&gt; STAFFSHORT   Shortage of educational staff (WLE)</span></span>
<span id="cb64-12"><a href="#cb64-12"></a><span class="co">#&gt; STUBEHA  Student behaviour hindering learning (WLE)</span></span>
<span id="cb64-13"><a href="#cb64-13"></a></span>
<span id="cb64-14"><a href="#cb64-14"></a>PISA_2022_stusch <span class="ot">&lt;-</span> </span>
<span id="cb64-15"><a href="#cb64-15"></a>  <span class="fu">left_join</span>(PISA_2022 <span class="sc">%&gt;%</span> <span class="fu">select</span>(CNT, CNTSCHID, ST004D01T, HOMEPOS, </span>
<span id="cb64-16"><a href="#cb64-16"></a>                                 ESCS, PV1SCIE, PV1MATH, PV1READ), </span>
<span id="cb64-17"><a href="#cb64-17"></a>             PISA_2022_school <span class="sc">%&gt;%</span> </span>
<span id="cb64-18"><a href="#cb64-18"></a>              <span class="fu">select</span>(CNT, CNTSCHID, SC016Q02TA, SC035Q01NA,</span>
<span id="cb64-19"><a href="#cb64-19"></a>                     SC035Q10TA, SC035Q08TB, SC035Q09NA, SC035Q09NB,</span>
<span id="cb64-20"><a href="#cb64-20"></a>                     STRATIO, CLSIZE, EDUSHORT, STAFFSHORT, STUBEHA))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Using a linear model, find out how well the student teacher ratio <code>STRATIO</code> in a school predicts the <code>mean</code> maths achievement <code>PV1MATH</code> in that school. <strong>HINT</strong>: you need one row for each school, so use summarise with unique on <code>STRATIO</code> and mean on <code>PV1MATH</code>:</p>
<div class="cell">
<details class="code-fold"><summary>answer</summary><div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1"></a>stu_tch_mat <span class="ot">&lt;-</span> PISA_2022_stusch <span class="sc">%&gt;%</span> </span>
<span id="cb65-2"><a href="#cb65-2"></a>  <span class="fu">group_by</span>(CNTSCHID) <span class="sc">%&gt;%</span></span>
<span id="cb65-3"><a href="#cb65-3"></a>  <span class="fu">summarise</span>(<span class="at">stu_tch_rat =</span> <span class="fu">unique</span>(STRATIO),</span>
<span id="cb65-4"><a href="#cb65-4"></a>            <span class="at">maths =</span> <span class="fu">mean</span>(PV1MATH))</span>
<span id="cb65-5"><a href="#cb65-5"></a></span>
<span id="cb65-6"><a href="#cb65-6"></a>mdl_stu_tch_mat <span class="ot">&lt;-</span> <span class="fu">lm</span>(maths <span class="sc">~</span> stu_tch_rat, <span class="at">data=</span>stu_tch_mat)</span>
<span id="cb65-7"><a href="#cb65-7"></a><span class="fu">summary</span>(mdl_stu_tch_mat)</span>
<span id="cb65-8"><a href="#cb65-8"></a></span>
<span id="cb65-9"><a href="#cb65-9"></a><span class="co">#&gt; it's significant p &lt;2e-16 ***, but with a very low </span></span>
<span id="cb65-10"><a href="#cb65-10"></a><span class="co">#&gt; estimates/betas, i.e. one extra student per teacher </span></span>
<span id="cb65-11"><a href="#cb65-11"></a><span class="co">#&gt; decreases the maths score by just 1.3 points, </span></span>
<span id="cb65-12"><a href="#cb65-12"></a><span class="co">#&gt; additionally the R squared value is low 0.04486 </span></span>
<span id="cb65-13"><a href="#cb65-13"></a><span class="co">#&gt; this is "low impact" in the EEF toolkit</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Adjust the linear model used above to incorporate <code>STUBEHA</code> “Student behaviour hindering learning” in addition to the student teacher ratio:</p>
<div class="cell">
<details class="code-fold"><summary>answer</summary><div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1"></a>stu_tch_mat_bev <span class="ot">&lt;-</span> PISA_2022_stusch <span class="sc">%&gt;%</span> </span>
<span id="cb66-2"><a href="#cb66-2"></a>  <span class="fu">group_by</span>(CNTSCHID) <span class="sc">%&gt;%</span></span>
<span id="cb66-3"><a href="#cb66-3"></a>  <span class="fu">summarise</span>(<span class="at">stu_tch_rat =</span> <span class="fu">unique</span>(STRATIO),</span>
<span id="cb66-4"><a href="#cb66-4"></a>            <span class="at">behaviour =</span> <span class="fu">unique</span>(STUBEHA),</span>
<span id="cb66-5"><a href="#cb66-5"></a>            <span class="at">maths =</span> <span class="fu">mean</span>(PV1MATH))</span>
<span id="cb66-6"><a href="#cb66-6"></a></span>
<span id="cb66-7"><a href="#cb66-7"></a><span class="co">#&gt; max(stu_tch_mat_bev$behaviour, na.rm = TRUE)</span></span>
<span id="cb66-8"><a href="#cb66-8"></a><span class="co">#&gt; min(stu_tch_mat_bev$behaviour, na.rm = TRUE)</span></span>
<span id="cb66-9"><a href="#cb66-9"></a></span>
<span id="cb66-10"><a href="#cb66-10"></a>mdl_stu_tch_mat_bev <span class="ot">&lt;-</span> <span class="fu">lm</span>(maths <span class="sc">~</span> stu_tch_rat <span class="sc">+</span> behaviour, <span class="at">data=</span>stu_tch_mat_bev)</span>
<span id="cb66-11"><a href="#cb66-11"></a><span class="fu">summary</span>(mdl_stu_tch_mat_bev)</span>
<span id="cb66-12"><a href="#cb66-12"></a></span>
<span id="cb66-13"><a href="#cb66-13"></a><span class="co">#&gt; both factors are significant p&lt;2e-16 ***, but with low estimates/betas, </span></span>
<span id="cb66-14"><a href="#cb66-14"></a><span class="co">#&gt; i.e. one extra student per teacher decreases </span></span>
<span id="cb66-15"><a href="#cb66-15"></a><span class="co">#&gt; the maths score by 1.6 points and the aggregated student behaviour hinder </span></span>
<span id="cb66-16"><a href="#cb66-16"></a><span class="co">#&gt; learning decreases maths by 11.8 points </span></span>
<span id="cb66-17"><a href="#cb66-17"></a><span class="co">#&gt; (max behaviour = 4.1448, min = -4.432), additionally the R squared value </span></span>
<span id="cb66-18"><a href="#cb66-18"></a><span class="co">#&gt; is better, but still low 0.07449</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="8" type="1">
<li>Test the model for independence, multi-collinearity, normality and homoscedasticity.</li>
</ol>
<div class="cell">
<details class="code-fold"><summary>answer</summary><div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1"></a><span class="co"># Independence</span></span>
<span id="cb67-2"><a href="#cb67-2"></a><span class="fu">durbinWatsonTest</span>(mdl_stu_tch_mat_bev)</span>
<span id="cb67-3"><a href="#cb67-3"></a><span class="co">#&gt; lag Autocorrelation D-W Statistic p-value</span></span>
<span id="cb67-4"><a href="#cb67-4"></a><span class="co">#&gt;   1      0.01650897      1.966672   0.094</span></span>
<span id="cb67-5"><a href="#cb67-5"></a><span class="co"># p&gt;0.05 therefore we can assume values are independent</span></span>
<span id="cb67-6"><a href="#cb67-6"></a></span>
<span id="cb67-7"><a href="#cb67-7"></a><span class="co"># No multicollinearity</span></span>
<span id="cb67-8"><a href="#cb67-8"></a><span class="fu">vif</span>(mdl_stu_tch_mat_bev)</span>
<span id="cb67-9"><a href="#cb67-9"></a><span class="co">#&gt; stu_tch_rat   behaviour </span></span>
<span id="cb67-10"><a href="#cb67-10"></a><span class="co">#&gt;     1.00856     1.00856 </span></span>
<span id="cb67-11"><a href="#cb67-11"></a><span class="co"># no value over 5, therefore we can assume no multicollinearity</span></span>
<span id="cb67-12"><a href="#cb67-12"></a></span>
<span id="cb67-13"><a href="#cb67-13"></a><span class="co"># Normality and Homoscedasticity</span></span>
<span id="cb67-14"><a href="#cb67-14"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb67-15"><a href="#cb67-15"></a><span class="fu">plot</span>(mdl_stu_tch_mat_bev)</span>
<span id="cb67-16"><a href="#cb67-16"></a><span class="co"># QQ plot looks good but lots of outliers</span></span>
<span id="cb67-17"><a href="#cb67-17"></a></span>
<span id="cb67-18"><a href="#cb67-18"></a><span class="co"># Breusch-Pagan test p&lt;0.05</span></span>
<span id="cb67-19"><a href="#cb67-19"></a><span class="co"># therefore data is NOT Homoscedastic (which we can see from the graphs)</span></span>
<span id="cb67-20"><a href="#cb67-20"></a><span class="fu">ols_test_breusch_pagan</span>(mdl_stu_tch_mat_bev)</span>
<span id="cb67-21"><a href="#cb67-21"></a></span>
<span id="cb67-22"><a href="#cb67-22"></a><span class="co"># Unfortunately this model doesn't pass the assumptions of:</span></span>
<span id="cb67-23"><a href="#cb67-23"></a><span class="co"># - Homoscedasticity, and</span></span>
<span id="cb67-24"><a href="#cb67-24"></a><span class="co"># - Independence</span></span>
<span id="cb67-25"><a href="#cb67-25"></a><span class="co"># and linear modelling doesn't appear appropriate here.</span></span>
<span id="cb67-26"><a href="#cb67-26"></a><span class="co"># Maybe a subset of the countries might give a better result?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="9" type="1">
<li>Explore the school data set to look at other interesting models. The school data set has a lot more numeric/continuous fields than the student table! To find these fields use this code:</li>
</ol>
<div class="cell">
<details class="code-fold"><summary>find numeric fields</summary><div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1"></a><span class="co"># to get the names of numeric fields along with their labels</span></span>
<span id="cb68-2"><a href="#cb68-2"></a>nms <span class="ot">&lt;-</span> PISA_2022_school <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">where</span>(is.numeric)) <span class="sc">%&gt;%</span> <span class="fu">names</span>()</span>
<span id="cb68-3"><a href="#cb68-3"></a>lbls <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(nms,<span class="sc">~</span>{</span>
<span id="cb68-4"><a href="#cb68-4"></a>  <span class="co">#.x &lt;- "test"</span></span>
<span id="cb68-5"><a href="#cb68-5"></a>  <span class="fu">message</span>(.x)</span>
<span id="cb68-6"><a href="#cb68-6"></a>  lbl <span class="ot">&lt;-</span> <span class="fu">attr</span>(PISA_2022_school[[.x]], <span class="st">"label"</span>)</span>
<span id="cb68-7"><a href="#cb68-7"></a>  nme <span class="ot">&lt;-</span> .x</span>
<span id="cb68-8"><a href="#cb68-8"></a>  row <span class="ot">&lt;-</span> <span class="fu">c</span>(nme, lbl)</span>
<span id="cb68-9"><a href="#cb68-9"></a>  <span class="fu">names</span>(row) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"name"</span>, <span class="st">"label"</span>)</span>
<span id="cb68-10"><a href="#cb68-10"></a>  <span class="fu">return</span>(row)</span>
<span id="cb68-11"><a href="#cb68-11"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol start="10" type="1">
<li><p>In pairs discuss how you could use correlation and regression in your own research. Start building some models to explore the data sets.</p></li>
<li><p>Recreate the Stoet &amp; Geary analysis (see <a href="#sec-standard-stoet-geary" class="quarto-xref">Section&nbsp;8.5</a>) to see if there is a “gender gap in intraindividual <strong>mathematics</strong> scores” that is “larger in more gender-equal countries”. You might expect this to be the case as it exists for science. Is this a STEM wide finding? How does the science model look for 2022 data? Was it a one off finding?</p></li>
</ol>
<div class="cell">
<details class="code-fold"><summary>answer</summary><div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1"></a><span class="co"># standardise the results for each student in line with pg7</span></span>
<span id="cb69-2"><a href="#cb69-2"></a><span class="co"># https://eprints.leedsbeckett.ac.uk/id/eprint/4753/6/symplectic-version.pdf</span></span>
<span id="cb69-3"><a href="#cb69-3"></a></span>
<span id="cb69-4"><a href="#cb69-4"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb69-5"><a href="#cb69-5"></a><span class="fu">library</span>(arrow)</span>
<span id="cb69-6"><a href="#cb69-6"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb69-7"><a href="#cb69-7"></a></span>
<span id="cb69-8"><a href="#cb69-8"></a>PISA_2015_GGGI <span class="ot">&lt;-</span> <span class="fu">left_join</span>(</span>
<span id="cb69-9"><a href="#cb69-9"></a>  PISA_2015 <span class="sc">%&gt;%</span> <span class="fu">select</span>(CNT, ST004D01T, PV1MATH, PV1SCIE, PV1READ, SCIEEFF),</span>
<span id="cb69-10"><a href="#cb69-10"></a>  GGGI <span class="sc">%&gt;%</span> <span class="fu">select</span>(Country, Overall.Score),</span>
<span id="cb69-11"><a href="#cb69-11"></a>  <span class="at">by=</span><span class="fu">c</span>(<span class="st">"CNT"</span><span class="ot">=</span><span class="st">"Country"</span>))</span>
<span id="cb69-12"><a href="#cb69-12"></a></span>
<span id="cb69-13"><a href="#cb69-13"></a><span class="co"># step 1</span></span>
<span id="cb69-14"><a href="#cb69-14"></a>PISA_2015z <span class="ot">&lt;-</span> PISA_2015_GGGI <span class="sc">%&gt;%</span> </span>
<span id="cb69-15"><a href="#cb69-15"></a>  <span class="fu">rename</span>(<span class="at">gender =</span> ST004D01T) <span class="sc">%&gt;%</span></span>
<span id="cb69-16"><a href="#cb69-16"></a>  <span class="fu">group_by</span>(CNT) <span class="sc">%&gt;%</span></span>
<span id="cb69-17"><a href="#cb69-17"></a>  <span class="fu">mutate</span>(<span class="at">zMaths   =</span> <span class="fu">scale</span>(PV1MATH),</span>
<span id="cb69-18"><a href="#cb69-18"></a>         <span class="at">zScience =</span> <span class="fu">scale</span>(PV1SCIE), </span>
<span id="cb69-19"><a href="#cb69-19"></a>         <span class="at">zReading =</span> <span class="fu">scale</span>(PV1READ))</span>
<span id="cb69-20"><a href="#cb69-20"></a></span>
<span id="cb69-21"><a href="#cb69-21"></a><span class="co"># step 2</span></span>
<span id="cb69-22"><a href="#cb69-22"></a>PISA_2015z <span class="ot">&lt;-</span> PISA_2015z <span class="sc">%&gt;%</span> </span>
<span id="cb69-23"><a href="#cb69-23"></a>  <span class="fu">mutate</span>(<span class="at">zGeneral =</span> (zMaths <span class="sc">+</span> zScience <span class="sc">+</span> zReading) <span class="sc">/</span> <span class="dv">3</span>)</span>
<span id="cb69-24"><a href="#cb69-24"></a></span>
<span id="cb69-25"><a href="#cb69-25"></a><span class="co"># step 3</span></span>
<span id="cb69-26"><a href="#cb69-26"></a>PISA_2015z <span class="ot">&lt;-</span> PISA_2015z <span class="sc">%&gt;%</span> </span>
<span id="cb69-27"><a href="#cb69-27"></a>  <span class="fu">mutate</span>(<span class="at">rel_MATH =</span> zMaths   <span class="sc">-</span> zGeneral,</span>
<span id="cb69-28"><a href="#cb69-28"></a>         <span class="at">rel_SCIE =</span> zScience <span class="sc">-</span> zGeneral,</span>
<span id="cb69-29"><a href="#cb69-29"></a>         <span class="at">rel_READ =</span> zReading <span class="sc">-</span> zGeneral)</span>
<span id="cb69-30"><a href="#cb69-30"></a></span>
<span id="cb69-31"><a href="#cb69-31"></a><span class="co"># step 4 part 1</span></span>
<span id="cb69-32"><a href="#cb69-32"></a>PISA_2015z <span class="ot">&lt;-</span> PISA_2015z <span class="sc">%&gt;%</span> </span>
<span id="cb69-33"><a href="#cb69-33"></a>  <span class="fu">group_by</span>(CNT, gender) <span class="sc">%&gt;%</span></span>
<span id="cb69-34"><a href="#cb69-34"></a>  <span class="fu">summarise</span>(<span class="at">zMaths =</span> <span class="fu">mean</span>(zMaths, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb69-35"><a href="#cb69-35"></a>            <span class="at">zScience =</span> <span class="fu">mean</span>(zScience, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb69-36"><a href="#cb69-36"></a>            <span class="at">zReading =</span> <span class="fu">mean</span>(zReading, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb69-37"><a href="#cb69-37"></a>            <span class="at">zGeneral =</span> <span class="fu">mean</span>(zGeneral, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb69-38"><a href="#cb69-38"></a>            <span class="at">rel_MATH =</span> zMaths <span class="sc">-</span> zGeneral,</span>
<span id="cb69-39"><a href="#cb69-39"></a>            <span class="at">rel_SCIE =</span> zScience <span class="sc">-</span> zGeneral,</span>
<span id="cb69-40"><a href="#cb69-40"></a>            <span class="at">rel_READ =</span> zReading <span class="sc">-</span> zGeneral,</span>
<span id="cb69-41"><a href="#cb69-41"></a>            <span class="at">gggi =</span> <span class="fu">unique</span>(Overall.Score))</span>
<span id="cb69-42"><a href="#cb69-42"></a></span>
<span id="cb69-43"><a href="#cb69-43"></a><span class="co"># step 4 part 2</span></span>
<span id="cb69-44"><a href="#cb69-44"></a>pisa_gggi_diff <span class="ot">&lt;-</span> PISA_2015z <span class="sc">%&gt;%</span></span>
<span id="cb69-45"><a href="#cb69-45"></a>  <span class="fu">select</span>(CNT, gender, gggi, rel_MATH) <span class="sc">%&gt;%</span></span>
<span id="cb69-46"><a href="#cb69-46"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> gender,</span>
<span id="cb69-47"><a href="#cb69-47"></a>              <span class="at">values_from =</span> rel_MATH) <span class="sc">%&gt;%</span></span>
<span id="cb69-48"><a href="#cb69-48"></a>  <span class="fu">mutate</span>(<span class="at">difference =</span>  Male <span class="sc">-</span> Female)</span>
<span id="cb69-49"><a href="#cb69-49"></a></span>
<span id="cb69-50"><a href="#cb69-50"></a><span class="fu">ggplot</span>(pisa_gggi_diff,</span>
<span id="cb69-51"><a href="#cb69-51"></a>       <span class="fu">aes</span>(<span class="at">x=</span>difference, <span class="at">y=</span>gggi)) <span class="sc">+</span> </span>
<span id="cb69-52"><a href="#cb69-52"></a>  <span class="fu">geom_point</span>(<span class="at">colour=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb69-53"><a href="#cb69-53"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb69-54"><a href="#cb69-54"></a>  <span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label=</span>CNT),</span>
<span id="cb69-55"><a href="#cb69-55"></a>            <span class="at">box.padding =</span> <span class="fl">0.2</span>,</span>
<span id="cb69-56"><a href="#cb69-56"></a>            <span class="at">max.overlaps =</span> <span class="cn">Inf</span>,</span>
<span id="cb69-57"><a href="#cb69-57"></a>            <span class="at">colour=</span><span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb69-58"><a href="#cb69-58"></a>  <span class="fu">xlab</span>(<span class="fu">paste0</span>(<span class="st">"relative difference in PV1MATH scores (male-female)"</span>))</span>
<span id="cb69-59"><a href="#cb69-59"></a></span>
<span id="cb69-60"><a href="#cb69-60"></a><span class="co"># perform correlation analysis</span></span>
<span id="cb69-61"><a href="#cb69-61"></a>result <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(pisa_gggi_diff<span class="sc">$</span>gggi, </span>
<span id="cb69-62"><a href="#cb69-62"></a>                    pisa_gggi_diff<span class="sc">$</span>difference, </span>
<span id="cb69-63"><a href="#cb69-63"></a>                    <span class="at">method=</span><span class="st">"spearman"</span>)</span>
<span id="cb69-64"><a href="#cb69-64"></a>result</span>
<span id="cb69-65"><a href="#cb69-65"></a><span class="co">#&gt; this result isn't significant as p-value &gt; 0.05</span></span>
<span id="cb69-66"><a href="#cb69-66"></a><span class="co">#&gt; additionally the correlation coefficient is negative</span></span>
<span id="cb69-67"><a href="#cb69-67"></a><span class="co">#&gt; this suggests that the STEM gender paradox doesn't apply to maths.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</section><section id="extension-topics" class="level1" data-number="8"><h1 data-number="8">
<span class="header-section-number">8</span> Extension topics</h1>
<section id="sec-z-values" class="level2" data-number="8.1"><h2 data-number="8.1" class="anchored" data-anchor-id="sec-z-values">
<span class="header-section-number">8.1</span> Standardising results with z-values</h2>
<p>When we are trying to compare data between countries, our results can be heavily skewed by the overall performance of a country. For example, imagine we have country <em>A</em> and country <em>U</em>. Students in country <em>A</em> generally get high grades with a very high standard deviation, whilst students in country <em>U</em> generally get very low grades with a very low standard deviation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">sex=</span><span class="fu">c</span>(<span class="st">"M"</span>,<span class="st">"M"</span>,<span class="st">"M"</span>,<span class="st">"F"</span>,<span class="st">"F"</span>,<span class="st">"F"</span>,<span class="st">"M"</span>,<span class="st">"M"</span>,<span class="st">"M"</span>,<span class="st">"F"</span>,<span class="st">"F"</span>,<span class="st">"F"</span>),</span>
<span id="cb70-2"><a href="#cb70-2"></a>           <span class="at">country=</span><span class="fu">c</span>(<span class="st">"A"</span>,<span class="st">"A"</span>,<span class="st">"A"</span>,<span class="st">"A"</span>,<span class="st">"A"</span>,<span class="st">"A"</span>,<span class="st">"U"</span>,<span class="st">"U"</span>,<span class="st">"U"</span>,<span class="st">"U"</span>,<span class="st">"U"</span>,<span class="st">"U"</span>),</span>
<span id="cb70-3"><a href="#cb70-3"></a>           <span class="at">grade=</span><span class="fu">c</span>(<span class="dv">100</span>,<span class="dv">87</span>,<span class="dv">98</span>,<span class="dv">95</span>,<span class="dv">82</span>,<span class="dv">90</span>,<span class="dv">10</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">12</span>,<span class="dv">10</span>,<span class="dv">11</span>))</span>
<span id="cb70-4"><a href="#cb70-4"></a></span>
<span id="cb70-5"><a href="#cb70-5"></a>df <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(country, sex) <span class="sc">%&gt;%</span> </span>
<span id="cb70-6"><a href="#cb70-6"></a>  <span class="fu">mutate</span>(<span class="at">mgrade =</span> <span class="fu">mean</span>(grade)) <span class="sc">%&gt;%</span></span>
<span id="cb70-7"><a href="#cb70-7"></a>  <span class="fu">group_by</span>(country) <span class="sc">%&gt;%</span></span>
<span id="cb70-8"><a href="#cb70-8"></a>  <span class="fu">mutate</span>(<span class="at">meancountry =</span> <span class="fu">mean</span>(grade),</span>
<span id="cb70-9"><a href="#cb70-9"></a>         <span class="at">sdgrade =</span> <span class="fu">sd</span>(grade)) <span class="sc">%&gt;%</span></span>
<span id="cb70-10"><a href="#cb70-10"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> sex, <span class="at">values_from =</span> mgrade) <span class="sc">%&gt;%</span></span>
<span id="cb70-11"><a href="#cb70-11"></a>  <span class="fu">summarise</span>(<span class="at">M_max =</span> <span class="fu">max</span>(M, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb70-12"><a href="#cb70-12"></a>            <span class="st">`</span><span class="at">F_max</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">max</span>(<span class="st">`</span><span class="at">F</span><span class="st">`</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb70-13"><a href="#cb70-13"></a>            <span class="at">difference =</span> M_max<span class="sc">-</span><span class="st">`</span><span class="at">F_max</span><span class="st">`</span>,</span>
<span id="cb70-14"><a href="#cb70-14"></a>            <span class="at">sd =</span> <span class="fu">max</span>(sdgrade),</span>
<span id="cb70-15"><a href="#cb70-15"></a>            <span class="at">mean =</span> <span class="fu">max</span>(meancountry))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 6
  country M_max F_max difference    sd  mean
  &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 A          95    89          6  6.90    92
2 U           9    11         -2  1.41    10</code></pre>
</div>
</div>
<p>If we look for the difference in grades between females and males in country <em>A</em> we might see a massive difference, whilst female and male students in country <em>U</em> have a much smaller difference. We might then conclude that country <em>U</em> is more equitable. But in reality, because the standard deviation in country <em>U</em> is so small, the relative difference between females and males is actually larger than that seen in country <em>A</em>! To get around this problem, when dealing with situations like this, we can use <em>standardised</em>, or <em>z</em>, values. These z-values would be a student’s grade in relation to the standard deviation of all of that country’s grades.</p>
<p>To calculate the standardised <em>z-value</em> for each entry, we use:</p>
<p><code>(entry - mean of grouping) / sd of grouping</code></p>
<p>For example, for the first Male student in country A who scored 100 points, we would calculate</p>
<p><code>(100 - 92) / 6.899 = 1.16</code></p>
<p>This shows that this student got 1.16 standard deviations more than the mean of the population. For the first female in country U, we would calculate:</p>
<p><code>(12 - 10) / 1.141 = 1.75</code></p>
<p>These two values are then directly comparable, the first males in country A is relatively closer to the mean grade of country A, than the first female in country U. How does this work out for the whole country? Going back to whether sex had a greater impact on results in country A or country U we can calculate the z-values for each student by using the <code><a href="https://rdrr.io/r/base/scale.html">scale()</a></code> command:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1"></a>dfz <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(country) <span class="sc">%&gt;%</span> </span>
<span id="cb72-2"><a href="#cb72-2"></a>  <span class="fu">mutate</span>(<span class="at">zgrade =</span> <span class="fu">scale</span>(grade))</span>
<span id="cb72-3"><a href="#cb72-3"></a>dfz</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 4
# Groups:   country [2]
   sex   country grade zgrade[,1]
   &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt;      &lt;dbl&gt;
 1 M     A         100      1.16 
 2 M     A          87     -0.725
 3 M     A          98      0.870
 4 F     A          95      0.435
 5 F     A          82     -1.45 
 6 F     A          90     -0.290
 7 M     U          10      0    
 8 M     U           8     -1.41 
 9 M     U           9     -0.707
10 F     U          12      1.41 
11 F     U          10      0    
12 F     U          11      0.707</code></pre>
</div>
</div>
<p>We can then group by country and by sex and see how the <code>mean</code> z-value varies</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1"></a>dfz <span class="sc">%&gt;%</span></span>
<span id="cb74-2"><a href="#cb74-2"></a>  <span class="fu">group_by</span>(country, sex) <span class="sc">%&gt;%</span></span>
<span id="cb74-3"><a href="#cb74-3"></a>  <span class="fu">summarise</span>(<span class="at">mean_zgrade =</span> <span class="fu">mean</span>(zgrade))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
# Groups:   country [2]
  country sex   mean_zgrade
  &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt;
1 A       F          -0.435
2 A       M           0.435
3 U       F           0.707
4 U       M          -0.707</code></pre>
</div>
</div>
<p>We can clearly see that the grades in country <em>A</em> are relatively closer to the mean of country <em>A</em>, than the grades in country <em>U</em>, meaning that there is less variation in country <em>A</em>.</p>
</section><section id="sec-Stoet-Geary" class="level2" data-number="8.2"><h2 data-number="8.2" class="anchored" data-anchor-id="sec-Stoet-Geary">
<span class="header-section-number">8.2</span> Recreating Stoet and Geary’s paper</h2>
<p>Stoet and Geary’s 2018 paper: <em>“The Gender-Equality Paradox in Science, Technology, Engineering, and Mathematics Education”</em> presented controversial findings, including how the increased female uptake of STEM degrees in country could be partially explained (using regression) by the decreased gender equality in that country. We are going to explore part of this paper by looking at another finding (figure 3a) that looked at girls’ achievement in the <code>PISA_2015</code> science test compared to their maths and reading grades. Comparing this relative grade to boys in the same country, it showed that as gender equality of their country increased, the gap got bigger, i.e.&nbsp;the more gender equal a country, the worse the female relative performance in science.</p>
<blockquote class="blockquote">
<p>The gender gap in intraindividual science scores (a) was larger in more gender-equal countries (<em>r<sub>s</sub></em> = .42)</p>
</blockquote>
<!-- fields used by stoet geary and 2012 equivalents

MATHEFF 2012 MATINTFC 2012 SCIEEFF 2015-->
</section><section id="loading-data-sets" class="level2" data-number="8.3"><h2 data-number="8.3" class="anchored" data-anchor-id="loading-data-sets">
<span class="header-section-number">8.3</span> Loading data sets</h2>
<p>To perform more complex analysis you will often want to join different data sets together. <span class="citation" data-cites="stoet2018gender">Stoet and Geary (<a href="#ref-stoet2018gender" role="doc-biblioref">2018</a>)</span> explore gender differences in outcomes with gender equality in countries (see their figures 3 and 4), by using the <code>PISA_2015</code> data set with the science efficacy <code>SCIEEFF</code>, and science performance (maybe <code>PV1SCIE</code>, or a aggregation of <code>PV1</code>, <code>PV2</code> etc ) fields; mapping this data set to the 2015 Global Gender Gap Index (GGGI). Let’s try and recreate what they did.</p>
<p>First we are going to download the GGGI, unfortunately, it’s difficult to find the 2015 data set, so we’ll use 2013 instead, which can be found <a href="https://data.humdata.org/dataset/29f2f52f-a9c2-4ff9-a99e-42b894dc18e9/resource/a8fe8c72-1359-4ce3-b8cc-03d9e5e85875/download/table-3b-detailed-rankings-2013.csv">here</a></p>
<p>The data is in a <code>.csv</code> format so we need to use <code>read.csv</code> to get it into R (make sure that you use <code>read.csv</code> rather than <code>read_csv</code> as the names will come out slightly differently)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1"></a><span class="co"># load the GGGI</span></span>
<span id="cb76-2"><a href="#cb76-2"></a>GGGI <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"&lt;folder&gt;table-3b-detailed-rankings-2013.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we look at the names of the GGGI fields we find that there is a <code>Country</code> column and the <code>Overall.Score</code> column, these are the columns that we are interested in. We can also see that many of the top scoring countries, i.e.&nbsp;those with better gender equality are Nordic countries.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1"></a>GGGI <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">5</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(Country, Overall.Score)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Country Overall.Score
1     Iceland        0.8731
2     Finland        0.8421
3      Norway        0.8417
4      Sweden        0.8129
5 Philippines        0.7832</code></pre>
</div>
</div>
<p>Now we will load the 2015 PISA data set, we have a <code>.parquet</code> copy for you <a href="https://drive.google.com/file/d/18NpQO1DGY5dnjnlR2b3IF9Zv8xtpc1Fk/view?usp=share_link">here</a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1"></a><span class="co"># load PISA_2015 student data set</span></span>
<span id="cb79-2"><a href="#cb79-2"></a>PISA_2015 <span class="ot">&lt;-</span> <span class="fu">read_parquet</span>(<span class="st">"&lt;folder&gt;PISA_2015_student_subset.parquet"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="sec-leftjoin" class="level2" data-number="8.4"><h2 data-number="8.4" class="anchored" data-anchor-id="sec-leftjoin">
<span class="header-section-number">8.4</span> Linking data using <code>left_join</code>
</h2>
<p>To link the <code>GGGI</code> to the <code>PISA_2015</code> data set we will use the <code>left_join</code> function from the tidyverse. This takes a few parameters</p>
<pre><code>left_join(&lt;table_1&gt;, &lt;table_2&gt;, by=&lt;matching_field[s]&gt;)</code></pre>
<p>We will now join a subset of the <code>PISA_2015</code> data set to a subset of the <code>GGGI</code> scores:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1"></a>PISA_2015_GGGI <span class="ot">&lt;-</span> <span class="fu">left_join</span>(</span>
<span id="cb81-2"><a href="#cb81-2"></a>  PISA_2015 <span class="sc">%&gt;%</span> <span class="fu">select</span>(CNT, ST004D01T, PV1MATH, PV1SCIE, PV1READ, SCIEEFF),</span>
<span id="cb81-3"><a href="#cb81-3"></a>  GGGI <span class="sc">%&gt;%</span> <span class="fu">select</span>(Country, Overall.Score),</span>
<span id="cb81-4"><a href="#cb81-4"></a>  <span class="at">by=</span><span class="fu">c</span>(<span class="st">"CNT"</span><span class="ot">=</span><span class="st">"Country"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>line 1, assigns <code>&lt;-</code> the result of the <code>left_join</code> to a new object, <code>PISA_2015_GGGI</code>,</li>
<li>line 2, specifies <code>&lt;table_1&gt;</code> to be <code>PISA_2015</code> with the selected fields, note we have chosen to use <code>PV1</code> grades here, it’s unclear what the original paper uses (See <a href="../chapters/A1-PISA_analysis.html#sec-PV">§What are Plausible Values?</a> for a discussion on the use of <code>PV</code> grades)</li>
<li>line 3, specifies <code>&lt;table_2&gt;</code> to be <code>GGGI</code> with just the country and <code>Overall.Score</code> fields</li>
<li>line 4, specifies the <code>&lt;matching_field&gt;</code> to be <code>CNT</code>from <code>PISA_2015</code> and <code>Country</code> from <code>GGGI</code>, this means that the data in <code>&lt;table_2&gt;</code> will be added to <code>&lt;table_1&gt;</code> where <code>CNT</code> and <code>Country</code> are the same. For example for every entry of <code>Finland</code> in <code>PISA_2015</code>, the <code>Overall.Score</code> of <code>0.8421</code> will be added. Where it can’t find a matching country, e.g.&nbsp;Albania doesn’t have a GGGI entry, <code>NA</code> will be added.</li>
</ul>
<p>You can see the new data set has attached the <code>Overall.Score</code> field from <code>GGGI</code> to the selected fields from <code>PISA_2015</code>:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 7
  CNT     ST004D01T PV1MATH PV1SCIE PV1READ SCIEEFF Overall.Score
  &lt;chr&gt;   &lt;fct&gt;       &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;         &lt;dbl&gt;
1 Albania Female       463.    517.    430.      NA         0.641
2 Albania Female       430.    480.    463.      NA         0.641
3 Albania Female       303.    447.    503.      NA         0.641</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>There are multiple types of join in the tidyverse, you can find out more about them <a href="https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">here</a></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="..\images/joins.png" class="img-fluid figure-img"></p>
<figcaption>The available joins in the tidyverse, CC 4.0, by rstudio.com</figcaption></figure>
</div>
</div>
</div>
</section><section id="sec-standard-stoet-geary" class="level2" data-number="8.5"><h2 data-number="8.5" class="anchored" data-anchor-id="sec-standard-stoet-geary">
<span class="header-section-number">8.5</span> Standardising PISA results</h2>
<p>Next, we will try to wrangle the data into shape to recreate figure 3 from <span class="citation" data-cites="stoet2018gender">Stoet and Geary (<a href="#ref-stoet2018gender" role="doc-biblioref">2018</a>)</span>. To do this we first need to standardise the grades for maths, science and reading so we can compare the results of students between countries without low performing or high performing countries skewing the results (see <a href="#sec-z-values" class="quarto-xref">Section&nbsp;8.1</a> for details on how to standardise data). Following the steps outlined on page 7:</p>
<blockquote class="blockquote">
<ol type="1">
<li>We standardized the mathematics, science, and reading scores on a nation-by-nation basis. We call these new standardized scores <em>zMath</em>, <em>zRead</em>, and <em>zScience</em>.</li>
<li>We calculated for each student the standardized average score of the new z-scores and we call this <em>zGeneral</em>.</li>
<li>Then, we calculated for each student their intra-individual strengths by subtracting <em>zGeneral</em> as follows: <em>relativeSciencestrength = zScience - zGeneral</em>, <em>relativeMathstrength = zMath - zGeneral</em>, <em>relativeReadingstrength = zReading - zGeneral</em>.</li>
<li>Finally, using these new intra-individual (relative) scores, we calculated for each country the averages for boys and girls and subtracted those to calculate the gender gaps in relative academic strengths</li>
</ol>
</blockquote>
<p>produces the following code:</p>
<div class="cell">
<details class="code-fold"><summary>code</summary><div class="sourceCode cell-code" id="cb83"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1"></a><span class="co"># standardise the results for each student in line with pg7</span></span>
<span id="cb83-2"><a href="#cb83-2"></a><span class="co"># https://eprints.leedsbeckett.ac.uk/id/eprint/4753/6/symplectic-version.pdf</span></span>
<span id="cb83-3"><a href="#cb83-3"></a></span>
<span id="cb83-4"><a href="#cb83-4"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb83-5"><a href="#cb83-5"></a><span class="fu">library</span>(arrow)</span>
<span id="cb83-6"><a href="#cb83-6"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb83-7"><a href="#cb83-7"></a></span>
<span id="cb83-8"><a href="#cb83-8"></a><span class="co"># step 1</span></span>
<span id="cb83-9"><a href="#cb83-9"></a>PISA_2015z <span class="ot">&lt;-</span> PISA_2015_GGGI <span class="sc">%&gt;%</span> </span>
<span id="cb83-10"><a href="#cb83-10"></a>  <span class="fu">rename</span>(<span class="at">gender =</span> ST004D01T) <span class="sc">%&gt;%</span></span>
<span id="cb83-11"><a href="#cb83-11"></a>  <span class="fu">group_by</span>(CNT) <span class="sc">%&gt;%</span></span>
<span id="cb83-12"><a href="#cb83-12"></a>  <span class="fu">mutate</span>(<span class="at">zMaths   =</span> <span class="fu">scale</span>(PV1MATH),</span>
<span id="cb83-13"><a href="#cb83-13"></a>         <span class="at">zScience =</span> <span class="fu">scale</span>(PV1SCIE), </span>
<span id="cb83-14"><a href="#cb83-14"></a>         <span class="at">zReading =</span> <span class="fu">scale</span>(PV1READ))</span>
<span id="cb83-15"><a href="#cb83-15"></a></span>
<span id="cb83-16"><a href="#cb83-16"></a><span class="co"># step 2</span></span>
<span id="cb83-17"><a href="#cb83-17"></a>PISA_2015z <span class="ot">&lt;-</span> PISA_2015z <span class="sc">%&gt;%</span> </span>
<span id="cb83-18"><a href="#cb83-18"></a>  <span class="fu">mutate</span>(<span class="at">zGeneral =</span> (zMaths <span class="sc">+</span> zScience <span class="sc">+</span> zReading) <span class="sc">/</span> <span class="dv">3</span>)</span>
<span id="cb83-19"><a href="#cb83-19"></a></span>
<span id="cb83-20"><a href="#cb83-20"></a><span class="co"># step 3</span></span>
<span id="cb83-21"><a href="#cb83-21"></a>PISA_2015z <span class="ot">&lt;-</span> PISA_2015z <span class="sc">%&gt;%</span> </span>
<span id="cb83-22"><a href="#cb83-22"></a>  <span class="fu">mutate</span>(<span class="at">rel_MATH =</span> zMaths   <span class="sc">-</span> zGeneral,</span>
<span id="cb83-23"><a href="#cb83-23"></a>         <span class="at">rel_SCIE =</span> zScience <span class="sc">-</span> zGeneral,</span>
<span id="cb83-24"><a href="#cb83-24"></a>         <span class="at">rel_READ =</span> zReading <span class="sc">-</span> zGeneral)</span>
<span id="cb83-25"><a href="#cb83-25"></a></span>
<span id="cb83-26"><a href="#cb83-26"></a><span class="co"># step 4 part 1</span></span>
<span id="cb83-27"><a href="#cb83-27"></a>PISA_2015z <span class="ot">&lt;-</span> PISA_2015z <span class="sc">%&gt;%</span> </span>
<span id="cb83-28"><a href="#cb83-28"></a>  <span class="fu">group_by</span>(CNT, gender) <span class="sc">%&gt;%</span></span>
<span id="cb83-29"><a href="#cb83-29"></a>  <span class="fu">summarise</span>(<span class="at">zMaths =</span> <span class="fu">mean</span>(zMaths, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb83-30"><a href="#cb83-30"></a>            <span class="at">zScience =</span> <span class="fu">mean</span>(zScience, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb83-31"><a href="#cb83-31"></a>            <span class="at">zReading =</span> <span class="fu">mean</span>(zReading, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb83-32"><a href="#cb83-32"></a>            <span class="at">zGeneral =</span> <span class="fu">mean</span>(zGeneral, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb83-33"><a href="#cb83-33"></a>            <span class="at">rel_MATH =</span> zMaths <span class="sc">-</span> zGeneral,</span>
<span id="cb83-34"><a href="#cb83-34"></a>            <span class="at">rel_SCIE =</span> zScience <span class="sc">-</span> zGeneral,</span>
<span id="cb83-35"><a href="#cb83-35"></a>            <span class="at">rel_READ =</span> zReading <span class="sc">-</span> zGeneral,</span>
<span id="cb83-36"><a href="#cb83-36"></a>            <span class="at">gggi =</span> <span class="fu">unique</span>(Overall.Score))</span>
<span id="cb83-37"><a href="#cb83-37"></a></span>
<span id="cb83-38"><a href="#cb83-38"></a><span class="co"># step 4 part 2</span></span>
<span id="cb83-39"><a href="#cb83-39"></a>pisa_gggi_diff <span class="ot">&lt;-</span> PISA_2015z <span class="sc">%&gt;%</span></span>
<span id="cb83-40"><a href="#cb83-40"></a>  <span class="fu">select</span>(CNT, gender, gggi, rel_SCIE) <span class="sc">%&gt;%</span></span>
<span id="cb83-41"><a href="#cb83-41"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> gender,</span>
<span id="cb83-42"><a href="#cb83-42"></a>              <span class="at">values_from =</span> rel_SCIE) <span class="sc">%&gt;%</span></span>
<span id="cb83-43"><a href="#cb83-43"></a>  <span class="fu">mutate</span>(<span class="at">difference =</span>  Male <span class="sc">-</span> Female)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Finally we will plot the results:</p>
<div class="cell">
<details class="code-fold"><summary>graph code</summary><div class="sourceCode cell-code" id="cb84"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb84-2"><a href="#cb84-2"></a></span>
<span id="cb84-3"><a href="#cb84-3"></a><span class="fu">ggplot</span>(pisa_gggi_diff,</span>
<span id="cb84-4"><a href="#cb84-4"></a>       <span class="fu">aes</span>(<span class="at">x=</span>difference, <span class="at">y=</span>gggi)) <span class="sc">+</span> </span>
<span id="cb84-5"><a href="#cb84-5"></a>  <span class="fu">geom_point</span>(<span class="at">colour=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb84-6"><a href="#cb84-6"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb84-7"><a href="#cb84-7"></a>  <span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label=</span>CNT),</span>
<span id="cb84-8"><a href="#cb84-8"></a>            <span class="at">box.padding =</span> <span class="fl">0.2</span>,</span>
<span id="cb84-9"><a href="#cb84-9"></a>            <span class="at">max.overlaps =</span> <span class="cn">Inf</span>,</span>
<span id="cb84-10"><a href="#cb84-10"></a>            <span class="at">colour=</span><span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb84-11"><a href="#cb84-11"></a>  <span class="fu">xlab</span>(<span class="fu">paste0</span>(<span class="st">"relative difference in PV1SCIE scores (male-female)"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="10-Correlation_and_regression_files/figure-html/unnamed-chunk-76-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>The graph is pretty good recreation of what the paper presented, with the general shape the same; differences in grades for each country might be explained by the original paper using 5 plausible values rather than just <code>PV1SCIE</code>, as we have used <span class="citation" data-cites="stoet2020gender">(<a href="#ref-stoet2020gender" role="doc-biblioref">Stoet and Geary 2020</a>)</span>. Does the statistical model stand up to scrutiny? To find out we will use <em>correlation</em>. Stoet and Geary used <em>Spearman’s rho</em>, signified by the <sub><em>s</em></sub> in <em>r<sub>s</sub></em>:</p>
<blockquote class="blockquote">
<p>The most important and novel finding here is that the sex difference in intraindividual strength in science was higher and more favorable to boys in more gender-equal countries, <em>r<sub>s</sub></em> = .42, 95% CI = [.19,.61], <em>p</em> &lt; .001, <em>n</em> = 62 (Fig. 3a)</p>
</blockquote>
<p>We can run our version of this model using the following:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1"></a>result <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(pisa_gggi_diff<span class="sc">$</span>gggi, </span>
<span id="cb85-2"><a href="#cb85-2"></a>                    pisa_gggi_diff<span class="sc">$</span>difference, </span>
<span id="cb85-3"><a href="#cb85-3"></a>                    <span class="at">method=</span><span class="st">"spearman"</span>)</span>
<span id="cb85-4"><a href="#cb85-4"></a>result</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Spearman's rank correlation rho

data:  pisa_gggi_diff$gggi and pisa_gggi_diff$difference
S = 24384, p-value = 0.02763
alternative hypothesis: true rho is not equal to 0
sample estimates:
      rho 
0.2874342 </code></pre>
</div>
</div>
<p>Our model doesn’t show such a strong correlation. In fact, our model shows a “weak positive” relationship of just <code>0.287</code>, albeit a significant one (<code>p&lt;0.05</code>).</p>
<p>For our version of this model it seems unnecessary to use Spearman’s rho, the number of countries we are comparing with valid data is 59 (<code>pisa_gggi_diff %&gt;% na.omit() %&gt;% nrow()</code>), which is greater than 30 and using the <em>central limit theorem</em> we should be able to use <em>Pearson’s r</em>. Additionally,<code>shapiro.test</code>on both difference and<code>gggi</code> give non-significant results, suggesting Pearson is the better test to use here:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1"></a><span class="fu">shapiro.test</span>(pisa_gggi_diff<span class="sc">$</span>gggi) </span>
<span id="cb87-2"><a href="#cb87-2"></a><span class="co">#&gt; p-value = 0.1226</span></span>
<span id="cb87-3"><a href="#cb87-3"></a><span class="fu">shapiro.test</span>(pisa_gggi_diff<span class="sc">$</span>difference)</span>
<span id="cb87-4"><a href="#cb87-4"></a><span class="co">#&gt; p-value = 0.4078</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we run the model again using Pearson’s r, we get:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1"></a>result <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(pisa_gggi_diff<span class="sc">$</span>gggi, </span>
<span id="cb88-2"><a href="#cb88-2"></a>                    pisa_gggi_diff<span class="sc">$</span>difference, </span>
<span id="cb88-3"><a href="#cb88-3"></a>                    <span class="at">method=</span><span class="st">"pearson"</span>)</span>
<span id="cb88-4"><a href="#cb88-4"></a>result</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's product-moment correlation

data:  pisa_gggi_diff$gggi and pisa_gggi_diff$difference
t = 3.9972, df = 57, p-value = 0.0001863
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 0.2406661 0.6465242
sample estimates:
      cor 
0.4679109 </code></pre>
</div>
</div>
<p>A result much closer to the one published. The differences here might be the result of the different GGGI data set we used or a difference in the way we calculated <code>difference</code>, or something to do with the correlation model used. It would be good to know!</p>
<p>We can also explore this data using regression and a linear model looking at the relationship between <code>difference</code> in grades and the <code>gggi</code> value for each country:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1"></a>mdl <span class="ot">&lt;-</span> <span class="fu">lm</span>(difference <span class="sc">~</span> gggi, <span class="at">data =</span> pisa_gggi_diff)</span>
<span id="cb90-2"><a href="#cb90-2"></a><span class="fu">summary</span>(mdl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = difference ~ gggi, data = pisa_gggi_diff)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.067343 -0.018964 -0.003605  0.023548  0.083991 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -0.12926    0.05317  -2.431 0.018228 *  
gggi         0.29826    0.07462   3.997 0.000186 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.03247 on 57 degrees of freedom
  (14 observations deleted due to missingness)
Multiple R-squared:  0.2189,    Adjusted R-squared:  0.2052 
F-statistic: 15.98 on 1 and 57 DF,  p-value: 0.0001863</code></pre>
</div>
</div>
<p>This model also finds a significant difference (<code>p&lt;0.001</code>) and an estimate for gggi of <code>0.298</code>, i.e.&nbsp;for each increase of 1 in gggi, males will do <code>0.298</code> of a standard deviation better than females. The R<sup>2</sup> is pretty decent too at <code>0.219</code> suggesting the finding that Stoet and Geary reported is a sound one.</p>
<!--# Stoet Geary Maths-->



</section></section><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-coe2002s" class="csl-entry" role="listitem">
Coe, Robert. 2002. <span>“It’s the Effect Size, Stupid.”</span> In <em>British Educational Research Association Annual Conference</em>, 12:14.
</div>
<div id="ref-cohen1962statistical" class="csl-entry" role="listitem">
Cohen, Jacob. 1962. <span>“The Statistical Power of Abnormal-Social Psychological Research: A Review.”</span> <em>The Journal of Abnormal and Social Psychology</em> 65 (3): 145.
</div>
<div id="ref-field2012discovering" class="csl-entry" role="listitem">
Field, Zoë, Jeremy Miles, and Andy Field. 2012. <em>Discovering Statistics Using r</em>. <em>Discovering Statistics Using R</em>. Sage.
</div>
<div id="ref-higgins2016sutton" class="csl-entry" role="listitem">
Higgins, Steve, Maria Katsipataki, AB Villanueva-Aguilera, Robbie Coleman, P Henderson, LE Major, R Coe, and Danielle Mason. 2016. <span>“The Sutton Trust-Education Endowment Foundation Teaching and Learning Toolkit.”</span> <a href="https://dro.dur.ac.uk/20987/1/20987.pdf">https://dro.dur.ac.uk/20987/1/20987.pdf</a>.
</div>
<div id="ref-dave2023cv" class="csl-entry" role="listitem">
(https://stats.stackexchange.com/users/247274/dave), Dave. n.d. <span>“Significance Test for Large Sample Sizes.”</span> Cross Validated. <a href="https://stats.stackexchange.com/q/602422">https://stats.stackexchange.com/q/602422</a>.
</div>
<div id="ref-schafer2019meaningfulness" class="csl-entry" role="listitem">
Schäfer, Thomas, and Marcus A Schwarz. 2019. <span>“The Meaningfulness of Effect Sizes in Psychological Research: Differences Between Sub-Disciplines and the Impact of Potential Biases.”</span> <em>Frontiers in Psychology</em> 10: 813. <a href="https://www.frontiersin.org/articles/10.3389/fpsyg.2019.00813/full">https://www.frontiersin.org/articles/10.3389/fpsyg.2019.00813/full</a>.
</div>
<div id="ref-schmidt2018linear" class="csl-entry" role="listitem">
Schmidt, Amand F, and Chris Finan. 2018. <span>“Linear Regression and the Normality Assumption.”</span> <em>Journal of Clinical Epidemiology</em> 98: 146–51.
</div>
<div id="ref-stoet2018gender" class="csl-entry" role="listitem">
Stoet, Gijsbert, and David C Geary. 2018. <span>“The Gender-Equality Paradox in Science, Technology, Engineering, and Mathematics Education.”</span> <em>Psychological Science</em> 29 (4): 581–93. <a href="https://eprints.leedsbeckett.ac.uk/id/eprint/4753/6/symplectic-version.pdf">https://eprints.leedsbeckett.ac.uk/id/eprint/4753/6/symplectic-version.pdf</a>.
</div>
<div id="ref-stoet2020gender" class="csl-entry" role="listitem">
———. 2020. <span>“Corrigendum: The Gender-Equality Paradox in Science, Technology, Engineering, and Mathematics Education.”</span> <a href="https://journals.sagepub.com/doi/10.1177/0956797619892892">https://journals.sagepub.com/doi/10.1177/0956797619892892</a>.
</div>
<div id="ref-statology2021" class="csl-entry" role="listitem">
Zach. 2021. <span>“The Complete Guide: How to Report Regression Results.”</span> <a href="https://www.statology.org/how-to-report-regression-results/">https://www.statology.org/how-to-report-regression-results/</a>.
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>
<ol>
<li id="fn1"><p>for normally distributed data one SD will cover ~68% of responses<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>https://stats.stackexchange.com/questions/18750/hosmer-lemeshow-vs-aic-for-logistic-regression<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>https://www.statisticssolutions.com/the-linear-regression-analysis-in-spss/:<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>